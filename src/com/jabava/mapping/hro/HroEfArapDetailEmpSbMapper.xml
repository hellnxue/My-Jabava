<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jabava.dao.hro.HroEfArapDetailEmpSbMapper">
  <resultMap id="BaseResultMap" type="com.jabava.pojo.hro.HroEfArapDetailEmpSb">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jun 28 10:50:59 CST 2016.
    -->
    <id column="BILL_DETAIL_ID" jdbcType="BIGINT" property="billDetailId" />
    <id column="BILL_YM" jdbcType="CHAR" property="billYm" />
    <result column="VERSION" jdbcType="INTEGER" property="version" />
    <result column="BILL_ID" jdbcType="BIGINT" property="billId" />
    <result column="BILL_TEMPLATE_ID" jdbcType="BIGINT" property="billTemplateId" />
    <result column="EMP_ID" jdbcType="BIGINT" property="empId" />
    <result column="CLIENT_ID" jdbcType="BIGINT" property="clientId" />
    <result column="PREVIOUS_SEND_ID" jdbcType="BIGINT" property="previousSendId" />
    <result column="CITY_ID" jdbcType="BIGINT" property="cityId" />
    <result column="SB_YM" jdbcType="CHAR" property="sbYm" />
    <result column="SERVER_YM" jdbcType="CHAR" property="serverYm" />
    <result column="POLICY_GROUP_ID" jdbcType="BIGINT" property="policyGroupId" />
    <result column="PROD_ID" jdbcType="BIGINT" property="prodId" />
    <result column="IS_SUM" jdbcType="INTEGER" property="isSum" />
    <result column="IS_ONE_OFF" jdbcType="INTEGER" property="isOneOff" />
    <result column="AMOUNT" jdbcType="DECIMAL" property="amount" />
    <result column="AMOUNT_E" jdbcType="DECIMAL" property="amountE" />
    <result column="AMOUNT_P" jdbcType="DECIMAL" property="amountP" />
    <result column="BASE_E" jdbcType="DECIMAL" property="baseE" />
    <result column="BASE_P" jdbcType="DECIMAL" property="baseP" />
    <result column="RATIO_E" jdbcType="DECIMAL" property="ratioE" />
    <result column="RATIO_P" jdbcType="DECIMAL" property="ratioP" />
    <result column="ADD_AMT_E" jdbcType="DECIMAL" property="addAmtE" />
    <result column="ADD_AMT_P" jdbcType="DECIMAL" property="addAmtP" />
    <result column="CONTRACT_ID" jdbcType="BIGINT" property="contractId" />
    <result column="CONTRACT_TYPE" jdbcType="CHAR" property="contractType" />
    <result column="SECOND_CONTRACT_ID" jdbcType="BIGINT" property="secondContractId" />
    <result column="RED_FLAG" jdbcType="INTEGER" property="redFlag" />
    <result column="REMARK" jdbcType="VARCHAR" property="remark" />
    <result column="IS_DELETED" jdbcType="INTEGER" property="isDeleted" />
    <result column="CREATE_BY" jdbcType="BIGINT" property="createBy" />
    <result column="CREATE_DT" jdbcType="TIMESTAMP" property="createDt" />
    <result column="UPDATE_BY" jdbcType="BIGINT" property="updateBy" />
    <result column="UPDATE_DT" jdbcType="TIMESTAMP" property="updateDt" />
    <result column="MIMIC_BY" jdbcType="BIGINT" property="mimicBy" />
    <result column="PROXY_BY" jdbcType="BIGINT" property="proxyBy" />
    <result column="PAYMENT_DETAIL_ID" jdbcType="BIGINT" property="paymentDetailId" />
    <result column="ORDER_ID" jdbcType="BIGINT" property="orderId" />
    <result column="EMPLOYEE_REC_ID" jdbcType="BIGINT" property="employeeRecId" />
    <result column="CITY_NAME" jdbcType="VARCHAR" property="cityName" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jun 28 10:50:59 CST 2016.
    -->
    BILL_DETAIL_ID, BILL_YM, VERSION, BILL_ID, BILL_TEMPLATE_ID, EMP_ID, CLIENT_ID, PREVIOUS_SEND_ID, 
    CITY_ID, SB_YM, SERVER_YM, POLICY_GROUP_ID, PROD_ID, IS_SUM, IS_ONE_OFF, AMOUNT, 
    AMOUNT_E, AMOUNT_P, BASE_E, BASE_P, RATIO_E, RATIO_P, ADD_AMT_E, ADD_AMT_P, CONTRACT_ID, 
    CONTRACT_TYPE, SECOND_CONTRACT_ID, RED_FLAG, REMARK, IS_DELETED, CREATE_BY, CREATE_DT, 
    UPDATE_BY, UPDATE_DT, MIMIC_BY, PROXY_BY, PAYMENT_DETAIL_ID, ORDER_ID, EMPLOYEE_REC_ID, 
    CITY_NAME
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jun 28 10:50:59 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from EF_ARAP_DETAIL_EMP_SB
    where BILL_DETAIL_ID = #{billDetailId,jdbcType=BIGINT}
  </select>

  <!-- 
  	SELECT
		bsb.*, e.CARD_TYPE,e.CARD_ID,
		prod.PROD_NAME, c.CITY_NAME NAME_OF_CITY  
	FROM
		EF_ARAP bill,
		EF_ARAP_DETAIL_EMP_SB bsb,
		BD_EMP_BASE_INFO e,
	        BD_PROD prod, 
	        BD_CITY c 
	WHERE
		bsb.PROD_ID = prod.PROD_ID
		AND prod.IS_DELETED = 0
		AND bsb.EMP_ID = e.ID
		AND bill.IS_DELETED = 0
		AND bill.BILL_ID = bsb.BILL_ID 
		AND c.CITY_ID=bsb.CITY_ID 
		AND bsb.IS_DELETED = 0
		[and bill.BILL_CODE=:BILL_CODE] 
  -->
  <select id="selectHeaderListByBillId" resultType="java.util.Map" parameterType="java.lang.Long" >
    select distinct prod.PROD_ID,prod.PROD_NAME 
    FROM hr.EF_ARAP_DETAIL_EMP_SB bd 
    	left join hr.EF_ARAP bill on bill.BILL_ID = bd.BILL_ID 
		left join hr.BD_EMP_BASE_INFO e on bd.EMP_ID = e.ID 
	    left join hr.BD_PROD prod on bd.PROD_ID = prod.PROD_ID 
	WHERE bill.BILL_ID=#{billId,jdbcType=BIGINT}
		AND prod.IS_DELETED = 0
		AND bill.IS_DELETED = 0
		AND bd.IS_DELETED = 0
    order by prod.PROD_ID
  </select>
  
  <select id="selectByBillId" resultType="java.util.Map" parameterType="java.lang.Long" >
    select bd.*, e.EMPLOYEE_NAME, e.CARD_ID, e.CARD_TYPE, c.CITY_NAME 
    FROM hr.EF_ARAP_DETAIL_EMP_SB bd 
    	left join hr.EF_ARAP bill on bill.BILL_ID = bd.BILL_ID 
		left join hr.BD_EMP_BASE_INFO e on bd.EMP_ID = e.ID 
	    left join hr.BD_PROD prod on bd.PROD_ID = prod.PROD_ID 
	    left join hr.HS_EMP_ORD o ON bd.ORDER_ID = o.ID
	    left join hr.BD_EMP_REC_INFO r ON o.EMPLOYEE_REC_ID = r.ID
	    left join hr.BD_CITY c ON r.WORK_ADDRESS = c.CITY_ID 
	WHERE bill.BILL_ID=#{billId,jdbcType=BIGINT}
		AND prod.IS_DELETED = 0
		AND bill.IS_DELETED = 0
		AND bd.IS_DELETED = 0
  </select>
</mapper>