<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jabava.dao.hro.EfReceiptOwnedMapper" >
  <resultMap id="BaseResultMap" type="com.jabava.pojo.hro.EfReceiptOwned" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 01 16:18:26 CST 2016.
    -->
    <result column="match_id" property="matchId" jdbcType="BIGINT" />
    <result column="org_id" property="orgId" jdbcType="BIGINT" />
    <result column="match_payer_id" property="matchPayerId" jdbcType="BIGINT" />
    <result column="match_amount" property="matchAmount" jdbcType="DECIMAL" />
    <result column="match_by" property="matchBy" jdbcType="BIGINT" />
    <result column="match_type" property="matchType" jdbcType="INTEGER" />
    <result column="match_date" property="matchDate" jdbcType="DATE" />
    <result column="receipt_bank_id" property="receiptBankId" jdbcType="BIGINT" />
    <result column="receipt_bank_name" property="receiptBankName" jdbcType="VARCHAR" />
    <result column="receipt_bank" property="receiptBank" jdbcType="VARCHAR" />
    <result column="receipt_bank_account_name" property="receiptBankAccountName" jdbcType="VARCHAR" />
    <result column="receipt_bank_account" property="receiptBankAccount" jdbcType="VARCHAR" />
    <result column="trans_date" property="transDate" jdbcType="DATE" />
    <result column="receipt_type" property="receiptType" jdbcType="INTEGER" />
    <result column="trans_id" property="transId" jdbcType="VARCHAR" />
    <result column="pay_account_name" property="payAccountName" jdbcType="VARCHAR" />
    <result column="pay_account_no" property="payAccountNo" jdbcType="VARCHAR" />
    <result column="amount" property="amount" jdbcType="DECIMAL" />
    <result column="memo" property="memo" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="is_deleted" property="isDeleted" jdbcType="INTEGER" />
    <result column="create_by" property="createBy" jdbcType="BIGINT" />
    <result column="create_dt" property="createDt" jdbcType="TIMESTAMP" />
    <result column="update_by" property="updateBy" jdbcType="BIGINT" />
    <result column="update_dt" property="updateDt" jdbcType="TIMESTAMP" />
    <result column="mimic_by" property="mimicBy" jdbcType="BIGINT" />
    <result column="proxy_by" property="proxyBy" jdbcType="BIGINT" />
    <result column="imp_detail_id" property="impDetailId" jdbcType="BIGINT" />
    <result column="balance_direction" property="balanceDirection" jdbcType="CHAR" />
    <result column="protocol_code" property="protocolCode" jdbcType="VARCHAR" />
    <result column="company_id" property="companyId" jdbcType="BIGINT" />
  </resultMap>
  <insert id="insert" parameterType="com.jabava.pojo.hro.EfReceiptOwned" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 01 16:18:26 CST 2016.
    -->
    insert into ef_receipt_owned (match_id, org_id, match_payer_id, 
      match_amount, match_by, match_type, 
      match_date, receipt_bank_id, receipt_bank_name, 
      receipt_bank, receipt_bank_account_name, receipt_bank_account, 
      trans_date, receipt_type, trans_id, 
      pay_account_name, pay_account_no, amount, 
      memo, status, is_deleted, 
      create_by, create_dt, update_by, 
      update_dt, mimic_by, proxy_by, 
      imp_detail_id, balance_direction,protocol_code,
      company_id)
    values (#{matchId,jdbcType=BIGINT}, #{orgId,jdbcType=BIGINT}, #{matchPayerId,jdbcType=BIGINT}, 
      #{matchAmount,jdbcType=DECIMAL}, #{matchBy,jdbcType=BIGINT}, #{matchType,jdbcType=INTEGER}, 
      #{matchDate,jdbcType=DATE}, #{receiptBankId,jdbcType=BIGINT}, #{receiptBankName,jdbcType=VARCHAR}, 
      #{receiptBank,jdbcType=VARCHAR}, #{receiptBankAccountName,jdbcType=VARCHAR}, #{receiptBankAccount,jdbcType=VARCHAR}, 
      #{transDate,jdbcType=DATE}, #{receiptType,jdbcType=INTEGER}, #{transId,jdbcType=VARCHAR}, 
      #{payAccountName,jdbcType=VARCHAR}, #{payAccountNo,jdbcType=VARCHAR}, #{amount,jdbcType=DECIMAL}, 
      #{memo,jdbcType=VARCHAR}, #{status,jdbcType=INTEGER}, #{isDeleted,jdbcType=INTEGER}, 
      #{createBy,jdbcType=BIGINT}, #{createDt,jdbcType=TIMESTAMP}, #{updateBy,jdbcType=BIGINT}, 
      #{updateDt,jdbcType=TIMESTAMP}, #{mimicBy,jdbcType=BIGINT}, #{proxyBy,jdbcType=BIGINT}, 
      #{impDetailId,jdbcType=BIGINT}, #{balanceDirection,jdbcType=CHAR}, #{protocolCode,jdbcType=VARCHAR}, 
      #{companyId,jdbcType=BIGINT})
  </insert>
  <insert id="insertSelective" parameterType="com.jabava.pojo.hro.EfReceiptOwned" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 01 16:18:26 CST 2016.
    -->
    insert into ef_receipt_owned
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="matchId != null" >
        match_id,
      </if>
      <if test="orgId != null" >
        org_id,
      </if>
      <if test="matchPayerId != null" >
        match_payer_id,
      </if>
      <if test="matchAmount != null" >
        match_amount,
      </if>
      <if test="matchBy != null" >
        match_by,
      </if>
      <if test="matchType != null" >
        match_type,
      </if>
      <if test="matchDate != null" >
        match_date,
      </if>
      <if test="receiptBankId != null" >
        receipt_bank_id,
      </if>
      <if test="receiptBankName != null" >
        receipt_bank_name,
      </if>
      <if test="receiptBank != null" >
        receipt_bank,
      </if>
      <if test="receiptBankAccountName != null" >
        receipt_bank_account_name,
      </if>
      <if test="receiptBankAccount != null" >
        receipt_bank_account,
      </if>
      <if test="transDate != null" >
        trans_date,
      </if>
      <if test="receiptType != null" >
        receipt_type,
      </if>
      <if test="transId != null" >
        trans_id,
      </if>
      <if test="payAccountName != null" >
        pay_account_name,
      </if>
      <if test="payAccountNo != null" >
        pay_account_no,
      </if>
      <if test="amount != null" >
        amount,
      </if>
      <if test="memo != null" >
        memo,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="isDeleted != null" >
        is_deleted,
      </if>
      <if test="createBy != null" >
        create_by,
      </if>
      <if test="createDt != null" >
        create_dt,
      </if>
      <if test="updateBy != null" >
        update_by,
      </if>
      <if test="updateDt != null" >
        update_dt,
      </if>
      <if test="mimicBy != null" >
        mimic_by,
      </if>
      <if test="proxyBy != null" >
        proxy_by,
      </if>
      <if test="impDetailId != null" >
        imp_detail_id,
      </if>
      <if test="balanceDirection != null" >
        balance_direction,
      </if>
      <if test="protocolCode != null" >
        protocol_code,
      </if>
      <if test="companyId != null" >
        company_id,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="matchId != null" >
        #{matchId,jdbcType=BIGINT},
      </if>
      <if test="orgId != null" >
        #{orgId,jdbcType=BIGINT},
      </if>
      <if test="matchPayerId != null" >
        #{matchPayerId,jdbcType=BIGINT},
      </if>
      <if test="matchAmount != null" >
        #{matchAmount,jdbcType=DECIMAL},
      </if>
      <if test="matchBy != null" >
        #{matchBy,jdbcType=BIGINT},
      </if>
      <if test="matchType != null" >
        #{matchType,jdbcType=INTEGER},
      </if>
      <if test="matchDate != null" >
        #{matchDate,jdbcType=DATE},
      </if>
      <if test="receiptBankId != null" >
        #{receiptBankId,jdbcType=BIGINT},
      </if>
      <if test="receiptBankName != null" >
        #{receiptBankName,jdbcType=VARCHAR},
      </if>
      <if test="receiptBank != null" >
        #{receiptBank,jdbcType=VARCHAR},
      </if>
      <if test="receiptBankAccountName != null" >
        #{receiptBankAccountName,jdbcType=VARCHAR},
      </if>
      <if test="receiptBankAccount != null" >
        #{receiptBankAccount,jdbcType=VARCHAR},
      </if>
      <if test="transDate != null" >
        #{transDate,jdbcType=DATE},
      </if>
      <if test="receiptType != null" >
        #{receiptType,jdbcType=INTEGER},
      </if>
      <if test="transId != null" >
        #{transId,jdbcType=VARCHAR},
      </if>
      <if test="payAccountName != null" >
        #{payAccountName,jdbcType=VARCHAR},
      </if>
      <if test="payAccountNo != null" >
        #{payAccountNo,jdbcType=VARCHAR},
      </if>
      <if test="amount != null" >
        #{amount,jdbcType=DECIMAL},
      </if>
      <if test="memo != null" >
        #{memo,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="isDeleted != null" >
        #{isDeleted,jdbcType=INTEGER},
      </if>
      <if test="createBy != null" >
        #{createBy,jdbcType=BIGINT},
      </if>
      <if test="createDt != null" >
        #{createDt,jdbcType=TIMESTAMP},
      </if>
      <if test="updateBy != null" >
        #{updateBy,jdbcType=BIGINT},
      </if>
      <if test="updateDt != null" >
        #{updateDt,jdbcType=TIMESTAMP},
      </if>
      <if test="mimicBy != null" >
        #{mimicBy,jdbcType=BIGINT},
      </if>
      <if test="proxyBy != null" >
        #{proxyBy,jdbcType=BIGINT},
      </if>
      <if test="impDetailId != null" >
        #{impDetailId,jdbcType=BIGINT},
      </if>
      <if test="balanceDirection != null" >
        #{balanceDirection,jdbcType=CHAR},
      </if>
      <if test="protocolCode != null" >
        #{protocolCode,jdbcType=VARCHAR},
      </if>
      <if test="companyId != null" >
        #{companyId,jdbcType=BIGINT},
      </if>
    </trim>
  </insert>
  
  <insert id="insertOrUpdateList" parameterType="list">
	  <![CDATA[
		insert into ef_receipt_owned (
		  match_id, org_id, match_payer_id, 
	      match_amount, match_by, match_type, 
	      match_date, receipt_bank_id, receipt_bank_name, 
	      receipt_bank, receipt_bank_account_name, receipt_bank_account, 
	      trans_date, receipt_type, trans_id, 
	      pay_account_name, pay_account_no, amount, 
	      memo, status, is_deleted, 
	      create_by, create_dt, update_by, 
	      update_dt, mimic_by, proxy_by, 
	      imp_detail_id, balance_direction,protocol_code,
	      company_id
	    ) values 
   	  ]]>
		<foreach collection="list" item="item"  index="index" separator=",">
		  (#{item.matchId,jdbcType=BIGINT}, #{item.orgId,jdbcType=BIGINT}, #{item.matchPayerId,jdbcType=BIGINT}, 
	      #{item.matchAmount,jdbcType=DECIMAL}, #{item.matchBy,jdbcType=BIGINT}, #{item.matchType,jdbcType=INTEGER}, 
	      #{item.matchDate,jdbcType=DATE}, #{item.receiptBankId,jdbcType=BIGINT}, #{item.receiptBankName,jdbcType=VARCHAR}, 
	      #{item.receiptBank,jdbcType=VARCHAR}, #{item.receiptBankAccountName,jdbcType=VARCHAR}, #{item.receiptBankAccount,jdbcType=VARCHAR}, 
	      #{item.transDate,jdbcType=DATE}, #{item.receiptType,jdbcType=INTEGER}, #{item.transId,jdbcType=VARCHAR}, 
	      #{item.payAccountName,jdbcType=VARCHAR}, #{item.payAccountNo,jdbcType=VARCHAR}, #{item.amount,jdbcType=DECIMAL}, 
	      #{item.memo,jdbcType=VARCHAR}, #{item.status,jdbcType=INTEGER}, #{item.isDeleted,jdbcType=INTEGER}, 
	      #{item.createBy,jdbcType=BIGINT}, #{item.createDt,jdbcType=TIMESTAMP}, #{item.updateBy,jdbcType=BIGINT}, 
	      #{item.updateDt,jdbcType=TIMESTAMP}, #{item.mimicBy,jdbcType=BIGINT}, #{item.proxyBy,jdbcType=BIGINT}, 
	      #{item.impDetailId,jdbcType=BIGINT}, #{item.balanceDirection,jdbcType=CHAR}, #{item.protocolCode,jdbcType=VARCHAR}, 
	      #{item.companyId,jdbcType=BIGINT}
	      ) 
		</foreach>		
		ON DUPLICATE KEY UPDATE
		  match_id = values(match_id),
	      org_id = values(org_id),
	      match_payer_id = values(match_payer_id),
	      match_amount = values(match_amount),
	      match_by = values(match_by),
	      match_type = values(match_type),
	      match_date = values(match_date),
	      receipt_bank_id = values(receipt_bank_id),
	      receipt_bank_name = values(receipt_bank_name),
	      receipt_bank = values(receipt_bank),
	      receipt_bank_account_name = values(receipt_bank_account_name),
	      receipt_bank_account = values(receipt_bank_account),
	      trans_date = values(trans_date),
	      receipt_type = values(receipt_type),
	      trans_id = values(trans_id),
	      pay_account_name = values(pay_account_name),
	      pay_account_no = values(pay_account_no),
	      amount = values(amount),
	      memo = values(memo),
	      status = values(status),
	      is_deleted = values(is_deleted),
	      create_by = values(create_by),
	      create_dt = values(create_dt),
	      update_by = values(update_by),
	      update_dt = values(update_dt),
	      mimic_by = values(mimic_by),
	      proxy_by = values(proxy_by),
	      imp_detail_id = values(imp_detail_id),
	      balance_direction = values(balance_direction),
	      protocol_code = values(protocol_code),
	      company_id = values(company_id)
	</insert>
	
	<select id="queryAmountByYear" resultType="java.util.Map">
		SELECT DATE_FORMAT(trans_date,'%Y%m') ym, SUM(match_amount) amount  
		FROM ef_receipt_owned 
		WHERE is_deleted=0 and company_id=#{companyId,jdbcType=BIGINT} and 
			DATE_FORMAT(trans_date,'%Y')=#{year,jdbcType=VARCHAR} 
		GROUP BY DATE_FORMAT(trans_date,'%Y%m')
	</select>
	<select id="queryAmountBeforeYear" resultType="java.math.BigDecimal">
		SELECT SUM(match_amount) amount  
		FROM ef_receipt_owned 
		WHERE is_deleted=0 and company_id=#{companyId,jdbcType=BIGINT} and trans_date &lt; #{year,jdbcType=VARCHAR} 
	</select>
	
   <select id="queryReceiptOwnedList" resultMap="BaseResultMap" parameterType="java.util.HashMap" >
    select a.* from ef_receipt_owned a
    where a.is_deleted=0 and company_id=#{companyId} 
    <if test="ym != null" >
     AND DATE_FORMAT(trans_date,'%Y%m')=#{ym,jdbcType=VARCHAR} 
    </if> 
   	order by trans_date
  </select>
</mapper>