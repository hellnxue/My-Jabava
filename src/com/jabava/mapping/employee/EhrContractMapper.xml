<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jabava.dao.employee.EhrContractMapper" >
  <resultMap id="BaseResultMap" type="com.jabava.pojo.employee.EhrContract" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 13 19:57:44 CST 2016.
    -->
    <id column="contract_id" property="contractId" jdbcType="BIGINT" />
    <result column="person_id" property="personId" jdbcType="BIGINT" />
    <result column="contract_type" property="contractType" jdbcType="INTEGER" />
    <result column="contract_start_date" property="contractStartDate" jdbcType="DATE" />
    <result column="contract_end_date" property="contractEndDate" jdbcType="DATE" />
    <result column="trial_month" property="trialMonth" jdbcType="TINYINT" />
    <result column="contract_month" property="contractMonth" jdbcType="TINYINT" />
    <result column="contract_property" property="contractProperty" jdbcType="INTEGER" />
    <result column="memo" property="memo" jdbcType="VARCHAR" />
    <result column="create_user_id" property="createUserId" jdbcType="BIGINT" />
    <result column="create_user_name" property="createUserName" jdbcType="VARCHAR" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="last_modify_user_id" property="lastModifyUserId" jdbcType="BIGINT" />
    <result column="last_modify_user_name" property="lastModifyUserName" jdbcType="VARCHAR" />
    <result column="last_modify_date" property="lastModifyDate" jdbcType="TIMESTAMP" />
    <result column="old_expire_date" property="oldExpireDate" jdbcType="DATE" />
    <result column="flag" property="flag" jdbcType="TINYINT" />
    <result column="contract_subject" property="contractSubject" jdbcType="BIGINT" />
    <result column="jobNumber" property="jobNumber" jdbcType="VARCHAR" />
    <result column="employeeName" property="employeeName" jdbcType="VARCHAR" />
    <result column="mobile" property="mobile" jdbcType="VARCHAR" />
    <result column="email" property="email" jdbcType="VARCHAR" />
    <result column="org" property="org" jdbcType="VARCHAR" />
    <result column="post" property="post" jdbcType="VARCHAR" />
    <result column="contract_end_date1" property="contractEndDate1" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="WorkContractResult" type="com.jabava.pojo.employee.EhrContractVO"  extends="BaseResultMap">  
  	<association property="ehrOrganization" column="contract_subject" javaType="com.jabava.pojo.manage.EhrOrganization" resultMap="OrgResultMap"/>
   </resultMap>
  	<resultMap id="OrgResultMap" type="com.jabava.pojo.manage.EhrOrganization">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Dec 22 
			13:34:15 CST 2015. -->
		<id column="organization_id" property="organizationId" jdbcType="BIGINT" />
		<result column="company_id" property="companyId" jdbcType="BIGINT" />
		<result column="organization_code" property="organizationCode"
			jdbcType="VARCHAR" />
		<result column="total_organization_code" property="totalOrganizationCode"
			jdbcType="VARCHAR" />
		<result column="organization_name" property="organizationName"
			jdbcType="VARCHAR" />
		<result column="organization_level" property="organizationLevel"
			jdbcType="INTEGER" />
		<result column="parent_id" property="parentId" jdbcType="BIGINT" />
		<result column="memo" property="memo" jdbcType="VARCHAR" />
		<result column="create_user_id" property="createUserId"
			jdbcType="BIGINT" />
		<result column="create_user_name" property="createUserName"
			jdbcType="VARCHAR" />
		<result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
		<result column="last_modify_user_id" property="lastModifyUserId"
			jdbcType="BIGINT" />
		<result column="last_modify_user_name" property="lastModifyUserName"
			jdbcType="VARCHAR" />
		<result column="last_modify_date" property="lastModifyDate"
			jdbcType="TIMESTAMP" />
		<result column="sort" property="sort"
			jdbcType="INTEGER" />
	</resultMap>
  <sql id="Base_Column_List" >
    <!-- 
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 13 19:57:44 CST 2016.
    -->
    contract_id, person_id, contract_type, contract_start_date, contract_end_date, trial_month, 
    contract_month, contract_property, memo, create_user_id, create_user_name, create_date, 
    last_modify_user_id, last_modify_user_name, last_modify_date, old_expire_date, flag, 
    contract_subject
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 13 19:57:44 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from ehr_contract
    where contract_id = #{contractId,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 13 19:57:44 CST 2016.
    -->
    delete from ehr_contract
    where contract_id = #{contractId,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.jabava.pojo.employee.EhrContract" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 13 19:57:44 CST 2016.
    -->
    insert into ehr_contract (contract_id, person_id, contract_type, 
      contract_start_date, contract_end_date, trial_month, 
      contract_month, contract_property, memo, 
      create_user_id, create_user_name, create_date, 
      last_modify_user_id, last_modify_user_name, last_modify_date, 
      old_expire_date, flag, contract_subject
      )
    values (#{contractId,jdbcType=BIGINT}, #{personId,jdbcType=BIGINT}, #{contractType,jdbcType=VARCHAR}, 
      #{contractStartDate,jdbcType=DATE}, #{contractEndDate,jdbcType=DATE}, #{trialMonth,jdbcType=TINYINT}, 
      #{contractMonth,jdbcType=TINYINT}, #{contractProperty,jdbcType=VARCHAR}, #{memo,jdbcType=VARCHAR}, 
      #{createUserId,jdbcType=BIGINT}, #{createUserName,jdbcType=VARCHAR}, #{createDate,jdbcType=TIMESTAMP}, 
      #{lastModifyUserId,jdbcType=BIGINT}, #{lastModifyUserName,jdbcType=VARCHAR}, #{lastModifyDate,jdbcType=TIMESTAMP}, 
      #{oldExpireDate,jdbcType=DATE}, #{flag,jdbcType=TINYINT}, #{contractSubject,jdbcType=BIGINT}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.jabava.pojo.employee.EhrContract" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 13 19:57:44 CST 2016.
    -->
    insert into ehr_contract
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="contractId != null" >
        contract_id,
      </if>
      <if test="personId != null" >
        person_id,
      </if>
      <if test="contractType != null" >
        contract_type,
      </if>
      <if test="contractStartDate != null" >
        contract_start_date,
      </if>
      <if test="contractEndDate != null" >
        contract_end_date,
      </if>
      <if test="trialMonth != null" >
        trial_month,
      </if>
      <if test="contractMonth != null" >
        contract_month,
      </if>
      <if test="contractProperty != null" >
        contract_property,
      </if>
      <if test="memo != null" >
        memo,
      </if>
      <if test="createUserId != null" >
        create_user_id,
      </if>
      <if test="createUserName != null" >
        create_user_name,
      </if>
      <if test="createDate != null" >
        create_date,
      </if>
      <if test="lastModifyUserId != null" >
        last_modify_user_id,
      </if>
      <if test="lastModifyUserName != null" >
        last_modify_user_name,
      </if>
      <if test="lastModifyDate != null" >
        last_modify_date,
      </if>
      <if test="oldExpireDate != null" >
        old_expire_date,
      </if>
      <if test="flag != null" >
        flag,
      </if>
      <if test="contractSubject != null" >
        contract_subject,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="contractId != null" >
        #{contractId,jdbcType=BIGINT},
      </if>
      <if test="personId != null" >
        #{personId,jdbcType=BIGINT},
      </if>
      <if test="contractType != null" >
        #{contractType,jdbcType=VARCHAR},
      </if>
      <if test="contractStartDate != null" >
        #{contractStartDate,jdbcType=DATE},
      </if>
      <if test="contractEndDate != null" >
        #{contractEndDate,jdbcType=DATE},
      </if>
      <if test="trialMonth != null" >
        #{trialMonth,jdbcType=TINYINT},
      </if>
      <if test="contractMonth != null" >
        #{contractMonth,jdbcType=TINYINT},
      </if>
      <if test="contractProperty != null" >
        #{contractProperty,jdbcType=VARCHAR},
      </if>
      <if test="memo != null" >
        #{memo,jdbcType=VARCHAR},
      </if>
      <if test="createUserId != null" >
        #{createUserId,jdbcType=BIGINT},
      </if>
      <if test="createUserName != null" >
        #{createUserName,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastModifyUserId != null" >
        #{lastModifyUserId,jdbcType=BIGINT},
      </if>
      <if test="lastModifyUserName != null" >
        #{lastModifyUserName,jdbcType=VARCHAR},
      </if>
      <if test="lastModifyDate != null" >
        #{lastModifyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="oldExpireDate != null" >
        #{oldExpireDate,jdbcType=DATE},
      </if>
      <if test="flag != null" >
        #{flag,jdbcType=TINYINT},
      </if>
      <if test="contractSubject != null" >
        #{contractSubject,jdbcType=BIGINT},
      </if>
    </trim>
    <selectKey resultType="java.lang.Long" order="AFTER" keyProperty="contractId">  
    	SELECT LAST_INSERT_ID() AS ID  
    </selectKey>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.jabava.pojo.employee.EhrContract" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 13 19:57:44 CST 2016.
    -->
    update ehr_contract
    <set >
      <if test="personId != null" >
        person_id = #{personId,jdbcType=BIGINT},
      </if>
      <if test="contractType != null" >
        contract_type = #{contractType,jdbcType=VARCHAR},
      </if>
      <if test="contractStartDate != null" >
        contract_start_date = #{contractStartDate,jdbcType=DATE},
      </if>
      <if test="contractEndDate != null" >
        contract_end_date = #{contractEndDate,jdbcType=DATE},
      </if>
      <if test="trialMonth != null" >
        trial_month = #{trialMonth,jdbcType=TINYINT},
      </if>
      <if test="contractMonth != null" >
        contract_month = #{contractMonth,jdbcType=TINYINT},
      </if>
      <if test="contractProperty != null" >
        contract_property = #{contractProperty,jdbcType=VARCHAR},
      </if>
      <if test="memo != null" >
        memo = #{memo,jdbcType=VARCHAR},
      </if>
      <if test="createUserId != null" >
        create_user_id = #{createUserId,jdbcType=BIGINT},
      </if>
      <if test="createUserName != null" >
        create_user_name = #{createUserName,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastModifyUserId != null" >
        last_modify_user_id = #{lastModifyUserId,jdbcType=BIGINT},
      </if>
      <if test="lastModifyUserName != null" >
        last_modify_user_name = #{lastModifyUserName,jdbcType=VARCHAR},
      </if>
      <if test="lastModifyDate != null" >
        last_modify_date = #{lastModifyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="oldExpireDate != null" >
        old_expire_date = #{oldExpireDate,jdbcType=DATE},
      </if>
      <if test="flag != null" >
        flag = #{flag,jdbcType=TINYINT},
      </if>
      <if test="contractSubject != null" >
        contract_subject = #{contractSubject,jdbcType=BIGINT},
      </if>
    </set>
    where contract_id = #{contractId,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.jabava.pojo.employee.EhrContract" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 13 19:57:44 CST 2016.
    -->
    update ehr_contract
    set person_id = #{personId,jdbcType=BIGINT},
      contract_type = #{contractType,jdbcType=VARCHAR},
      contract_start_date = #{contractStartDate,jdbcType=DATE},
      contract_end_date = #{contractEndDate,jdbcType=DATE},
      trial_month = #{trialMonth,jdbcType=TINYINT},
      contract_month = #{contractMonth,jdbcType=TINYINT},
      contract_property = #{contractProperty,jdbcType=VARCHAR},
      memo = #{memo,jdbcType=VARCHAR},
      create_user_id = #{createUserId,jdbcType=BIGINT},
      create_user_name = #{createUserName,jdbcType=VARCHAR},
      create_date = #{createDate,jdbcType=TIMESTAMP},
      last_modify_user_id = #{lastModifyUserId,jdbcType=BIGINT},
      last_modify_user_name = #{lastModifyUserName,jdbcType=VARCHAR},
      last_modify_date = #{lastModifyDate,jdbcType=TIMESTAMP},
      old_expire_date = #{oldExpireDate,jdbcType=DATE},
      flag = #{flag,jdbcType=TINYINT},
      contract_subject = #{contractSubject,jdbcType=BIGINT}
    where contract_id = #{contractId,jdbcType=BIGINT}
  </update>
  
  	<select id="getByPersonId" resultMap="WorkContractResult" parameterType="java.lang.Long">
  		select
  		ehr_contract.contract_id, ehr_contract.person_id, ehr_contract.contract_type,
  		 ehr_contract.contract_start_date, ehr_contract.contract_end_date, ehr_contract.trial_month, 
    	ehr_contract.contract_month, ehr_contract.contract_property, ehr_contract.memo,
    	 ehr_contract.create_user_id, ehr_contract.create_user_name, ehr_contract.create_date, 
   		 ehr_contract.last_modify_user_id, ehr_contract.last_modify_user_name, 
   		 ehr_contract.last_modify_date, ehr_contract.old_expire_date, ehr_contract.flag, 
   		 ehr_contract.contract_subject,
  		ehr_organization.organization_name,
  		ehr_organization.organization_id
  		from ehr_contract
  		left join ehr_organization on
  		 ehr_contract.contract_subject =  ehr_organization.organization_id
  		 where ehr_contract.is_deleted=0 and  person_id=#{personId,jdbcType=BIGINT} 
  	</select>
  	
  	 <select id="searchContractList" resultMap="BaseResultMap"   parameterType="java.util.Map" >
  	   select ec.contract_id, ec.person_id,DATE_FORMAT(ec.contract_end_date, '%Y-%m-%d')contract_end_date1,eo.organization_name org,ebd.base_data_name post,ep.job_number jobNumber,ep.employee_name employeeName,ep.mobile mobile,ep.Email email   from ehr_contract ec 
		 left join ehr_person ep on ep.person_id = ec.person_id
		 left join ehr_organization eo on ep.organization_id=eo.organization_id
		 left join ehr_base_data ebd on ep.post_id=ebd.base_data_id
		 where
		 ${dateSql}
		 and ec.person_id in(select person_id from ehr_person where company_id =  8 
							 <if test="distinguish != null and distinguish != ''">
							 and organization_id in(select organization_id from ehr_organization where total_organization_code like CONCAT(CONCAT('%', #{distinguish, jdbcType=VARCHAR}), '%'))
							 </if>
							 and status = 0 
							${where}
							 )
  	  
  	</select> 
  	 <update id="updateFalg" parameterType="java.lang.Long" >
  	  update ehr_contract set flag = #{flag,jdbcType=TINYINT} where contract_id = #{contractId,jdbcType=BIGINT}
  	 </update>
</mapper>