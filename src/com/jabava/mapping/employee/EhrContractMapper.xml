<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jabava.dao.employee.EhrContractMapper" >
  <resultMap id="BaseResultMap" type="com.jabava.pojo.employee.EhrContract" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 27 13:28:57 CST 2016.
    -->
    <id column="contract_id" property="contractId" jdbcType="BIGINT" />
    <result column="person_id" property="personId" jdbcType="BIGINT" />
    <result column="contract_type" property="contractType" jdbcType="VARCHAR" />
    <result column="contract_bussiness_type" property="contractBussinessType" jdbcType="VARCHAR" />
    <result column="contract_deadline_type" property="contractDeadlineType" jdbcType="VARCHAR" />
    <result column="contract_sign_date" property="contractSignDate" jdbcType="DATE" />
    <result column="contract_main_unit" property="contractMainUnit" jdbcType="VARCHAR" />
    <result column="contract_start_date" property="contractStartDate" jdbcType="DATE" />
    <result column="contract_end_date" property="contractEndDate" jdbcType="DATE" />
    <result column="trial_month" property="trialMonth" jdbcType="INTEGER" />
    <result column="contract_month" property="contractMonth" jdbcType="TINYINT" />
    <result column="plan_positive_date" property="planPositiveDate" jdbcType="DATE" />
    <result column="fact_positive_date" property="factPositiveDate" jdbcType="DATE" />
    <result column="trial_salary" property="trialSalary" jdbcType="DECIMAL" />
    <result column="positive_salary" property="positiveSalary" jdbcType="DECIMAL" />
    <result column="continue_time" property="continueTime" jdbcType="INTEGER" />
    <result column="is_trial" property="isTrial" jdbcType="VARCHAR" />
    <result column="memo" property="memo" jdbcType="VARCHAR" />
    <result column="create_user_id" property="createUserId" jdbcType="BIGINT" />
    <result column="create_user_name" property="createUserName" jdbcType="VARCHAR" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="last_modify_user_id" property="lastModifyUserId" jdbcType="BIGINT" />
    <result column="last_modify_user_name" property="lastModifyUserName" jdbcType="VARCHAR" />
    <result column="last_modify_date" property="lastModifyDate" jdbcType="TIMESTAMP" />
    <result column="old_expire_date" property="oldExpireDate" jdbcType="DATE" />
    <result column="flag" property="flag" jdbcType="TINYINT" />
    <result column="contract_subject" property="contractSubject" jdbcType="BIGINT" />
    <result column="is_deleted" property="isDeleted" jdbcType="INTEGER" />
  </resultMap>
   <resultMap id="linkedHashMap" type="java.util.LinkedHashMap"></resultMap>
   <resultMap id="WorkContractResult" type="com.jabava.pojo.employee.EhrContractVO"  extends="BaseResultMap">  
  	<association property="ehrOrganization" column="contract_subject" javaType="com.jabava.pojo.manage.EhrOrganization" resultMap="OrgResultMap"/>
   </resultMap>
  	<resultMap id="OrgResultMap" type="com.jabava.pojo.manage.EhrOrganization">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Dec 22 
			13:34:15 CST 2015. -->
		<id column="organization_id" property="organizationId" jdbcType="BIGINT" />
		<result column="company_id" property="companyId" jdbcType="BIGINT" />
		<result column="organization_code" property="organizationCode"
			jdbcType="VARCHAR" />
		<result column="total_organization_code" property="totalOrganizationCode"
			jdbcType="VARCHAR" />
		<result column="organization_name" property="organizationName"
			jdbcType="VARCHAR" />
		<result column="organization_level" property="organizationLevel"
			jdbcType="INTEGER" />
		<result column="parent_id" property="parentId" jdbcType="BIGINT" />
		<result column="memo" property="memo" jdbcType="VARCHAR" />
		<result column="create_user_id" property="createUserId"
			jdbcType="BIGINT" />
		<result column="create_user_name" property="createUserName"
			jdbcType="VARCHAR" />
		<result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
		<result column="last_modify_user_id" property="lastModifyUserId"
			jdbcType="BIGINT" />
		<result column="last_modify_user_name" property="lastModifyUserName"
			jdbcType="VARCHAR" />
		<result column="last_modify_date" property="lastModifyDate"
			jdbcType="TIMESTAMP" />
		<result column="sort" property="sort"
			jdbcType="INTEGER" />
	</resultMap>
  
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 27 13:28:57 CST 2016.
    -->
    contract_id, person_id, contract_type, contract_bussiness_type, contract_deadline_type, 
    contract_sign_date, contract_main_unit, contract_start_date, contract_end_date, trial_month, 
    contract_month, plan_positive_date, fact_positive_date, trial_salary, positive_salary, 
    continue_time, is_trial, memo, create_user_id, create_user_name, create_date, last_modify_user_id, 
    last_modify_user_name, last_modify_date, old_expire_date, flag, contract_subject, 
    is_deleted
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 27 13:28:57 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from ehr_contract
    where contract_id = #{contractId,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 27 13:28:57 CST 2016.
    -->
    delete from ehr_contract
    where contract_id = #{contractId,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.jabava.pojo.employee.EhrContract" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 27 13:28:57 CST 2016.
    -->
    insert into ehr_contract (contract_id, person_id, contract_type, 
      contract_bussiness_type, contract_deadline_type, 
      contract_sign_date, contract_main_unit, contract_start_date, 
      contract_end_date, trial_month, contract_month, 
      plan_positive_date, fact_positive_date, trial_salary, 
      positive_salary, continue_time, is_trial, 
      memo, create_user_id, create_user_name, 
      create_date, last_modify_user_id, last_modify_user_name, 
      last_modify_date, old_expire_date, flag, 
      contract_subject, is_deleted)
    values (#{contractId,jdbcType=BIGINT}, #{personId,jdbcType=BIGINT}, #{contractType,jdbcType=VARCHAR}, 
      #{contractBussinessType,jdbcType=VARCHAR}, #{contractDeadlineType,jdbcType=VARCHAR}, 
      #{contractSignDate,jdbcType=DATE}, #{contractMainUnit,jdbcType=VARCHAR}, #{contractStartDate,jdbcType=DATE}, 
      #{contractEndDate,jdbcType=DATE}, #{trialMonth,jdbcType=INTEGER}, #{contractMonth,jdbcType=TINYINT}, 
      #{planPositiveDate,jdbcType=DATE}, #{factPositiveDate,jdbcType=DATE}, #{trialSalary,jdbcType=DECIMAL}, 
      #{positiveSalary,jdbcType=DECIMAL}, #{continueTime,jdbcType=INTEGER}, #{isTrial,jdbcType=VARCHAR}, 
      #{memo,jdbcType=VARCHAR}, #{createUserId,jdbcType=BIGINT}, #{createUserName,jdbcType=VARCHAR}, 
      #{createDate,jdbcType=TIMESTAMP}, #{lastModifyUserId,jdbcType=BIGINT}, #{lastModifyUserName,jdbcType=VARCHAR}, 
      #{lastModifyDate,jdbcType=TIMESTAMP}, #{oldExpireDate,jdbcType=DATE}, #{flag,jdbcType=TINYINT}, 
      #{contractSubject,jdbcType=BIGINT}, #{isDeleted,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.jabava.pojo.employee.EhrContract" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 27 13:28:57 CST 2016.
    -->
    insert into ehr_contract
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="contractId != null" >
        contract_id,
      </if>
      <if test="personId != null" >
        person_id,
      </if>
      <if test="contractType != null" >
        contract_type,
      </if>
      <if test="contractBussinessType != null" >
        contract_bussiness_type,
      </if>
      <if test="contractDeadlineType != null" >
        contract_deadline_type,
      </if>
      <if test="contractSignDate != null" >
        contract_sign_date,
      </if>
      <if test="contractMainUnit != null" >
        contract_main_unit,
      </if>
      <if test="contractStartDate != null" >
        contract_start_date,
      </if>
      <if test="contractEndDate != null" >
        contract_end_date,
      </if>
      <if test="trialMonth != null" >
        trial_month,
      </if>
      <if test="contractMonth != null" >
        contract_month,
      </if>
      <if test="planPositiveDate != null" >
        plan_positive_date,
      </if>
      <if test="factPositiveDate != null" >
        fact_positive_date,
      </if>
      <if test="trialSalary != null" >
        trial_salary,
      </if>
      <if test="positiveSalary != null" >
        positive_salary,
      </if>
      <if test="continueTime != null" >
        continue_time,
      </if>
      <if test="isTrial != null" >
        is_trial,
      </if>
      <if test="memo != null" >
        memo,
      </if>
      <if test="createUserId != null" >
        create_user_id,
      </if>
      <if test="createUserName != null" >
        create_user_name,
      </if>
      <if test="createDate != null" >
        create_date,
      </if>
      <if test="lastModifyUserId != null" >
        last_modify_user_id,
      </if>
      <if test="lastModifyUserName != null" >
        last_modify_user_name,
      </if>
      <if test="lastModifyDate != null" >
        last_modify_date,
      </if>
      <if test="oldExpireDate != null" >
        old_expire_date,
      </if>
      <if test="flag != null" >
        flag,
      </if>
      <if test="contractSubject != null" >
        contract_subject,
      </if>
      <if test="isDeleted != null" >
        is_deleted,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="contractId != null" >
        #{contractId,jdbcType=BIGINT},
      </if>
      <if test="personId != null" >
        #{personId,jdbcType=BIGINT},
      </if>
      <if test="contractType != null" >
        #{contractType,jdbcType=VARCHAR},
      </if>
      <if test="contractBussinessType != null" >
        #{contractBussinessType,jdbcType=VARCHAR},
      </if>
      <if test="contractDeadlineType != null" >
        #{contractDeadlineType,jdbcType=VARCHAR},
      </if>
      <if test="contractSignDate != null" >
        #{contractSignDate,jdbcType=DATE},
      </if>
      <if test="contractMainUnit != null" >
        #{contractMainUnit,jdbcType=VARCHAR},
      </if>
      <if test="contractStartDate != null" >
        #{contractStartDate,jdbcType=DATE},
      </if>
      <if test="contractEndDate != null" >
        #{contractEndDate,jdbcType=DATE},
      </if>
      <if test="trialMonth != null" >
        #{trialMonth,jdbcType=INTEGER},
      </if>
      <if test="contractMonth != null" >
        #{contractMonth,jdbcType=TINYINT},
      </if>
      <if test="planPositiveDate != null" >
        #{planPositiveDate,jdbcType=DATE},
      </if>
      <if test="factPositiveDate != null" >
        #{factPositiveDate,jdbcType=DATE},
      </if>
      <if test="trialSalary != null" >
        #{trialSalary,jdbcType=DECIMAL},
      </if>
      <if test="positiveSalary != null" >
        #{positiveSalary,jdbcType=DECIMAL},
      </if>
      <if test="continueTime != null" >
        #{continueTime,jdbcType=INTEGER},
      </if>
      <if test="isTrial != null" >
        #{isTrial,jdbcType=VARCHAR},
      </if>
      <if test="memo != null" >
        #{memo,jdbcType=VARCHAR},
      </if>
      <if test="createUserId != null" >
        #{createUserId,jdbcType=BIGINT},
      </if>
      <if test="createUserName != null" >
        #{createUserName,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastModifyUserId != null" >
        #{lastModifyUserId,jdbcType=BIGINT},
      </if>
      <if test="lastModifyUserName != null" >
        #{lastModifyUserName,jdbcType=VARCHAR},
      </if>
      <if test="lastModifyDate != null" >
        #{lastModifyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="oldExpireDate != null" >
        #{oldExpireDate,jdbcType=DATE},
      </if>
      <if test="flag != null" >
        #{flag,jdbcType=TINYINT},
      </if>
      <if test="contractSubject != null" >
        #{contractSubject,jdbcType=BIGINT},
      </if>
      <if test="isDeleted != null" >
        #{isDeleted,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.jabava.pojo.employee.EhrContract" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 27 13:28:57 CST 2016.
    -->
    update ehr_contract
    <set >
      <if test="personId != null" >
        person_id = #{personId,jdbcType=BIGINT},
      </if>
      <if test="contractType != null" >
        contract_type = #{contractType,jdbcType=VARCHAR},
      </if>
      <if test="contractBussinessType != null" >
        contract_bussiness_type = #{contractBussinessType,jdbcType=VARCHAR},
      </if>
      <if test="contractDeadlineType != null" >
        contract_deadline_type = #{contractDeadlineType,jdbcType=VARCHAR},
      </if>
      <if test="contractSignDate != null" >
        contract_sign_date = #{contractSignDate,jdbcType=DATE},
      </if>
      <if test="contractMainUnit != null" >
        contract_main_unit = #{contractMainUnit,jdbcType=VARCHAR},
      </if>
      <if test="contractStartDate != null" >
        contract_start_date = #{contractStartDate,jdbcType=DATE},
      </if>
      <if test="contractEndDate != null" >
        contract_end_date = #{contractEndDate,jdbcType=DATE},
      </if>
      <if test="trialMonth != null" >
        trial_month = #{trialMonth,jdbcType=INTEGER},
      </if>
      <if test="contractMonth != null" >
        contract_month = #{contractMonth,jdbcType=TINYINT},
      </if>
      <if test="planPositiveDate != null" >
        plan_positive_date = #{planPositiveDate,jdbcType=DATE},
      </if>
      <if test="factPositiveDate != null" >
        fact_positive_date = #{factPositiveDate,jdbcType=DATE},
      </if>
      <if test="trialSalary != null" >
        trial_salary = #{trialSalary,jdbcType=DECIMAL},
      </if>
      <if test="positiveSalary != null" >
        positive_salary = #{positiveSalary,jdbcType=DECIMAL},
      </if>
      <if test="continueTime != null" >
        continue_time = #{continueTime,jdbcType=INTEGER},
      </if>
      <if test="isTrial != null" >
        is_trial = #{isTrial,jdbcType=VARCHAR},
      </if>
      <if test="memo != null" >
        memo = #{memo,jdbcType=VARCHAR},
      </if>
      <if test="createUserId != null" >
        create_user_id = #{createUserId,jdbcType=BIGINT},
      </if>
      <if test="createUserName != null" >
        create_user_name = #{createUserName,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastModifyUserId != null" >
        last_modify_user_id = #{lastModifyUserId,jdbcType=BIGINT},
      </if>
      <if test="lastModifyUserName != null" >
        last_modify_user_name = #{lastModifyUserName,jdbcType=VARCHAR},
      </if>
      <if test="lastModifyDate != null" >
        last_modify_date = #{lastModifyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="oldExpireDate != null" >
        old_expire_date = #{oldExpireDate,jdbcType=DATE},
      </if>
      <if test="flag != null" >
        flag = #{flag,jdbcType=TINYINT},
      </if>
      <if test="contractSubject != null" >
        contract_subject = #{contractSubject,jdbcType=BIGINT},
      </if>
      <if test="isDeleted != null" >
        is_deleted = #{isDeleted,jdbcType=INTEGER},
      </if>
    </set>
    where contract_id = #{contractId,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.jabava.pojo.employee.EhrContract" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 27 13:28:57 CST 2016.
    -->
    update ehr_contract
    set person_id = #{personId,jdbcType=BIGINT},
      contract_type = #{contractType,jdbcType=VARCHAR},
      contract_bussiness_type = #{contractBussinessType,jdbcType=VARCHAR},
      contract_deadline_type = #{contractDeadlineType,jdbcType=VARCHAR},
      contract_sign_date = #{contractSignDate,jdbcType=DATE},
      contract_main_unit = #{contractMainUnit,jdbcType=VARCHAR},
      contract_start_date = #{contractStartDate,jdbcType=DATE},
      contract_end_date = #{contractEndDate,jdbcType=DATE},
      trial_month = #{trialMonth,jdbcType=INTEGER},
      contract_month = #{contractMonth,jdbcType=TINYINT},
      plan_positive_date = #{planPositiveDate,jdbcType=DATE},
      fact_positive_date = #{factPositiveDate,jdbcType=DATE},
      trial_salary = #{trialSalary,jdbcType=DECIMAL},
      positive_salary = #{positiveSalary,jdbcType=DECIMAL},
      continue_time = #{continueTime,jdbcType=INTEGER},
      is_trial = #{isTrial,jdbcType=VARCHAR},
      memo = #{memo,jdbcType=VARCHAR},
      create_user_id = #{createUserId,jdbcType=BIGINT},
      create_user_name = #{createUserName,jdbcType=VARCHAR},
      create_date = #{createDate,jdbcType=TIMESTAMP},
      last_modify_user_id = #{lastModifyUserId,jdbcType=BIGINT},
      last_modify_user_name = #{lastModifyUserName,jdbcType=VARCHAR},
      last_modify_date = #{lastModifyDate,jdbcType=TIMESTAMP},
      old_expire_date = #{oldExpireDate,jdbcType=DATE},
      flag = #{flag,jdbcType=TINYINT},
      contract_subject = #{contractSubject,jdbcType=BIGINT},
      is_deleted = #{isDeleted,jdbcType=INTEGER}
    where contract_id = #{contractId,jdbcType=BIGINT}
  </update>
  <select id="getByPersonId" resultMap="WorkContractResult" parameterType="java.lang.Long">
  		select
  		ehr_contract.contract_id, ehr_contract.person_id, ehr_contract.contract_type,
  		 ehr_contract.contract_start_date, ehr_contract.contract_end_date, ehr_contract.trial_month, 
    	ehr_contract.contract_month, ehr_contract.contract_property, ehr_contract.memo,
    	 ehr_contract.create_user_id, ehr_contract.create_user_name, ehr_contract.create_date, 
   		 ehr_contract.last_modify_user_id, ehr_contract.last_modify_user_name, 
   		 ehr_contract.last_modify_date, ehr_contract.old_expire_date, ehr_contract.flag, 
   		 ehr_contract.contract_subject,
  		ehr_organization.organization_name,
  		ehr_organization.organization_id
  		from ehr_contract
  		left join ehr_organization on
  		 ehr_contract.contract_subject =  ehr_organization.organization_id
  		 where ehr_contract.is_deleted=0 and  person_id=#{personId,jdbcType=BIGINT} 
  	</select>
  	
  	 <select id="searchContractList" resultMap="BaseResultMap"   parameterType="java.util.Map" >
  	   select ec.contract_id, ec.person_id,DATE_FORMAT(ec.contract_end_date, '%Y-%m-%d')contract_end_date1,eo.organization_name org,ebd.base_data_name post,ep.job_number jobNumber,ep.employee_name employeeName,ep.mobile mobile,ep.Email email   from ehr_contract ec 
		 left join ehr_person ep on ep.person_id = ec.person_id
		 left join ehr_organization eo on ep.organization_id=eo.organization_id
		 left join ehr_base_data ebd on ep.post_id=ebd.base_data_id
		 where
		 	${dateSql}
		 	and ec.person_id in(select person_id from ehr_person where company_id=#{companyId,jdbcType=BIGINT} 
				<if test="distinguish != null and distinguish != ''">
				 	and organization_id in(select organization_id from ehr_organization where total_organization_code like CONCAT(CONCAT('%', #{distinguish, jdbcType=VARCHAR}), '%'))
				</if>
				and status = 0 
				${where}
				)
  	  		${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("ec.person_id")}
  	</select> 
  	 <update id="updateFalg" parameterType="java.lang.Long" >
  	  update ehr_contract set flag = #{flag,jdbcType=TINYINT} where contract_id = #{contractId,jdbcType=BIGINT}
  	  	${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("person_id")}
  	 </update>
  	 
  	 <!-- 根据合同类型（劳动合同）和业务类型（签订）取最新的合同记录 -->
  	<select id="getContractInfoByPersonID" resultMap="linkedHashMap"  	parameterType="java.util.HashMap">
     
	select contract.contract_id contractID,contract.is_trial isTrial,contract.fact_positive_date  factPositiveDate, contract.plan_positive_date planPositiveDate,org.organization_name orgName,person.post_id position,person.employee_name name,person.mobile mobile,contract.last_modify_date
	
	from ehr_contract contract 
	
	LEFT JOIN ehr_person person on contract.person_id=person.person_id
	
	left join ehr_organization org on org.organization_id=person.organization_id
	
	where 
	
	contract.is_deleted=0 and  contract.contract_type=#{contractType}   and contract.person_id=#{personID} 
	
	ORDER BY contract.last_modify_date desc  LIMIT 0,1
	
  </select>
  
   <!-- 根据personID获取所有的合同信息 -->
  	<select id="getAllContractInfoByPersonID" resultMap="BaseResultMap" parameterType="java.lang.Long">
     
	select 
	
	<include refid="Base_Column_List" />
	
	from ehr_contract ct 
	
	where  ct.is_deleted=0 and ct.person_id=#{personId,jdbcType=BIGINT}
	
  </select>
  	 
</mapper>