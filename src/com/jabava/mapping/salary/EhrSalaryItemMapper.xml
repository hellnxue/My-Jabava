<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jabava.dao.salary.EhrSalaryItemMapper" >
  <resultMap id="BaseResultMap" type="com.jabava.pojo.salary.EhrSalaryItem" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Mar 21 14:16:54 CST 2016.
    -->
    <id column="salary_item_id" property="salaryItemId" jdbcType="BIGINT" />
    <result column="company_id" property="companyId" jdbcType="BIGINT" />
    <result column="salary_item_name" property="salaryItemName" jdbcType="VARCHAR" />
    <result column="salary_change_def_id" property="salaryChangeDefId" jdbcType="BIGINT" />
    <result column="salary_change_def_name" property="salaryChangeDefName" jdbcType="VARCHAR" /><!-- 关联到工资变动定义表 -->
    <result column="change_table_name" property="changeTableName" jdbcType="VARCHAR" />
    <result column="is_transition" property="isTransition" jdbcType="BIT" />
    <result column="tax_rule" property="taxRule" jdbcType="INTEGER" />
    <result column="tax_rate_id" property="taxRateId" jdbcType="BIGINT" />
    <result column="calculate_rule" property="calculateRule" jdbcType="INTEGER" />
    <result column="item_type" property="itemType" jdbcType="INTEGER" />
    <result column="change_formula" property="changeFormula" jdbcType="VARCHAR" />
    <result column="item_memo" property="itemMemo" jdbcType="VARCHAR" />
    <result column="display_order" property="displayOrder" jdbcType="INTEGER" />
    <result column="yearly_flag" property="yearlyFlag" jdbcType="INTEGER" />
    <result column="create_user_id" property="createUserId" jdbcType="BIGINT" />
    <result column="create_user_name" property="createUserName" jdbcType="VARCHAR" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="last_modify_user_id" property="lastModifyUserId" jdbcType="BIGINT" />
    <result column="last_modify_user_name" property="lastModifyUserName" jdbcType="VARCHAR" />
    <result column="last_modify_date" property="lastModifyDate" jdbcType="TIMESTAMP" />
    <result column="is_salary_slip_item" property="isSalarySlipItem" jdbcType="BIT" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Mar 21 14:16:54 CST 2016.
    -->
    salary_item_id, company_id, salary_item_name, salary_change_def_id, change_table_name, 
    is_transition, tax_rule, tax_rate_id, calculate_rule, item_type, change_formula, 
    item_memo, display_order, yearly_flag, create_user_id, create_user_name, create_date, 
    last_modify_user_id, last_modify_user_name, last_modify_date, is_salary_slip_item
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Mar 21 14:16:54 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from ehr_salary_item
    where salary_item_id = #{salaryItemId,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Mar 21 14:16:54 CST 2016.
    -->
    delete from ehr_salary_item
    where salary_item_id = #{salaryItemId,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.jabava.pojo.salary.EhrSalaryItem" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Mar 21 14:16:54 CST 2016.
    -->
    insert into ehr_salary_item (salary_item_id, company_id, salary_item_name, 
      salary_change_def_id, change_table_name, is_transition, 
      tax_rule, tax_rate_id, calculate_rule, 
      item_type, change_formula, item_memo, 
      display_order, yearly_flag, create_user_id, 
      create_user_name, create_date, last_modify_user_id, 
      last_modify_user_name, last_modify_date, is_salary_slip_item)
    values (#{salaryItemId,jdbcType=BIGINT}, #{companyId,jdbcType=BIGINT}, #{salaryItemName,jdbcType=VARCHAR}, 
      #{salaryChangeDefId,jdbcType=BIGINT}, #{changeTableName,jdbcType=VARCHAR}, #{isTransition,jdbcType=BIT}, 
      #{taxRule,jdbcType=INTEGER}, #{taxRateId,jdbcType=BIGINT}, #{calculateRule,jdbcType=INTEGER}, 
      #{itemType,jdbcType=INTEGER}, #{changeFormula,jdbcType=VARCHAR}, #{itemMemo,jdbcType=VARCHAR}, 
      #{displayOrder,jdbcType=INTEGER}, #{yearlyFlag,jdbcType=INTEGER}, #{createUserId,jdbcType=BIGINT}, 
      #{createUserName,jdbcType=VARCHAR}, #{createDate,jdbcType=TIMESTAMP}, #{lastModifyUserId,jdbcType=BIGINT}, 
      #{lastModifyUserName,jdbcType=VARCHAR}, #{lastModifyDate,jdbcType=TIMESTAMP}, #{isSalarySlipItem,jdbcType=BIT})
  </insert>
  <insert id="insertSelective" parameterType="com.jabava.pojo.salary.EhrSalaryItem" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Mar 21 14:16:54 CST 2016.
    -->
    insert into ehr_salary_item
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="salaryItemId != null" >
        salary_item_id,
      </if>
      <if test="companyId != null" >
        company_id,
      </if>
      <if test="salaryItemName != null" >
        salary_item_name,
      </if>
      <if test="salaryChangeDefId != null" >
        salary_change_def_id,
      </if>
      <if test="changeTableName != null" >
        change_table_name,
      </if>
      <if test="isTransition != null" >
        is_transition,
      </if>
      <if test="taxRule != null" >
        tax_rule,
      </if>
      <if test="taxRateId != null" >
        tax_rate_id,
      </if>
      <if test="calculateRule != null" >
        calculate_rule,
      </if>
      <if test="itemType != null" >
        item_type,
      </if>
      <if test="changeFormula != null" >
        change_formula,
      </if>
      <if test="itemMemo != null" >
        item_memo,
      </if>
      <if test="displayOrder != null" >
        display_order,
      </if>
      <if test="yearlyFlag != null" >
        yearly_flag,
      </if>
      <if test="createUserId != null" >
        create_user_id,
      </if>
      <if test="createUserName != null" >
        create_user_name,
      </if>
      <if test="createDate != null" >
        create_date,
      </if>
      <if test="lastModifyUserId != null" >
        last_modify_user_id,
      </if>
      <if test="lastModifyUserName != null" >
        last_modify_user_name,
      </if>
      <if test="lastModifyDate != null" >
        last_modify_date,
      </if>
      <if test="isSalarySlipItem != null" >
        is_salary_slip_item,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="salaryItemId != null" >
        #{salaryItemId,jdbcType=BIGINT},
      </if>
      <if test="companyId != null" >
        #{companyId,jdbcType=BIGINT},
      </if>
      <if test="salaryItemName != null" >
        #{salaryItemName,jdbcType=VARCHAR},
      </if>
      <if test="salaryChangeDefId != null" >
        #{salaryChangeDefId,jdbcType=BIGINT},
      </if>
      <if test="changeTableName != null" >
        #{changeTableName,jdbcType=VARCHAR},
      </if>
      <if test="isTransition != null" >
        #{isTransition,jdbcType=BIT},
      </if>
      <if test="taxRule != null" >
        #{taxRule,jdbcType=INTEGER},
      </if>
      <if test="taxRateId != null" >
        #{taxRateId,jdbcType=BIGINT},
      </if>
      <if test="calculateRule != null" >
        #{calculateRule,jdbcType=INTEGER},
      </if>
      <if test="itemType != null" >
        #{itemType,jdbcType=INTEGER},
      </if>
      <if test="changeFormula != null" >
        #{changeFormula,jdbcType=VARCHAR},
      </if>
      <if test="itemMemo != null" >
        #{itemMemo,jdbcType=VARCHAR},
      </if>
      <if test="displayOrder != null" >
        #{displayOrder,jdbcType=INTEGER},
      </if>
      <if test="yearlyFlag != null" >
        #{yearlyFlag,jdbcType=INTEGER},
      </if>
      <if test="createUserId != null" >
        #{createUserId,jdbcType=BIGINT},
      </if>
      <if test="createUserName != null" >
        #{createUserName,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastModifyUserId != null" >
        #{lastModifyUserId,jdbcType=BIGINT},
      </if>
      <if test="lastModifyUserName != null" >
        #{lastModifyUserName,jdbcType=VARCHAR},
      </if>
      <if test="lastModifyDate != null" >
        #{lastModifyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isSalarySlipItem != null" >
        #{isSalarySlipItem,jdbcType=BIT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.jabava.pojo.salary.EhrSalaryItem" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Mar 21 14:16:54 CST 2016.
    -->
    update ehr_salary_item
    <set >
      <if test="companyId != null" >
        company_id = #{companyId,jdbcType=BIGINT},
      </if>
      <if test="salaryItemName != null" >
        salary_item_name = #{salaryItemName,jdbcType=VARCHAR},
      </if>
      <if test="salaryChangeDefId != null" >
        salary_change_def_id = #{salaryChangeDefId,jdbcType=BIGINT},
      </if>
      <if test="changeTableName != null" >
        change_table_name = #{changeTableName,jdbcType=VARCHAR},
      </if>
      <if test="isTransition != null" >
        is_transition = #{isTransition,jdbcType=BIT},
      </if>
      <if test="taxRule != null" >
        tax_rule = #{taxRule,jdbcType=INTEGER},
      </if>
      <if test="taxRateId != null" >
        tax_rate_id = #{taxRateId,jdbcType=BIGINT},
      </if>
      <if test="calculateRule != null" >
        calculate_rule = #{calculateRule,jdbcType=INTEGER},
      </if>
      <if test="itemType != null" >
        item_type = #{itemType,jdbcType=INTEGER},
      </if>
      <if test="changeFormula != null" >
        change_formula = #{changeFormula,jdbcType=VARCHAR},
      </if>
      <if test="itemMemo != null" >
        item_memo = #{itemMemo,jdbcType=VARCHAR},
      </if>
      <if test="displayOrder != null" >
        display_order = #{displayOrder,jdbcType=INTEGER},
      </if>
      <if test="yearlyFlag != null" >
        yearly_flag = #{yearlyFlag,jdbcType=INTEGER},
      </if>
      <if test="createUserId != null" >
        create_user_id = #{createUserId,jdbcType=BIGINT},
      </if>
      <if test="createUserName != null" >
        create_user_name = #{createUserName,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastModifyUserId != null" >
        last_modify_user_id = #{lastModifyUserId,jdbcType=BIGINT},
      </if>
      <if test="lastModifyUserName != null" >
        last_modify_user_name = #{lastModifyUserName,jdbcType=VARCHAR},
      </if>
      <if test="lastModifyDate != null" >
        last_modify_date = #{lastModifyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isSalarySlipItem != null" >
        is_salary_slip_item = #{isSalarySlipItem,jdbcType=BIT},
      </if>
    </set>
    where salary_item_id = #{salaryItemId,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.jabava.pojo.salary.EhrSalaryItem" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Mar 21 14:16:54 CST 2016.
    -->
    update ehr_salary_item
    set company_id = #{companyId,jdbcType=BIGINT},
      salary_item_name = #{salaryItemName,jdbcType=VARCHAR},
      salary_change_def_id = #{salaryChangeDefId,jdbcType=BIGINT},
      change_table_name = #{changeTableName,jdbcType=VARCHAR},
      is_transition = #{isTransition,jdbcType=BIT},
      tax_rule = #{taxRule,jdbcType=INTEGER},
      tax_rate_id = #{taxRateId,jdbcType=BIGINT},
      calculate_rule = #{calculateRule,jdbcType=INTEGER},
      item_type = #{itemType,jdbcType=INTEGER},
      change_formula = #{changeFormula,jdbcType=VARCHAR},
      item_memo = #{itemMemo,jdbcType=VARCHAR},
      display_order = #{displayOrder,jdbcType=INTEGER},
      yearly_flag = #{yearlyFlag,jdbcType=INTEGER},
      create_user_id = #{createUserId,jdbcType=BIGINT},
      create_user_name = #{createUserName,jdbcType=VARCHAR},
      create_date = #{createDate,jdbcType=TIMESTAMP},
      last_modify_user_id = #{lastModifyUserId,jdbcType=BIGINT},
      last_modify_user_name = #{lastModifyUserName,jdbcType=VARCHAR},
      last_modify_date = #{lastModifyDate,jdbcType=TIMESTAMP},
      is_salary_slip_item = #{isSalarySlipItem,jdbcType=BIT}
    where salary_item_id = #{salaryItemId,jdbcType=BIGINT}
  </update>
  
  <select id="listSalaryItemPage" resultMap="BaseResultMap">
  	select item.*,def.name salary_change_def_name
  	from ehr_salary_item item left join ehr_salary_change_def def on item.salary_change_def_id=def.salary_change_def_id
  	where item.company_id=#{companyId,jdbcType=BIGINT}
  	<if test="salaryItemName != null and salaryItemName != ''" >
  		and item.salary_item_name like CONCAT('%',#{salaryItemName },'%' ) 
  	</if>
  	<if test="calculateRule != null" >
  		and item.calculate_rule=#{calculateRule } 
  	</if>
  	<if test="itemType != null" >
  		and item.item_type=#{itemType } 
  	</if>
  	<if test="isTransition != null" >
  		and item.is_transition=#{isTransition } 
  	</if>
  	<!-- or def.name like CONCAT('%',#{search,jdbcType=VARCHAR},'%' ) -->
  	<if test="search != null and search != ''" >
  		and (item.salary_item_name like CONCAT('%',#{search,jdbcType=VARCHAR},'%' ) 
  			 or item.change_formula like CONCAT('%',#{search,jdbcType=VARCHAR},'%' ) 
  			)
  	</if>
  	order by display_order
  </select>
  <select id="listSalaryItem" resultMap="BaseResultMap">
  	select item.*,def.name salary_change_def_name
  	from ehr_salary_item item left join ehr_salary_change_def def on item.salary_change_def_id=def.salary_change_def_id
  	where item.company_id=#{companyId,jdbcType=BIGINT}
  	order by display_order
  </select>
  <delete id="deleteById">
  	delete from ehr_salary_item
    where company_id=#{companyId,jdbcType=BIGINT} and salary_item_id = #{salaryItemId,jdbcType=BIGINT}
  </delete>
  <select id="selectByName" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from ehr_salary_item
    where company_id=#{companyId,jdbcType=BIGINT} and salary_item_name = #{salaryItemName,jdbcType=VARCHAR}
  </select>
  <select id="listTransitionItem" resultMap="BaseResultMap">
  	select item.*,def.name salary_change_def_name
  	from ehr_salary_item item left join ehr_salary_change_def def on item.salary_change_def_id=def.salary_change_def_id
  	where item.company_id=#{companyId,jdbcType=BIGINT} and item.is_transition=1
  	<if test="exceptId != null" >
  		and item.salary_item_id != #{exceptId,jdbcType=BIGINT}
  	</if>
  </select>
  <select id="listByMonthlySalaryId" resultMap="BaseResultMap">
  	select * from ehr_salary_item 
  	where salary_item_id in (
  		select d.salary_item_id from ehr_monthly_salary_person p,ehr_monthly_salary_detail d 
		where p.monthly_salary_person_id=d.monthly_salary_person_id and 
			p.monthly_salary_id=#{monthlySalaryId,jdbcType=BIGINT}
	) 
	order by display_order,salary_item_id
  </select>
</mapper>