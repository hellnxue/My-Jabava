<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jabava.dao.salary.EhrMonthlySalaryMapper" >
  <resultMap id="BaseResultMap" type="com.jabava.pojo.salary.EhrMonthlySalary" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 30 10:55:05 CST 2016.
    -->
    <id column="monthly_salary_id" property="monthlySalaryId" jdbcType="BIGINT" />
    <result column="monthly" property="monthly" jdbcType="VARCHAR" />
    <result column="reviewer" property="reviewer" jdbcType="VARCHAR" />
    <result column="review_date" property="reviewDate" jdbcType="DATE" />
    <result column="review_opinion" property="reviewOpinion" jdbcType="VARCHAR" />
    <result column="review_status" property="reviewStatus" jdbcType="INTEGER" />
    <result column="usage_flag" property="usageFlag" jdbcType="INTEGER" />
    <result column="version" property="version" jdbcType="INTEGER" />
    <result column="last_flag" property="lastFlag" jdbcType="INTEGER" />
    <result column="company_id" property="companyId" jdbcType="BIGINT" />
    <result column="organization_id" property="organizationId" jdbcType="BIGINT" />
    <result column="mail_info" property="mailInfo" jdbcType="VARCHAR" />
    <result column="organization_name" property="organizationName" jdbcType="VARCHAR" />
    <result column="usage_flag_name" property="usageFlagName" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 30 10:55:05 CST 2016.
    -->
    monthly_salary_id, monthly, reviewer, review_date, review_opinion, review_status, 
    usage_flag, version, last_flag, company_id, organization_id, mail_info
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 30 10:55:05 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from ehr_monthly_salary
    where monthly_salary_id = #{monthlySalaryId,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 30 10:55:05 CST 2016.
    -->
    delete from ehr_monthly_salary
    where monthly_salary_id = #{monthlySalaryId,jdbcType=BIGINT}
    	${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedOrgList("organization_id")}
  </delete>
  <insert id="insert" parameterType="com.jabava.pojo.salary.EhrMonthlySalary" 
  		useGeneratedKeys="true" keyProperty="monthlySalaryId">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 30 10:55:05 CST 2016.
    -->
    insert into ehr_monthly_salary (monthly_salary_id, monthly, reviewer, 
      review_date, review_opinion, review_status, 
      usage_flag, version, last_flag, 
      company_id, organization_id, mail_info
      )
    values (#{monthlySalaryId,jdbcType=BIGINT}, #{monthly,jdbcType=VARCHAR}, #{reviewer,jdbcType=VARCHAR}, 
      #{reviewDate,jdbcType=DATE}, #{reviewOpinion,jdbcType=VARCHAR}, #{reviewStatus,jdbcType=INTEGER}, 
      #{usageFlag,jdbcType=INTEGER}, #{version,jdbcType=INTEGER}, #{lastFlag,jdbcType=INTEGER}, 
      #{companyId,jdbcType=BIGINT}, #{organizationId,jdbcType=BIGINT}, #{mailInfo,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.jabava.pojo.salary.EhrMonthlySalary" 
  		useGeneratedKeys="true" keyProperty="monthlySalaryId">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 30 10:55:05 CST 2016.
    -->
    insert into ehr_monthly_salary
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="monthlySalaryId != null" >
        monthly_salary_id,
      </if>
      <if test="monthly != null" >
        monthly,
      </if>
      <if test="reviewer != null" >
        reviewer,
      </if>
      <if test="reviewDate != null" >
        review_date,
      </if>
      <if test="reviewOpinion != null" >
        review_opinion,
      </if>
      <if test="reviewStatus != null" >
        review_status,
      </if>
      <if test="usageFlag != null" >
        usage_flag,
      </if>
      <if test="version != null" >
        version,
      </if>
      <if test="lastFlag != null" >
        last_flag,
      </if>
      <if test="companyId != null" >
        company_id,
      </if>
      <if test="organizationId != null" >
        organization_id,
      </if>
      <if test="mailInfo != null" >
        mail_info,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="monthlySalaryId != null" >
        #{monthlySalaryId,jdbcType=BIGINT},
      </if>
      <if test="monthly != null" >
        #{monthly,jdbcType=VARCHAR},
      </if>
      <if test="reviewer != null" >
        #{reviewer,jdbcType=VARCHAR},
      </if>
      <if test="reviewDate != null" >
        #{reviewDate,jdbcType=DATE},
      </if>
      <if test="reviewOpinion != null" >
        #{reviewOpinion,jdbcType=VARCHAR},
      </if>
      <if test="reviewStatus != null" >
        #{reviewStatus,jdbcType=INTEGER},
      </if>
      <if test="usageFlag != null" >
        #{usageFlag,jdbcType=INTEGER},
      </if>
      <if test="version != null" >
        #{version,jdbcType=INTEGER},
      </if>
      <if test="lastFlag != null" >
        #{lastFlag,jdbcType=INTEGER},
      </if>
      <if test="companyId != null" >
        #{companyId,jdbcType=BIGINT},
      </if>
      <if test="organizationId != null" >
        #{organizationId,jdbcType=BIGINT},
      </if>
      <if test="mailInfo != null" >
        #{mailInfo,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.jabava.pojo.salary.EhrMonthlySalary" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 30 10:55:05 CST 2016.
    -->
    update ehr_monthly_salary
    <set >
      <if test="monthly != null" >
        monthly = #{monthly,jdbcType=VARCHAR},
      </if>
      <if test="reviewer != null" >
        reviewer = #{reviewer,jdbcType=VARCHAR},
      </if>
      <if test="reviewDate != null" >
        review_date = #{reviewDate,jdbcType=DATE},
      </if>
      <if test="reviewOpinion != null" >
        review_opinion = #{reviewOpinion,jdbcType=VARCHAR},
      </if>
      <if test="reviewStatus != null" >
        review_status = #{reviewStatus,jdbcType=INTEGER},
      </if>
      <if test="usageFlag != null" >
        usage_flag = #{usageFlag,jdbcType=INTEGER},
      </if>
      <if test="version != null" >
        version = #{version,jdbcType=INTEGER},
      </if>
      <if test="lastFlag != null" >
        last_flag = #{lastFlag,jdbcType=INTEGER},
      </if>
      <if test="companyId != null" >
        company_id = #{companyId,jdbcType=BIGINT},
      </if>
      <if test="organizationId != null" >
        organization_id = #{organizationId,jdbcType=BIGINT},
      </if>
      <if test="mailInfo != null" >
        mail_info = #{mailInfo,jdbcType=VARCHAR},
      </if>
    </set>
    where monthly_salary_id = #{monthlySalaryId,jdbcType=BIGINT}
    	${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedOrgList("organization_id")}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.jabava.pojo.salary.EhrMonthlySalary" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 30 10:55:05 CST 2016.
    -->
    update ehr_monthly_salary
    set monthly = #{monthly,jdbcType=VARCHAR},
      reviewer = #{reviewer,jdbcType=VARCHAR},
      review_date = #{reviewDate,jdbcType=DATE},
      review_opinion = #{reviewOpinion,jdbcType=VARCHAR},
      review_status = #{reviewStatus,jdbcType=INTEGER},
      usage_flag = #{usageFlag,jdbcType=INTEGER},
      version = #{version,jdbcType=INTEGER},
      last_flag = #{lastFlag,jdbcType=INTEGER},
      company_id = #{companyId,jdbcType=BIGINT},
      organization_id = #{organizationId,jdbcType=BIGINT},
      mail_info = #{mailInfo,jdbcType=VARCHAR}
    where monthly_salary_id = #{monthlySalaryId,jdbcType=BIGINT}
    	${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedOrgList("organization_id")}
  </update>
  
  <select id="listMonthlySalaryPage" resultMap="BaseResultMap">
  	select ms.*, org.organization_name, bd.base_data_name usage_flag_name 
  	from ehr_monthly_salary ms
  		left join ehr_organization org on ms.organization_id=org.organization_id
  		left join ehr_base_data bd on ms.usage_flag=bd.base_data_id 
  	where ms.company_id=#{companyId,jdbcType=BIGINT} and bd.base_data_type=4
  	<if test="usageFlag != null and usageFlag != ''" >
  		and ms.usage_flag=#{usageFlag,jdbcType=INTEGER}
  	</if>
  	<if test="lastFlag != null and lastFlag != ''" >
  		and ms.last_flag=#{lastFlag,jdbcType=INTEGER}
  	</if>
  	<if test="monthly != null and monthly != ''" >
  		and ms.monthly=#{monthly,jdbcType=VARCHAR}
  	</if>
  	<if test="organizationId != null and organizationId != ''" >
  		and ms.organization_id=#{organizationId,jdbcType=BIGINT}
  	</if>
  	<if test="search != null and search != ''" >
  		and (ms.monthly like CONCAT('%',#{search,jdbcType=VARCHAR},'%')
  			 or bd.base_data_name like CONCAT('%',#{search,jdbcType=VARCHAR},'%')
  			 or org.organization_name like CONCAT('%',#{search,jdbcType=VARCHAR},'%')
  			)
  	</if>
  	<if test="orgList != null and orgList.size() > 0">
  		and ms.organization_id in 
  		<foreach collection="orgList" item="org" index="index" open="(" separator="," close=")">#{org.organizationId}</foreach>
  	</if>
  	${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedOrgList("ms.organization_id")}
  </select>
  <select id="selectById" resultMap="BaseResultMap">
  	select * from ehr_monthly_salary
  	where company_id=#{companyId,jdbcType=BIGINT} and monthly_salary_id = #{monthlySalaryId,jdbcType=BIGINT}
  </select>
  <select id="selectByParam" resultMap="BaseResultMap">
  	select * from ehr_monthly_salary
  	where company_id=#{companyId,jdbcType=BIGINT} 
  	<if test="monthly != null and monthly != ''" >
  		and monthly = #{monthly,jdbcType=VARCHAR}
  	</if>
  	<if test="lastFlag != null and lastFlag != ''" >
  		and last_flag = #{lastFlag,jdbcType=INTEGER}
  	</if>
  	<if test="usageFlag != null and usageFlag != ''" >
  		and usage_flag = #{usageFlag,jdbcType=INTEGER}
  	</if>
  	<if test="organizationId != null and organizationId != ''" >
  		and organization_id = #{organizationId,jdbcType=BIGINT}
  	</if>
  </select>
  <select id="searchMaxVersion" resultType="java.lang.Integer">
 	 select max(version) from ehr_monthly_salary 
  	 where company_id=#{companyId,jdbcType=BIGINT} 
  	 <if test="monthly != null and monthly != ''" >
  		and monthly = #{monthly,jdbcType=VARCHAR}
  	 </if>
  	 <if test="usageFlag != null and usageFlag != ''" >
  		and usage_flag = #{usageFlag,jdbcType=INTEGER}
  	 </if>
  	 <if test="organizationId != null and organizationId != ''" >
  		and organization_id = #{organizationId,jdbcType=BIGINT}
  	 </if>
  </select>
  <select id="countValidByOrgList" resultType="Integer">
 		select count(1) from ehr_monthly_salary
 		where last_flag=1 and usage_flag=#{usageFlag,jdbcType=INTEGER} and monthly=#{monthly,jdbcType=VARCHAR}
	  		and organization_id in 
	  		<foreach collection="orgList" item="org" index="index" open="(" separator="," close=")">#{org.organizationId}</foreach>
  </select>
</mapper>