<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jabava.dao.manage.EhrUserMapper" >
  <resultMap id="BaseResultMap" type="com.jabava.pojo.manage.EhrUser" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 16 12:00:52 CST 2015.
    -->
    <id column="user_id" property="userId" jdbcType="BIGINT" />
    <result column="user_code" property="userCode" jdbcType="VARCHAR" />
    <result column="password" property="password" jdbcType="VARCHAR" />
    <result column="user_name" property="userName" jdbcType="VARCHAR" />
    <result column="sex" property="sex" jdbcType="INTEGER" />
    <result column="telephone" property="telephone" jdbcType="VARCHAR" />
    <result column="mobile" property="mobile" jdbcType="VARCHAR" />
    <result column="mail_address" property="mailAddress" jdbcType="VARCHAR" />
    <result column="memo" property="memo" jdbcType="VARCHAR" />
    <result column="is_valid" property="isValid" jdbcType="TINYINT" />
    <result column="is_locked" property="isLocked" jdbcType="TINYINT" />
    <result column="last_change_password_date" property="lastChangePasswordDate" jdbcType="TIMESTAMP" />
    <result column="failture_time" property="failtureTime" jdbcType="INTEGER" />
    <result column="login_time" property="loginTime" jdbcType="INTEGER" />
    <result column="user_type" property="userType" jdbcType="TINYINT" />
    <result column="company_id" property="companyId" jdbcType="BIGINT" />
    <result column="create_user_id" property="createUserId" jdbcType="BIGINT" />
    <result column="create_user_name" property="createUserName" jdbcType="VARCHAR" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="last_modify_user_id" property="lastModifyUserId" jdbcType="BIGINT" />
    <result column="last_modify_date" property="lastModifyDate" jdbcType="TIMESTAMP" />
    <result column="last_modify_user_name" property="lastModifyUserName" jdbcType="VARCHAR" />
    <result column="user_distinguish" property="userDistinguish" jdbcType="VARCHAR" />
    <result column="company_name" property="companyName" jdbcType="VARCHAR" />
    <result column="modify_date" property="modifyDate" jdbcType="VARCHAR" />
    <result column="valid" property="valid" jdbcType="VARCHAR" />
    <result column="locked" property="locked" jdbcType="VARCHAR" />
    <result column="utype" property="utype" jdbcType="VARCHAR" />
    <result column="is_deleted" property="isDeleted" jdbcType="INTEGER" />
    <result column="flag" property="flag" jdbcType="INTEGER" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 16 12:00:52 CST 2015.
    -->
    user_id, user_code, password, user_name, sex, telephone, mobile, mail_address, memo, 
    is_valid, is_locked, last_change_password_date, failture_time, login_time, user_type, 
    company_id, create_user_id, create_user_name, create_date, last_modify_user_id, last_modify_date, 
    last_modify_user_name, user_distinguish, is_deleted, flag
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 16 12:00:52 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from ehr_user
    where user_id = #{userId,jdbcType=BIGINT}
  </select>
  
  <select id="searchUserPage" resultMap="BaseResultMap" parameterType="java.util.Map">
  	select 
  		eu.user_id, eu.user_code,eu.last_modify_user_name,eu.user_name,eu.mail_address,eu.is_valid, eu.is_locked,eu.user_type,eu.company_id,eu.last_modify_user_id, DATE_FORMAT(eu.last_modify_date, '%Y-%m-%d %H:%i') modify_date, ec.company_name,
  		case eu.is_valid when 1 THEN '有效' else '无效' end valid,
  		case eu.is_locked when 1 THEN '锁定' else '未锁定' end locked,
  		case eu.user_type when 1 THEN '管理员' when 2 then '系统管理员' else '普通用户' end utype
  	from ehr_user eu
  	left join ehr_company ec on eu.company_id=ec.company_id
  	where eu.is_deleted = 0 and 1=1
  		<if test="userCode != null and userCode != ''">
  			and eu.user_code LIKE CONCAT(CONCAT('%', #{userCode,jdbcType=VARCHAR}), '%')
  		</if>
  		<if test="userName != null and userName != ''">
  			and eu.user_name LIKE CONCAT(CONCAT('%', #{userName,jdbcType=VARCHAR}), '%')
  		</if>
  		<if test="userType != null and userType != ''">
  			and eu.user_type=#{userType,jdbcType=TINYINT}
  		</if>
  		<if test="companyId != null and companyId != ''">
  			and eu.company_id=#{companyId,jdbcType=BIGINT}
  		</if>
  		<if test="isValid != null and isValid != ''">
  			and eu.is_valid=#{isValid,jdbcType=TINYINT}
  		</if>
  		<if test="search != null and search != ''">
  			and CONCAT(eu.user_code,eu.user_name,eu.mail_address,eu.last_modify_user_name,eu.last_modify_date) LIKE CONCAT(CONCAT('%', #{search,jdbcType=VARCHAR}), '%')
  		</if>
  		 order by eu.${order} ${according} 
  </select>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 16 12:00:52 CST 2015.
    -->
    delete from ehr_user
    where user_id = #{userId,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.jabava.pojo.manage.EhrUser" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 16 12:00:52 CST 2015.
    -->
    insert into ehr_user (user_id, user_code, password, 
      user_name, sex, telephone, 
      mobile, mail_address, memo, 
      is_valid, is_locked, last_change_password_date, 
      failture_time, login_time, user_type, 
      company_id, create_user_id, create_user_name, 
      create_date, last_modify_user_id, last_modify_date, 
      last_modify_user_name, user_distinguish)
    values (#{userId,jdbcType=BIGINT}, #{userCode,jdbcType=VARCHAR}, #{password,jdbcType=VARCHAR}, 
      #{userName,jdbcType=VARCHAR}, #{sex,jdbcType=INTEGER}, #{telephone,jdbcType=VARCHAR}, 
      #{mobile,jdbcType=VARCHAR}, #{mailAddress,jdbcType=VARCHAR}, #{memo,jdbcType=VARCHAR}, 
      #{isValid,jdbcType=TINYINT}, #{isLocked,jdbcType=TINYINT}, #{lastChangePasswordDate,jdbcType=TIMESTAMP}, 
      #{failtureTime,jdbcType=INTEGER}, #{loginTime,jdbcType=INTEGER}, #{userType,jdbcType=TINYINT}, 
      #{companyId,jdbcType=BIGINT}, #{createUserId,jdbcType=BIGINT}, #{createUserName,jdbcType=VARCHAR}, 
      #{createDate,jdbcType=TIMESTAMP}, #{lastModifyUserId,jdbcType=BIGINT}, #{lastModifyDate,jdbcType=TIMESTAMP}, 
      #{lastModifyUserName,jdbcType=VARCHAR}, #{userDistinguish,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.jabava.pojo.manage.EhrUser" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 16 12:00:52 CST 2015.
    -->
    insert into ehr_user
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="userId != null" >
        user_id,
      </if>
      <if test="userCode != null" >
        user_code,
      </if>
      <if test="password != null" >
        password,
      </if>
      <if test="userName != null" >
        user_name,
      </if>
      <if test="sex != null" >
        sex,
      </if>
      <if test="telephone != null" >
        telephone,
      </if>
      <if test="mobile != null" >
        mobile,
      </if>
      <if test="mailAddress != null" >
        mail_address,
      </if>
      <if test="memo != null" >
        memo,
      </if>
      <if test="isValid != null" >
        is_valid,
      </if>
      <if test="isLocked != null" >
        is_locked,
      </if>
      <if test="lastChangePasswordDate != null" >
        last_change_password_date,
      </if>
      <if test="failtureTime != null" >
        failture_time,
      </if>
      <if test="loginTime != null" >
        login_time,
      </if>
      <if test="userType != null" >
        user_type,
      </if>
      <if test="companyId != null" >
        company_id,
      </if>
      <if test="createUserId != null" >
        create_user_id,
      </if>
      <if test="createUserName != null" >
        create_user_name,
      </if>
      <if test="createDate != null" >
        create_date,
      </if>
      <if test="lastModifyUserId != null" >
        last_modify_user_id,
      </if>
      <if test="lastModifyDate != null" >
        last_modify_date,
      </if>
      <if test="lastModifyUserName != null" >
        last_modify_user_name,
      </if>
      <if test="userDistinguish != null" >
        user_distinguish,
      </if>
       <if test="flag != null" >
        flag,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="userId != null" >
        #{userId,jdbcType=BIGINT},
      </if>
      <if test="userCode != null" >
        #{userCode,jdbcType=VARCHAR},
      </if>
      <if test="password != null" >
        #{password,jdbcType=VARCHAR},
      </if>
      <if test="userName != null" >
        #{userName,jdbcType=VARCHAR},
      </if>
      <if test="sex != null" >
        #{sex,jdbcType=INTEGER},
      </if>
      <if test="telephone != null" >
        #{telephone,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null" >
        #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="mailAddress != null" >
        #{mailAddress,jdbcType=VARCHAR},
      </if>
      <if test="memo != null" >
        #{memo,jdbcType=VARCHAR},
      </if>
      <if test="isValid != null" >
        #{isValid,jdbcType=TINYINT},
      </if>
      <if test="isLocked != null" >
        #{isLocked,jdbcType=TINYINT},
      </if>
      <if test="lastChangePasswordDate != null" >
        #{lastChangePasswordDate,jdbcType=TIMESTAMP},
      </if>
      <if test="failtureTime != null" >
        #{failtureTime,jdbcType=INTEGER},
      </if>
      <if test="loginTime != null" >
        #{loginTime,jdbcType=INTEGER},
      </if>
      <if test="userType != null" >
        #{userType,jdbcType=TINYINT},
      </if>
      <if test="companyId != null" >
        #{companyId,jdbcType=BIGINT},
      </if>
      <if test="createUserId != null" >
        #{createUserId,jdbcType=BIGINT},
      </if>
      <if test="createUserName != null" >
        #{createUserName,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastModifyUserId != null" >
        #{lastModifyUserId,jdbcType=BIGINT},
      </if>
      <if test="lastModifyDate != null" >
        #{lastModifyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastModifyUserName != null" >
        #{lastModifyUserName,jdbcType=VARCHAR},
      </if>
      <if test="userDistinguish != null" >
        #{userDistinguish,jdbcType=VARCHAR},
      </if>
      <if test="flag != null" >
        #{flag,jdbcType=INTEGER},
      </if>
    </trim>
    <selectKey resultType="java.lang.Long" order="AFTER" keyProperty="userId">  
    	SELECT LAST_INSERT_ID() AS ID  
    </selectKey>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.jabava.pojo.manage.EhrUser" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 16 12:00:52 CST 2015.
    -->
    update ehr_user
    <set >
      <if test="userCode != null" >
        user_code = #{userCode,jdbcType=VARCHAR},
      </if>
      <if test="password != null" >
        password = #{password,jdbcType=VARCHAR},
      </if>
      <if test="userName != null" >
        user_name = #{userName,jdbcType=VARCHAR},
      </if>
      <if test="sex != null" >
        sex = #{sex,jdbcType=INTEGER},
      </if>
      <if test="telephone != null" >
        telephone = #{telephone,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null" >
        mobile = #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="mailAddress != null" >
        mail_address = #{mailAddress,jdbcType=VARCHAR},
      </if>
      <if test="memo != null" >
        memo = #{memo,jdbcType=VARCHAR},
      </if>
      <if test="isValid != null" >
        is_valid = #{isValid,jdbcType=TINYINT},
      </if>
      <if test="isLocked != null" >
        is_locked = #{isLocked,jdbcType=TINYINT},
      </if>
      <if test="lastChangePasswordDate != null" >
        last_change_password_date = #{lastChangePasswordDate,jdbcType=TIMESTAMP},
      </if>
      <if test="failtureTime != null" >
        failture_time = #{failtureTime,jdbcType=INTEGER},
      </if>
      <if test="loginTime != null" >
        login_time = #{loginTime,jdbcType=INTEGER},
      </if>
      <if test="userType != null" >
        user_type = #{userType,jdbcType=TINYINT},
      </if>
      <if test="companyId != null" >
        company_id = #{companyId,jdbcType=BIGINT},
      </if>
      <if test="createUserId != null" >
        create_user_id = #{createUserId,jdbcType=BIGINT},
      </if>
      <if test="createUserName != null" >
        create_user_name = #{createUserName,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastModifyUserId != null" >
        last_modify_user_id = #{lastModifyUserId,jdbcType=BIGINT},
      </if>
      <if test="lastModifyDate != null" >
        last_modify_date = #{lastModifyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="lastModifyUserName != null" >
        last_modify_user_name = #{lastModifyUserName,jdbcType=VARCHAR},
      </if>
      <if test="userDistinguish != null" >
        user_distinguish = #{userDistinguish,jdbcType=VARCHAR},
      </if>
      <if test="flag != null" >
        flag = #{flag,jdbcType=INTEGER},
      </if>
    </set>
    where user_id = #{userId,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.jabava.pojo.manage.EhrUser" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Dec 16 12:00:52 CST 2015.
    -->
    update ehr_user
    set user_code = #{userCode,jdbcType=VARCHAR},
      password = #{password,jdbcType=VARCHAR},
      user_name = #{userName,jdbcType=VARCHAR},
      sex = #{sex,jdbcType=INTEGER},
      telephone = #{telephone,jdbcType=VARCHAR},
      mobile = #{mobile,jdbcType=VARCHAR},
      mail_address = #{mailAddress,jdbcType=VARCHAR},
      memo = #{memo,jdbcType=VARCHAR},
      is_valid = #{isValid,jdbcType=TINYINT},
      is_locked = #{isLocked,jdbcType=TINYINT},
      last_change_password_date = #{lastChangePasswordDate,jdbcType=TIMESTAMP},
      failture_time = #{failtureTime,jdbcType=INTEGER},
      login_time = #{loginTime,jdbcType=INTEGER},
      user_type = #{userType,jdbcType=TINYINT},
      company_id = #{companyId,jdbcType=BIGINT},
      create_user_id = #{createUserId,jdbcType=BIGINT},
      create_user_name = #{createUserName,jdbcType=VARCHAR},
      create_date = #{createDate,jdbcType=TIMESTAMP},
      last_modify_user_id = #{lastModifyUserId,jdbcType=BIGINT},
      last_modify_date = #{lastModifyDate,jdbcType=TIMESTAMP},
      last_modify_user_name = #{lastModifyUserName,jdbcType=VARCHAR},
      user_distinguish = #{userDistinguish,jdbcType=VARCHAR}
    where user_id = #{userId,jdbcType=BIGINT}
  </update>
  
   <select id="validateUser" resultMap="BaseResultMap" >
    SELECT a.* FROM ehr_user a, ehr_company b WHERE a.company_id=b.company_id AND a.is_valid=1 
    AND a.user_code = #{userCode,jdbcType=VARCHAR} 
<!--     AND b.company_code = #{companyCode,jdbcType=VARCHAR}  -->
  </select>
  
  <update id="lockUser" parameterType="java.lang.Long" >
    UPDATE ehr_user SET failture_time = failture_time + 1
     <if test="isLock == true" >
     	, is_locked=1 
     </if>
    WHERE user_id = #{userId,jdbcType=BIGINT} 
  </update>
  
   <update id="updateUserloginTime" parameterType="java.lang.Long" >
    UPDATE ehr_user SET failture_time = 0, login_time = login_time + 1 WHERE user_id = #{userId,jdbcType=BIGINT} 
  </update>
  
   <select id="searchUserByUserCode" resultMap="BaseResultMap" >
    select 
    <include refid="Base_Column_List" />
    from ehr_user
    where user_code = #{userCode,jdbcType=VARCHAR}
  </select>
  
  	<select id="userSelected" resultMap="BaseResultMap">
  		select 
  			s.user_id,s.user_name 
  		from ehr_user s,ehr_role_user t 
  		where 
  			s.user_id=t.user_id 
  			and s.is_valid=1 
  			and s.company_id=#{companyId,jdbcType=BIGINT} 
  			and t.role_id=#{roleId,jdbcType=BIGINT} 
  		order by s.user_name
  	</select>
  	
  	<select id="userNotSelected" resultMap="BaseResultMap">
  		select 
  			s.user_id,s.user_name 
  		from ehr_user s 
  		where 
  			s.is_valid=1 
  			and s.company_id=#{companyId,jdbcType=BIGINT} 
  			and s.user_id not in(select t.user_id from ehr_role_user t where t.role_id=#{roleId,jdbcType=BIGINT}) 
  		order by s.user_name
  	</select>
  
	<select id="isSingleUserCode" resultType="java.lang.Integer"  parameterType="com.jabava.pojo.manage.EhrUser">
  		select 
  			count(*) 
  		from ehr_user 
  		where 
  			is_valid=1 
  			and user_code=#{userCode,jdbcType=VARCHAR}
	  		<if test="userId != null and userId != ''">
	  			 and user_id &lt;&gt; #{userId,jdbcType=BIGINT} 
	  		</if>
	  		<if test="companyId != null and companyId != ''">
	  			and company_id=#{companyId,jdbcType=BIGINT}
	  		</if>
  	</select>
  	
  	<update id="resetPassword" parameterType="com.jabava.pojo.manage.EhrUser">
  		update 
  			ehr_user 
  		set 
  			password=#{password,jdbcType=VARCHAR},
  			is_locked=0,
  			failture_time=0 
  		where user_id=#{userId,jdbcType=BIGINT} 
  	</update>
  	
  	<update id="delById" parameterType="java.lang.Long">
  		update ehr_user set is_valid=#{isValid,jdbcType=BIGINT} where user_id=#{userId,jdbcType=BIGINT}
  	</update>
  	
  	<select id="getPersonFieldList"   resultType="com.jabava.pojo.manage.EhrPersonField">
  		select field_id as fieldId,field_name as fieldName,field_desc as fieldDesc,field_type as fieldType,relate_sql as relateSql from ehr_person_field
  	</select>
  	<select id="getPersonFieldfixvalue" resultType="com.jabava.pojo.manage.EhrPersonFieldFixvalue">
  		select person_field_fixvalue_id as personFieldFixvalueId,field_id as fieldId,field_key as fieldKey,field_value as fieldValue from ehr_person_field_fixvalue where field_id=#{fieldId,jdbcType=BIGINT}
  	</select>
  	<select id="getUserPowerList"  resultType="com.jabava.pojo.manage.EhrUserBusinessPower">
	  	SELECT
			ep.user_person_power_id as userPersonPowerId,
			ep.user_id as userId,
			ep.field_id as fieldId,
			ep.seq_no as seqNo,
			ep.field_type as fieldType,
			ep.operate_type as operateType,
			ep.field_value  as fieldValue,
			ep.function_point_code as functionPointCode,
			ef.field_type as ftype
		FROM
			ehr_user_business_power ep
			left join ehr_person_field ef on ep.field_id = ef.field_id
		WHERE
			user_id = #{userId,jdbcType=BIGINT} 
		  	
  	</select>
  	
  	<select id="getPersonFieldId" resultType="com.jabava.pojo.manage.EhrPersonField">
  	select  field_id as fieldId,field_name as fieldName,field_desc as fieldDesc,field_type as fieldType,relate_sql as relateSql  from ehr_person_field where field_id=#{fieldId,jdbcType=BIGINT}
  	</select>
  	<select id="getPersonPowerValue" resultType="com.jabava.pojo.manage.EhrUserPersonPowerValue" >
  	select user_person_power_value as userPersonPowerValue,user_person_power_id as userPersonPowerId,field_id as fieldId, field_key as fieldKey ,field_value as fieldValue
  	from ehr_user_person_power_value 
  	where user_person_power_id=#{userPersonPowerId,jdbcType=BIGINT}
  	</select>
  	
  	<select id="getFunctionPoint" resultType="com.jabava.pojo.manage.EhrFunctionPoint">
  	select function_point_code as functionPointCode,function_point_name as functionPointName  from ehr_function_point
  	</select>
  	<select id="getPersonFieldSql" resultType="com.jabava.pojo.manage.EhrPersonFieldFixvalue" >
  		${relateSql}
  	</select>
  	
  	<select id="selectUserBusinessPower "  resultType="com.jabava.pojo.manage.EhrUserBusinessPower">
  	select 
	user_person_power_id as userPersonPowerId,
	user_id as userId,
	field_id as fieldId,
	seq_no as seqNo,
	field_type as fieldType,
	operate_type as operateType,
	field_value  as fieldValue,
	function_point_code as functionPointCode
	from ehr_user_business_power 
	where user_person_power_id = #{userPersonPowerId,jdbcType=BIGINT}
  	</select>
  	<delete id="deleteUserPersonPowerValue"  parameterType="java.lang.Long">
  	delete from ehr_user_person_power_value where user_person_power_id in (select user_person_power_id from ehr_user_business_power where user_id = #{userId,jdbcType=BIGINT})
  	</delete>
  	<delete id="deleteUserBusinessPower"  parameterType="java.lang.Long">
  	delete from ehr_user_business_power where user_id=#{userId,jdbcType=BIGINT}
  	</delete>
  		
   <insert id="insertBusinessPower" parameterType="com.jabava.pojo.manage.EhrUserBusinessPower" >
    insert into ehr_user_business_power ( user_id, field_id, 
      seq_no, field_type, operate_type, 
      field_value, function_point_code)
    values ( #{userId,jdbcType=BIGINT}, #{fieldId,jdbcType=INTEGER}, 
      #{seqNo,jdbcType=INTEGER}, #{fieldType,jdbcType=TINYINT}, #{operateType,jdbcType=TINYINT}, 
      #{fieldValue,jdbcType=VARCHAR}, #{functionPointCode,jdbcType=INTEGER})
      <selectKey resultType="java.lang.Long" order="AFTER" keyProperty="userPersonPowerId">  
    	SELECT LAST_INSERT_ID() AS ID  
    </selectKey>
  </insert>
  	
  	<insert id="insertPersonPower" parameterType="com.jabava.pojo.manage.EhrUserPersonPowerValue" >
    insert into ehr_user_person_power_value ( field_key, user_person_power_id, 
      field_id, field_value)
    values (#{fieldKey,jdbcType=VARCHAR}, #{userPersonPowerId,jdbcType=BIGINT}, 
      #{fieldId,jdbcType=INTEGER}, #{fieldValue,jdbcType=VARCHAR})
  </insert>
  
  <insert id="insertUserPerson" parameterType="java.lang.Long">
  		insert into ehr_user_person(user_id,person_id) values(#{userId, jdbcType=BIGINT},#{personId, jdbcType=BIGINT})
  	</insert>
  	
  	<insert id="insertRoleUser" parameterType="java.lang.Long">
  		insert into ehr_role_user(user_id,role_id) values(#{userId, jdbcType=BIGINT},1)
  	</insert>
  	<select id="searchPersonId" parameterType="java.lang.Long" resultType="java.lang.Long">
  		SELECT  person_id FROM ehr_user_person WHERE user_id = #{userId, jdbcType=BIGINT}
  	</select>
  	 <update id="isDeleteUser" parameterType="java.lang.Long" >
  	  update ehr_user set is_deleted = #{isDeleted,jdbcType=BIGINT} where user_id=#{userId,jdbcType=BIGINT}
  	 </update>
<!--   	  <update id="isDeletePerson" parameterType="java.lang.Long" > -->
<!--   	  update ehr_person set is_deleted = 1 where person_id=#{personId,jdbcType=BIGINT} -->
<!--   	 </update> -->
	<update id="deleteUser" parameterType="java.lang.Long">
  		update ehr_user set is_deleted=#{personId,jdbcType=INTEGER} where user_id in (select user_id from ehr_user_person where person_id=#{personId,jdbcType=BIGINT})
  	</update>
	<select id="searchUserByMobile" parameterType="java.lang.String" resultType="java.lang.Long">
  		SELECT user_id FROM ehr_user WHERE mobile = #{mobile, jdbcType=VARCHAR} AND is_deleted = 0
  	</select>
	<select id="searchUserByUserMobile" resultMap="BaseResultMap" >
    	select <include refid="Base_Column_List" />
    	from ehr_user
    	where mobile = #{mobile,jdbcType=VARCHAR}
	</select>
  	<select id="searchUserByUserEmail" resultMap="BaseResultMap" >
    	select <include refid="Base_Column_List" />
    	from ehr_user
    	where mail_address = #{email,jdbcType=VARCHAR}
	</select>
</mapper>