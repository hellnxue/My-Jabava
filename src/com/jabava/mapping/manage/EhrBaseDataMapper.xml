<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jabava.dao.manage.EhrBaseDataMapper">
	<resultMap id="BaseResultMap" type="com.jabava.pojo.manage.EhrBaseData">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Dec 22 
			13:34:15 CST 2015. -->
		<id column="base_data_id" property="baseDataId" jdbcType="BIGINT" />
		<result column="base_data_type" property="baseDataType"
			jdbcType="INTEGER" />
		<result column="company_id" property="companyId" jdbcType="BIGINT" />
		<result column="base_data_code" property="baseDataCode"
			jdbcType="VARCHAR" />
		<result column="base_data_name" property="baseDataName"
			jdbcType="VARCHAR" />
		<result column="memo" property="memo" jdbcType="VARCHAR" />
		<result column="is_valid" property="isValid" jdbcType="TINYINT" />
		<result column="valid" property="valid" jdbcType="VARCHAR" />
		<result column="create_user_id" property="createUserId"
			jdbcType="BIGINT" />
		<result column="create_user_name" property="createUserName"
			jdbcType="VARCHAR" />
		<result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
		<result column="last_modify_user_id" property="lastModifyUserId"
			jdbcType="BIGINT" />
		<result column="last_modify_user_name" property="lastModifyUserName"
			jdbcType="VARCHAR" />
		<result column="last_modify_date" property="lastModifyDate"
			jdbcType="TIMESTAMP" />
		<result column="last_modify_date1" property="lastModifyDate1"
			jdbcType="VARCHAR" />
		<result column="base_data_type_name" property="baseDataTypeName" jdbcType="VARCHAR" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Dec 22 
			13:34:15 CST 2015. -->
		base_data_id, base_data_type, company_id, base_data_code,
		base_data_name, memo, is_valid,
		create_user_id, create_user_name, create_date, last_modify_user_id,
		last_modify_user_name,
		last_modify_date
	</sql>
	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.Long">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Dec 22 
			13:34:15 CST 2015. -->
		select
		<include refid="Base_Column_List" />
		from ehr_base_data
		where base_data_id = #{baseDataId,jdbcType=BIGINT}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Dec 22 
			13:34:15 CST 2015. -->
		delete from ehr_base_data
		where base_data_id = #{baseDataId,jdbcType=BIGINT}
	</delete>
	<insert id="insert" parameterType="com.jabava.pojo.manage.EhrBaseData">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Dec 22 
			13:34:15 CST 2015. -->
		insert into ehr_base_data (base_data_id, base_data_type, company_id,
		base_data_code, base_data_name, memo,
		is_valid, create_user_id, create_user_name,
		create_date, last_modify_user_id, last_modify_user_name,
		last_modify_date)
		values (#{baseDataId,jdbcType=BIGINT}, #{baseDataType,jdbcType=INTEGER},
		#{companyId,jdbcType=BIGINT},
		#{baseDataCode,jdbcType=VARCHAR}, #{baseDataName,jdbcType=VARCHAR}, #{memo,jdbcType=VARCHAR},
		#{isValid,jdbcType=TINYINT}, #{createUserId,jdbcType=BIGINT},
		#{createUserName,jdbcType=VARCHAR},
		#{createDate,jdbcType=TIMESTAMP}, #{lastModifyUserId,jdbcType=BIGINT},
		#{lastModifyUserName,jdbcType=VARCHAR},
		#{lastModifyDate,jdbcType=TIMESTAMP})
	</insert>
	<insert id="insertSelective" parameterType="com.jabava.pojo.manage.EhrBaseData">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Dec 22 
			13:34:15 CST 2015. -->
		insert into ehr_base_data
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="baseDataId != null">
				base_data_id,
			</if>
			<if test="baseDataType != null">
				base_data_type,
			</if>
			<if test="companyId != null">
				company_id,
			</if>
			<if test="baseDataCode != null">
				base_data_code,
			</if>
			<if test="baseDataName != null">
				base_data_name,
			</if>
			<if test="memo != null">
				memo,
			</if>
			<if test="isValid != null">
				is_valid,
			</if>
			<if test="createUserId != null">
				create_user_id,
			</if>
			<if test="createUserName != null">
				create_user_name,
			</if>
			<if test="createDate != null">
				create_date,
			</if>
			<if test="lastModifyUserId != null">
				last_modify_user_id,
			</if>
			<if test="lastModifyUserName != null">
				last_modify_user_name,
			</if>
			<if test="lastModifyDate != null">
				last_modify_date,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="baseDataId != null">
				#{baseDataId,jdbcType=BIGINT},
			</if>
			<if test="baseDataType != null">
				#{baseDataType,jdbcType=INTEGER},
			</if>
			<if test="companyId != null">
				#{companyId,jdbcType=BIGINT},
			</if>
			<if test="baseDataCode != null">
				#{baseDataCode,jdbcType=VARCHAR},
			</if>
			<if test="baseDataName != null">
				#{baseDataName,jdbcType=VARCHAR},
			</if>
			<if test="memo != null">
				#{memo,jdbcType=VARCHAR},
			</if>
			<if test="isValid != null">
				#{isValid,jdbcType=TINYINT},
			</if>
			<if test="createUserId != null">
				#{createUserId,jdbcType=BIGINT},
			</if>
			<if test="createUserName != null">
				#{createUserName,jdbcType=VARCHAR},
			</if>
			<if test="createDate != null">
				#{createDate,jdbcType=TIMESTAMP},
			</if>
			<if test="lastModifyUserId != null">
				#{lastModifyUserId,jdbcType=BIGINT},
			</if>
			<if test="lastModifyUserName != null">
				#{lastModifyUserName,jdbcType=VARCHAR},
			</if>
			<if test="lastModifyDate != null">
				#{lastModifyDate,jdbcType=TIMESTAMP},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.jabava.pojo.manage.EhrBaseData">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Dec 22 
			13:34:15 CST 2015. -->
		update ehr_base_data
		<set>
			<if test="baseDataType != null">
				base_data_type = #{baseDataType,jdbcType=INTEGER},
			</if>
			<if test="companyId != null">
				company_id = #{companyId,jdbcType=BIGINT},
			</if>
			<if test="baseDataCode != null">
				base_data_code = #{baseDataCode,jdbcType=VARCHAR},
			</if>
			<if test="baseDataName != null">
				base_data_name = #{baseDataName,jdbcType=VARCHAR},
			</if>
			<if test="memo != null">
				memo = #{memo,jdbcType=VARCHAR},
			</if>
			<if test="isValid != null">
				is_valid = #{isValid,jdbcType=TINYINT},
			</if>
			<if test="createUserId != null">
				create_user_id = #{createUserId,jdbcType=BIGINT},
			</if>
			<if test="createUserName != null">
				create_user_name = #{createUserName,jdbcType=VARCHAR},
			</if>
			<if test="createDate != null">
				create_date = #{createDate,jdbcType=TIMESTAMP},
			</if>
			<if test="lastModifyUserId != null">
				last_modify_user_id = #{lastModifyUserId,jdbcType=BIGINT},
			</if>
			<if test="lastModifyUserName != null">
				last_modify_user_name = #{lastModifyUserName,jdbcType=VARCHAR},
			</if>
			<if test="lastModifyDate != null">
				last_modify_date = #{lastModifyDate,jdbcType=TIMESTAMP},
			</if>
		</set>
		where base_data_id = #{baseDataId,jdbcType=BIGINT}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.jabava.pojo.manage.EhrBaseData">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Dec 22 
			13:34:15 CST 2015. -->
		update ehr_base_data
		set base_data_type = #{baseDataType,jdbcType=INTEGER},
		company_id = #{companyId,jdbcType=BIGINT},
		base_data_code = #{baseDataCode,jdbcType=VARCHAR},
		base_data_name = #{baseDataName,jdbcType=VARCHAR},
		memo = #{memo,jdbcType=VARCHAR},
		is_valid = #{isValid,jdbcType=TINYINT},
		create_user_id = #{createUserId,jdbcType=BIGINT},
		create_user_name = #{createUserName,jdbcType=VARCHAR},
		create_date = #{createDate,jdbcType=TIMESTAMP},
		last_modify_user_id = #{lastModifyUserId,jdbcType=BIGINT},
		last_modify_user_name = #{lastModifyUserName,jdbcType=VARCHAR},
		last_modify_date = #{lastModifyDate,jdbcType=TIMESTAMP}
		where base_data_id = #{baseDataId,jdbcType=BIGINT}
	</update>
	<!-- 查询基础数据 -->
	<select id="searchBaseDataPage" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
		a.base_data_id, a.base_data_type,
		a.base_data_code,a. base_data_name, a.memo,
		case a.is_valid  when 1 THEN '有效' else '无效' end valid,
		a.last_modify_user_name,
		DATE_FORMAT(a.last_modify_date, '%Y-%m-%d %H:%i')last_modify_date1,
		b.base_data_type_name
		from ehr_base_data a ,ehr_base_data_type b where
		a.base_data_type=b.base_data_type
		and 1=1
		<if test="baseDataType != null and baseDataType != '' ">
			and a.base_data_type = #{baseDataType,jdbcType=INTEGER}
		</if>
		<if test="baseDataCode != null and baseDataCode != ''">
			and a.base_data_code = #{baseDataCode,jdbcType=VARCHAR}
		</if>
		<if test="baseDataName != null and baseDataName !=''">
			and a.base_data_name = #{baseDataName,jdbcType=VARCHAR}
		</if>
		<if test="isValid != null and isValid != ''">
			and a.is_valid = #{isValid,jdbcType=TINYINT}
		</if>
		and a.company_id = #{companyId,jdbcType=BIGINT}
		<if test="search != null and search != ''">
			and CONCAT(a.base_data_code,a.base_data_name,
			b.base_data_type_name,
			a.memo,
			last_modify_user_name,
			last_modify_date) LIKE CONCAT ('%', #{search, jdbcType=VARCHAR}, '%')
		</if>
		<if test="order != null and order != ''">
			order by ${order} ${according}
		</if>
		
	</select>
	<!-- 查询基础数据 -->
	<!-- 查询基础类型名称 -->
	<select id="selectByBaseDataType" resultMap="BaseResultMap"
		parameterType="java.lang.Long">
		select
		*
		from ehr_base_data_type
	</select>
	<!-- 查询基础类型名称 -->
	<!-- 删除(更改状态) -->
	<update id="updateByIsvalid" parameterType="com.jabava.pojo.manage.EhrBaseData">
		update ehr_base_data
		set
		is_valid = #{isValid,jdbcType=TINYINT}
		where base_data_id = #{baseDataId,jdbcType=BIGINT}
	</update>
	<!-- 修改基础数据名称 -->
	<update id="updateByCode"  parameterType="com.jabava.pojo.manage.EhrBaseData">
	 	update ehr_base_data 
	 	set 
	 	base_data_name = #{baseDataName,jdbcType=VARCHAR} 
	 	where base_data_code=#{baseDataCode,jdbcType=VARCHAR} and company_id = #{companyId,jdbcType=BIGINT} 
	 	and base_data_type = #{baseDataType,jdbcType=INTEGER}  and is_valid=1
	</update>
	<select id="getByCompanyId" resultMap="BaseResultMap">
		select base_data_id,base_data_type,base_data_name from ehr_base_data where company_id=#{companyId,jdbcType=BIGINT} and is_valid=1
	</select>
	
	<select id="selectBaseDataByCode" resultMap="BaseResultMap">
		select <include refid="Base_Column_List" /> from ehr_base_data where is_valid=1 and company_id = #{companyId,jdbcType=BIGINT}
			and base_data_type = #{baseDataType,jdbcType=INTEGER}
			and base_data_code = #{baseDataCode,jdbcType=VARCHAR}
	</select>
	
	<select id="selectBaseData" resultMap="BaseResultMap">
		select <include refid="Base_Column_List" /> from ehr_base_data where is_valid=1 and company_id = #{companyId,jdbcType=BIGINT}
		
		<if test="baseDataType != null and baseDataType != ''">
			and base_data_type = #{baseDataType,jdbcType=INTEGER}
		</if>
	   <if test="baseDataName != null and baseDataName != ''">
			and base_data_name = #{baseDataName,jdbcType=VARCHAR}
		</if>  
	</select>
	
	<select id="selectByType" resultMap="BaseResultMap">
		select <include refid="Base_Column_List" /> from ehr_base_data 
		where company_id = #{companyId,jdbcType=BIGINT}
			and base_data_type = #{baseDataType,jdbcType=INTEGER}
	</select>
	 
	<select id="checkRepeat" resultType="java.lang.Integer" parameterType="com.jabava.pojo.manage.EhrBaseData">
		select 
			count(0) 
		from 
			ehr_base_data 
		where 
			base_data_code=#{baseDataCode,jdbcType=VARCHAR}
			and base_data_name=#{baseDataName,jdbcType=VARCHAR}
			and base_data_type=#{baseDataType,jdbcType=INTEGER}
			and memo=#{memo,jdbcType=VARCHAR}
			and is_valid=1
			and company_id=#{companyId,jdbcType=BIGINT}
			<if test="baseDataId != null">
				and base_data_id&lt;&gt;#{baseDataId,jdbcType=BIGINT}
			</if>
	</select>
	<!-- 查询基本数据的编号 -->
	<select id="checkCode" resultType="java.lang.Integer" parameterType="com.jabava.pojo.manage.EhrBaseData">
		select 
			count(0)
		from 
			ehr_base_data
		where 
			base_data_code=#{baseDataCode,jdbcType=VARCHAR}
			and base_data_type=#{baseDataType,jdbcType=INTEGER}
			and is_valid=1
			and company_id=#{companyId,jdbcType=BIGINT}
			<if test="baseDataId != null">
				and base_data_id&lt;&gt;#{baseDataId,jdbcType=BIGINT}
			</if>
		
	</select>
	<!-- 查询基本数据名称 -->
	<select id="checkName" resultType="java.lang.Integer" parameterType="com.jabava.pojo.manage.EhrBaseData">
		select 
			count(0)
		from 
			ehr_base_data
		where 
			base_data_name=#{baseDataName,jdbcType=VARCHAR}
			and base_data_type=#{baseDataType,jdbcType=INTEGER}
			and is_valid=1
			and company_id=#{companyId,jdbcType=BIGINT}
			<if test="baseDataId != null">
				and base_data_id&lt;&gt;#{baseDataId,jdbcType=BIGINT}
			</if>
		
	</select>
	
	<select id="countByCompany" resultType="Integer">
		select count(1) from ehr_base_data where company_id=#{companyId,jdbcType=BIGINT}
	</select>
	
	<select id="selectFromTemplate" resultType="java.util.HashMap">
		select * from tpl_base_data
	</select>
</mapper>