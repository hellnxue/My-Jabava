<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jabava.dao.socialsecurity.EhrPersonSecurityProfileMapper" >
  <resultMap id="BaseResultMap" type="com.jabava.pojo.socialsecurity.EhrPersonSecurityProfile" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 22 11:31:35 CST 2016.
    -->
    <id column="profile_id" property="profileId" jdbcType="BIGINT" />
    <result column="profile_code" property="profileCode" jdbcType="VARCHAR" />
    <result column="personId" property="personid" jdbcType="BIGINT" />
    <result column="security_switch" property="securitySwitch" jdbcType="INTEGER" />
    <result column="security_status" property="securityStatus" jdbcType="INTEGER" />
    <result column="security_org_account" property="securityOrgAccount" jdbcType="BIGINT" />
    <result column="security_city" property="securityCity" jdbcType="VARCHAR" />
    <result column="security_type" property="securityType" jdbcType="BIGINT" />
    <result column="security_create_type" property="securityCreateType" jdbcType="INTEGER" />
    <result column="security_account" property="securityAccount" jdbcType="CHAR" />
    <result column="security_base" property="securityBase" jdbcType="DECIMAL" />
    <result column="security_org_base" property="securityOrgBase" jdbcType="DECIMAL" />
    <result column="security_starttime" property="securityStarttime" jdbcType="VARCHAR" />
    <result column="security_endtime_status" property="securityEndtimeStatus" jdbcType="INTEGER" />
    <result column="security_endtime" property="securityEndtime" jdbcType="VARCHAR" />
    <result column="security_activatetime" property="securityActivatetime" jdbcType="VARCHAR" />
    <result column="gongjijin_switch" property="gongjijinSwitch" jdbcType="INTEGER" />
    <result column="gongjijin_status" property="gongjijinStatus" jdbcType="INTEGER" />
    <result column="gongjijin_base" property="gongjijinBase" jdbcType="DECIMAL" />
    <result column="gongjijin_org_base" property="gongjijinOrgBase" jdbcType="DECIMAL" />
    <result column="gongjijin_starttime" property="gongjijinStarttime" jdbcType="VARCHAR" />
    <result column="gongjijin_endtime_status" property="gongjijinEndtimeStatus" jdbcType="INTEGER" />
    <result column="gongjijin_endtime" property="gongjijinEndtime" jdbcType="VARCHAR" />
    <result column="gongjijin_activatetime" property="gongjijinActivatetime" jdbcType="VARCHAR" />
    <result column="gongjijin_org_account" property="gongjijinOrgAccount" jdbcType="BIGINT" />
    <result column="gongjijin_city" property="gongjijinCity" jdbcType="VARCHAR" />
    <result column="gongjijin_type" property="gongjijinType" jdbcType="INTEGER" />
    <result column="gongjijin_create_type" property="gongjijinCreateType" jdbcType="INTEGER" />
    <result column="gongjijin_account" property="gongjijinAccount" jdbcType="CHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="is_deleted" property="isDeleted" jdbcType="INTEGER" />
    <result column="input_help_switch" property="inputHelpSwitch" jdbcType="INTEGER" />
    
    <collection property="ehrSecurityItems" resultMap="securityItemResultMap"></collection>
  </resultMap>
	
	<!-- 社保档案关联的社保档案明细信息 -->
	<resultMap id="securityItemResultMap" type="com.jabava.pojo.socialsecurity.EhrSecurityItem">
		<id column="item_id" property="itemId" jdbcType="BIGINT" />
		<result column="security_profile_id" property="securityProfileId" jdbcType="BIGINT" />
		<result column="security_type_id" property="securityTypeId" jdbcType="BIGINT" />
		<result column="security_type_category" property="securityTypeCategory" jdbcType="INTEGER" />
		<result column="security_item_code" property="securityItemCode" jdbcType="BIGINT" />
		<result column="security_item_base" property="securityItemBase" jdbcType="DECIMAL" />
		<result column="security_org_base" property="securityOrgBase" jdbcType="DECIMAL" />
		<result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
		<result column="is_deleted" property="isDeleted" jdbcType="INTEGER" />
	</resultMap>
  <resultMap id="linkedHashMap" type="java.util.LinkedHashMap"></resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 22 11:31:35 CST 2016.
    -->
    profile_id, profile_code, personId, security_switch, security_status, security_org_account, 
    security_city, security_type, security_create_type, security_account, security_base,security_org_base, 
    security_starttime, security_endtime_status, security_endtime, security_activatetime, 
    gongjijin_switch, gongjijin_status, gongjijin_base,gongjijin_org_base, gongjijin_starttime, gongjijin_endtime_status, 
    gongjijin_endtime, gongjijin_activatetime, gongjijin_org_account, gongjijin_city, 
    gongjijin_type, gongjijin_create_type, gongjijin_account, create_time, is_deleted, 
    input_help_switch
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 22 11:31:35 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from ehr_person_security_profile
    where profile_id = #{profileId,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 22 11:31:35 CST 2016.
    -->
    delete from ehr_person_security_profile
    where profile_id = #{profileId,jdbcType=BIGINT}
    	${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("personId")}
  </delete>
  <insert id="insert" parameterType="com.jabava.pojo.socialsecurity.EhrPersonSecurityProfile" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 22 11:31:35 CST 2016.
    -->
    insert into ehr_person_security_profile (profile_id, profile_code, personId, 
      security_switch, security_status, security_org_account, 
      security_city, security_type, security_create_type, 
      security_account, security_base,security_org_base, security_starttime, 
      security_endtime_status, security_endtime, 
      security_activatetime, gongjijin_switch, 
      gongjijin_status, gongjijin_base,gongjijin_org_base, gongjijin_starttime, 
      gongjijin_endtime_status, gongjijin_endtime, 
      gongjijin_activatetime, gongjijin_org_account, 
      gongjijin_city, gongjijin_type, gongjijin_create_type, 
      gongjijin_account, create_time, is_deleted, 
      input_help_switch)
    values (#{profileId,jdbcType=BIGINT}, #{profileCode,jdbcType=VARCHAR}, #{personid,jdbcType=BIGINT}, 
      #{securitySwitch,jdbcType=INTEGER}, #{securityStatus,jdbcType=INTEGER}, #{securityOrgAccount,jdbcType=BIGINT}, 
      #{securityCity,jdbcType=VARCHAR}, #{securityType,jdbcType=BIGINT}, #{securityCreateType,jdbcType=INTEGER}, 
      #{securityAccount,jdbcType=CHAR}, #{securityBase,jdbcType=DECIMAL},#{securityOrgBase,jdbcType=DECIMAL}, #{securityStarttime,jdbcType=VARCHAR}, 
      #{securityEndtimeStatus,jdbcType=INTEGER}, #{securityEndtime,jdbcType=VARCHAR}, 
      #{securityActivatetime,jdbcType=VARCHAR}, #{gongjijinSwitch,jdbcType=INTEGER}, 
      #{gongjijinStatus,jdbcType=INTEGER}, #{gongjijinBase,jdbcType=DECIMAL},#{gongjijinOrgBase,jdbcType=DECIMAL}, #{gongjijinStarttime,jdbcType=VARCHAR}, 
      #{gongjijinEndtimeStatus,jdbcType=INTEGER}, #{gongjijinEndtime,jdbcType=VARCHAR}, 
      #{gongjijinActivatetime,jdbcType=VARCHAR}, #{gongjijinOrgAccount,jdbcType=BIGINT}, 
      #{gongjijinCity,jdbcType=VARCHAR}, #{gongjijinType,jdbcType=INTEGER}, #{gongjijinCreateType,jdbcType=INTEGER}, 
      #{gongjijinAccount,jdbcType=CHAR}, #{createTime,jdbcType=TIMESTAMP}, #{isDeleted,jdbcType=INTEGER}, 
      #{inputHelpSwitch,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.jabava.pojo.socialsecurity.EhrPersonSecurityProfile" useGeneratedKeys="true" keyProperty="profileId">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 22 11:31:35 CST 2016.
    -->
    insert into ehr_person_security_profile
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="profileId != null" >
        profile_id,
      </if>
      <if test="profileCode != null" >
        profile_code,
      </if>
      <if test="personid != null" >
        personId,
      </if>
      <if test="securitySwitch != null" >
        security_switch,
      </if>
      <if test="securityStatus != null" >
        security_status,
      </if>
      <if test="securityOrgAccount != null" >
        security_org_account,
      </if>
      <if test="securityCity != null" >
        security_city,
      </if>
      <if test="securityType != null" >
        security_type,
      </if>
      <if test="securityCreateType != null" >
        security_create_type,
      </if>
      <if test="securityAccount != null" >
        security_account,
      </if>
      <if test="securityBase != null" >
        security_base,
      </if>
      <if test="securityOrgBase != null" >
        security_org_base,
      </if>
      <if test="securityStarttime != null" >
        security_starttime,
      </if>
      <if test="securityEndtimeStatus != null" >
        security_endtime_status,
      </if>
      <if test="securityEndtime != null" >
        security_endtime,
      </if>
      <if test="securityActivatetime != null" >
        security_activatetime,
      </if>
      <if test="gongjijinSwitch != null" >
        gongjijin_switch,
      </if>
      <if test="gongjijinStatus != null" >
        gongjijin_status,
      </if>
      <if test="gongjijinBase != null" >
        gongjijin_base,
      </if>
      <if test="gongjijinOrgBase != null" >
        gongjijin_org_base,
      </if>
      <if test="gongjijinStarttime != null" >
        gongjijin_starttime,
      </if>
      <if test="gongjijinEndtimeStatus != null" >
        gongjijin_endtime_status,
      </if>
      <if test="gongjijinEndtime != null" >
        gongjijin_endtime,
      </if>
      <if test="gongjijinActivatetime != null" >
        gongjijin_activatetime,
      </if>
      <if test="gongjijinOrgAccount != null" >
        gongjijin_org_account,
      </if>
      <if test="gongjijinCity != null" >
        gongjijin_city,
      </if>
      <if test="gongjijinType != null" >
        gongjijin_type,
      </if>
      <if test="gongjijinCreateType != null" >
        gongjijin_create_type,
      </if>
      <if test="gongjijinAccount != null" >
        gongjijin_account,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="isDeleted != null" >
        is_deleted,
      </if>
      <if test="inputHelpSwitch != null" >
        input_help_switch,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="profileId != null" >
        #{profileId,jdbcType=BIGINT},
      </if>
      <if test="profileCode != null" >
        #{profileCode,jdbcType=VARCHAR},
      </if>
      <if test="personid != null" >
        #{personid,jdbcType=BIGINT},
      </if>
      <if test="securitySwitch != null" >
        #{securitySwitch,jdbcType=INTEGER},
      </if>
      <if test="securityStatus != null" >
        #{securityStatus,jdbcType=INTEGER},
      </if>
      <if test="securityOrgAccount != null" >
        #{securityOrgAccount,jdbcType=BIGINT},
      </if>
      <if test="securityCity != null" >
        #{securityCity,jdbcType=VARCHAR},
      </if>
      <if test="securityType != null" >
        #{securityType,jdbcType=BIGINT},
      </if>
      <if test="securityCreateType != null" >
        #{securityCreateType,jdbcType=INTEGER},
      </if>
      <if test="securityAccount != null" >
        #{securityAccount,jdbcType=CHAR},
      </if>
      <if test="securityBase != null" >
        #{securityBase,jdbcType=DECIMAL},
      </if>
      <if test="securityOrgBase != null" >
        #{securityOrgBase,jdbcType=DECIMAL},
      </if>
      <if test="securityStarttime != null" >
        #{securityStarttime,jdbcType=VARCHAR},
      </if>
      <if test="securityEndtimeStatus != null" >
        #{securityEndtimeStatus,jdbcType=INTEGER},
      </if>
      <if test="securityEndtime != null" >
        #{securityEndtime,jdbcType=VARCHAR},
      </if>
      <if test="securityActivatetime != null" >
        #{securityActivatetime,jdbcType=VARCHAR},
      </if>
      <if test="gongjijinSwitch != null" >
        #{gongjijinSwitch,jdbcType=INTEGER},
      </if>
      <if test="gongjijinStatus != null" >
        #{gongjijinStatus,jdbcType=INTEGER},
      </if>
      <if test="gongjijinBase != null" >
        #{gongjijinBase,jdbcType=DECIMAL},
      </if>
      <if test="gongjijinOrgBase != null" >
        #{gongjijinOrgBase,jdbcType=DECIMAL},
      </if>
      <if test="gongjijinStarttime != null" >
        #{gongjijinStarttime,jdbcType=VARCHAR},
      </if>
      <if test="gongjijinEndtimeStatus != null" >
        #{gongjijinEndtimeStatus,jdbcType=INTEGER},
      </if>
      <if test="gongjijinEndtime != null" >
        #{gongjijinEndtime,jdbcType=VARCHAR},
      </if>
      <if test="gongjijinActivatetime != null" >
        #{gongjijinActivatetime,jdbcType=VARCHAR},
      </if>
      <if test="gongjijinOrgAccount != null" >
        #{gongjijinOrgAccount,jdbcType=BIGINT},
      </if>
      <if test="gongjijinCity != null" >
        #{gongjijinCity,jdbcType=VARCHAR},
      </if>
      <if test="gongjijinType != null" >
        #{gongjijinType,jdbcType=INTEGER},
      </if>
      <if test="gongjijinCreateType != null" >
        #{gongjijinCreateType,jdbcType=INTEGER},
      </if>
      <if test="gongjijinAccount != null" >
        #{gongjijinAccount,jdbcType=CHAR},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isDeleted != null" >
        #{isDeleted,jdbcType=INTEGER},
      </if>
      <if test="inputHelpSwitch != null" >
        #{inputHelpSwitch,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.jabava.pojo.socialsecurity.EhrPersonSecurityProfile" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 22 11:31:35 CST 2016.
    -->
    update ehr_person_security_profile
    <set >
      <if test="profileCode != null" >
        profile_code = #{profileCode,jdbcType=VARCHAR},
      </if>
      <if test="personid != null" >
        personId = #{personid,jdbcType=BIGINT},
      </if>
      <if test="securitySwitch != null" >
        security_switch = #{securitySwitch,jdbcType=INTEGER},
      </if>
      <if test="securityStatus != null" >
        security_status = #{securityStatus,jdbcType=INTEGER},
      </if>
      <if test="securityOrgAccount != null" >
        security_org_account = #{securityOrgAccount,jdbcType=BIGINT},
      </if>
      <if test="securityCity != null" >
        security_city = #{securityCity,jdbcType=VARCHAR},
      </if>
      <if test="securityType != null" >
        security_type = #{securityType,jdbcType=BIGINT},
      </if>
      <if test="securityCreateType != null" >
        security_create_type = #{securityCreateType,jdbcType=INTEGER},
      </if>
      <if test="securityAccount != null" >
        security_account = #{securityAccount,jdbcType=CHAR},
      </if>
      <if test="securityBase != null" >
        security_base = #{securityBase,jdbcType=DECIMAL},
      </if>
      <if test="securityOrgBase != null" >
        security_org_base = #{securityOrgBase,jdbcType=DECIMAL},
      </if>
      <if test="securityStarttime != null" >
        security_starttime = #{securityStarttime,jdbcType=VARCHAR},
      </if>
      <if test="securityEndtimeStatus != null" >
        security_endtime_status = #{securityEndtimeStatus,jdbcType=INTEGER},
      </if>
      <if test="securityEndtime != null" >
        security_endtime = #{securityEndtime,jdbcType=VARCHAR},
      </if>
      <if test="securityActivatetime != null" >
        security_activatetime = #{securityActivatetime,jdbcType=VARCHAR},
      </if>
      <if test="gongjijinSwitch != null" >
        gongjijin_switch = #{gongjijinSwitch,jdbcType=INTEGER},
      </if>
      <if test="gongjijinStatus != null" >
        gongjijin_status = #{gongjijinStatus,jdbcType=INTEGER},
      </if>
      <if test="gongjijinBase != null" >
        gongjijin_base = #{gongjijinBase,jdbcType=DECIMAL},
      </if>
      <if test="gongjijinOrgBase != null" >
        gongjijin_org_base = #{gongjijinOrgBase,jdbcType=DECIMAL},
      </if>
      <if test="gongjijinStarttime != null" >
        gongjijin_starttime = #{gongjijinStarttime,jdbcType=VARCHAR},
      </if>
      <if test="gongjijinEndtimeStatus != null" >
        gongjijin_endtime_status = #{gongjijinEndtimeStatus,jdbcType=INTEGER},
      </if>
      <if test="gongjijinEndtime != null" >
        gongjijin_endtime = #{gongjijinEndtime,jdbcType=VARCHAR},
      </if>
      <if test="gongjijinActivatetime != null" >
        gongjijin_activatetime = #{gongjijinActivatetime,jdbcType=VARCHAR},
      </if>
      <if test="gongjijinOrgAccount != null" >
        gongjijin_org_account = #{gongjijinOrgAccount,jdbcType=BIGINT},
      </if>
      <if test="gongjijinCity != null" >
        gongjijin_city = #{gongjijinCity,jdbcType=VARCHAR},
      </if>
      <if test="gongjijinType != null" >
        gongjijin_type = #{gongjijinType,jdbcType=INTEGER},
      </if>
      <if test="gongjijinCreateType != null" >
        gongjijin_create_type = #{gongjijinCreateType,jdbcType=INTEGER},
      </if>
      <if test="gongjijinAccount != null" >
        gongjijin_account = #{gongjijinAccount,jdbcType=CHAR},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isDeleted != null" >
        is_deleted = #{isDeleted,jdbcType=INTEGER},
      </if>
      <if test="inputHelpSwitch != null" >
        input_help_switch = #{inputHelpSwitch,jdbcType=INTEGER},
      </if>
    </set>
    where profile_id = #{profileId,jdbcType=BIGINT}
    	${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("personId")}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.jabava.pojo.socialsecurity.EhrPersonSecurityProfile" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 22 11:31:35 CST 2016.
    -->
    update ehr_person_security_profile
    set profile_code = #{profileCode,jdbcType=VARCHAR},
      personId = #{personid,jdbcType=BIGINT},
      security_switch = #{securitySwitch,jdbcType=INTEGER},
      security_status = #{securityStatus,jdbcType=INTEGER},
      security_org_account = #{securityOrgAccount,jdbcType=BIGINT},
      security_city = #{securityCity,jdbcType=VARCHAR},
      security_type = #{securityType,jdbcType=BIGINT},
      security_create_type = #{securityCreateType,jdbcType=INTEGER},
      security_account = #{securityAccount,jdbcType=CHAR},
      security_base = #{securityBase,jdbcType=DECIMAL},
      security_org_base = #{securityOrgBase,jdbcType=DECIMAL},
      security_starttime = #{securityStarttime,jdbcType=VARCHAR},
      security_endtime_status = #{securityEndtimeStatus,jdbcType=INTEGER},
      security_endtime = #{securityEndtime,jdbcType=VARCHAR},
      security_activatetime = #{securityActivatetime,jdbcType=VARCHAR},
      gongjijin_switch = #{gongjijinSwitch,jdbcType=INTEGER},
      gongjijin_status = #{gongjijinStatus,jdbcType=INTEGER},
      gongjijin_base = #{gongjijinBase,jdbcType=DECIMAL},
      gongjijin_org_base = #{gongjijinOrgBase,jdbcType=DECIMAL},
      gongjijin_starttime = #{gongjijinStarttime,jdbcType=VARCHAR},
      gongjijin_endtime_status = #{gongjijinEndtimeStatus,jdbcType=INTEGER},
      gongjijin_endtime = #{gongjijinEndtime,jdbcType=VARCHAR},
      gongjijin_activatetime = #{gongjijinActivatetime,jdbcType=VARCHAR},
      gongjijin_org_account = #{gongjijinOrgAccount,jdbcType=BIGINT},
      gongjijin_city = #{gongjijinCity,jdbcType=VARCHAR},
      gongjijin_type = #{gongjijinType,jdbcType=INTEGER},
      gongjijin_create_type = #{gongjijinCreateType,jdbcType=INTEGER},
      gongjijin_account = #{gongjijinAccount,jdbcType=CHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      is_deleted = #{isDeleted,jdbcType=INTEGER},
      input_help_switch = #{inputHelpSwitch,jdbcType=INTEGER}
    where profile_id = #{profileId,jdbcType=BIGINT}
    	${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("personId")}
  </update>
  
	<select id="getProfileIdByPerson" parameterType="java.lang.Long" resultMap="BaseResultMap">
		select 
			<include refid="Base_Column_List" />
		from ehr_person_security_profile
			where is_deleted=0 and personId = #{personId,jdbcType=BIGINT}
	</select>

	<!-- 依据公司代码查询公司下所有在缴状态的员工社保档案 -->
	<select id="getSecurityProfileByCompanyId" resultMap="BaseResultMap" parameterType="java.lang.Long" >
		select
			ehr_person_security_profile.profile_id,
			ehr_person_security_profile.profile_code,
			ehr_person_security_profile.personId,
			ehr_person_security_profile.security_switch,
			ehr_person_security_profile.security_status,
			ehr_person_security_profile.security_org_account, 
			ehr_person_security_profile.security_city,
			ehr_person_security_profile.security_type,
			ehr_person_security_profile.security_create_type,
			ehr_person_security_profile.security_account,
			ehr_person_security_profile.security_base, 
			ehr_person_security_profile.security_org_base, 
			ehr_person_security_profile.security_starttime,
			ehr_person_security_profile.security_endtime_status,
			ehr_person_security_profile.security_endtime,
			ehr_person_security_profile.security_activatetime, 
			ehr_person_security_profile.gongjijin_switch,
			ehr_person_security_profile.gongjijin_status,
			ehr_person_security_profile.gongjijin_base,
			ehr_person_security_profile.gongjijin_org_base,
			ehr_person_security_profile.gongjijin_starttime,
			ehr_person_security_profile.gongjijin_endtime_status, 
			ehr_person_security_profile.gongjijin_endtime,
			ehr_person_security_profile.gongjijin_activatetime,
			ehr_person_security_profile.gongjijin_org_account,
			ehr_person_security_profile.gongjijin_city, 
			ehr_person_security_profile.gongjijin_type,
			ehr_person_security_profile.gongjijin_create_type,
			ehr_person_security_profile.gongjijin_account,
			ehr_person_security_profile.create_time,
			ehr_person_security_profile.is_deleted, 
			ehr_person_security_profile.input_help_switch,

			ehr_security_item.item_id,
			ehr_security_item.security_profile_id,
			ehr_security_item.security_type_id,
			ehr_security_item.security_type_category,
			ehr_security_item.security_item_code,
			ehr_security_item.security_item_base
		from 
			ehr_person,
			ehr_person_security_profile,
			ehr_security_item
		where
			ehr_person.company_id = #{companyId,jdbcType=BIGINT}
			and ehr_person_security_profile.personId = ehr_person.person_id
			and ehr_security_item.security_profile_id = ehr_person_security_profile.profile_id
			and ehr_person_security_profile.is_deleted = 0
			and ehr_security_item.is_deleted = 0
			<if test="securityType==1">  
        	and ehr_person_security_profile.security_switch =0 
			and ehr_person_security_profile.security_status =1
			</if>
			<if test="securityType==2">
			and ehr_person_security_profile.gongjijin_switch =0
			and ehr_person_security_profile.gongjijin_status =1
			</if>
			${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("ehr_person.person_id")}
			order by ehr_person_security_profile.profile_id
	</select>
				
	<!-- 依据公司社保账号查询在缴用户的社保档案 -->
	<select id="getSecurityProfileByAccount" resultMap="BaseResultMap" parameterType="java.lang.Long" >
		select
			ehr_person_security_profile.profile_id,
			ehr_person_security_profile.profile_code,
			ehr_person_security_profile.personId,
			ehr_person_security_profile.security_switch,
			ehr_person_security_profile.security_status,
			ehr_person_security_profile.security_org_account, 
			ehr_person_security_profile.security_city,
			ehr_person_security_profile.security_type,
			ehr_person_security_profile.security_create_type,
			ehr_person_security_profile.security_account,
			ehr_person_security_profile.security_base, 
			ehr_person_security_profile.security_org_base, 
			ehr_person_security_profile.security_starttime,
			ehr_person_security_profile.security_endtime_status,
			ehr_person_security_profile.security_endtime,
			ehr_person_security_profile.security_activatetime, 
			ehr_person_security_profile.gongjijin_switch,
			ehr_person_security_profile.gongjijin_status,
			ehr_person_security_profile.gongjijin_base,
			ehr_person_security_profile.gongjijin_org_base,
			ehr_person_security_profile.gongjijin_starttime,
			ehr_person_security_profile.gongjijin_endtime_status, 
			ehr_person_security_profile.gongjijin_endtime,
			ehr_person_security_profile.gongjijin_activatetime,
			ehr_person_security_profile.gongjijin_org_account,
			ehr_person_security_profile.gongjijin_city, 
			ehr_person_security_profile.gongjijin_type,
			ehr_person_security_profile.gongjijin_create_type,
			ehr_person_security_profile.gongjijin_account,
			ehr_person_security_profile.create_time,
			ehr_person_security_profile.is_deleted, 
			ehr_person_security_profile.input_help_switch,

			ehr_security_item.item_id,
			ehr_security_item.security_profile_id,
			ehr_security_item.security_type_id,
			ehr_security_item.security_type_category,
			ehr_security_item.security_item_code,
			ehr_security_item.security_item_base
		from 
			ehr_person_security_profile,
			ehr_security_item
		where
			ehr_security_item.security_profile_id = ehr_person_security_profile.profile_id
			and ehr_person_security_profile.is_deleted = 0
			and ehr_security_item.is_deleted = 0
			<if test="securityType==1">  
			and ehr_person_security_profile.security_org_account = #{securityAccount,jdbcType=BIGINT}
        	and ehr_person_security_profile.security_switch =0 
			and ehr_person_security_profile.security_status =1
			</if>
			<if test="securityType==2">
			and ehr_person_security_profile.gongjijin_org_account = #{securityAccount,jdbcType=BIGINT}
			and ehr_person_security_profile.gongjijin_switch =0
			and ehr_person_security_profile.gongjijin_status =1
			</if>
			${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("ehr_person_security_profile.personId")}
			order by ehr_person_security_profile.profile_id
	</select>
	
	<resultMap id="securityDetailResultMap" type="hashmap">
		<result column="job_number" property="jobNumber"/>
		<result column="employee_name" property="employeeName"/>
		<result column="organization_name" property="organizationName"/>
		<result column="social_security_account_name" property="securityOrgAccount"/>
		<result column="accumulation_fund_account_name" property="gongjijinOrgAccount"/>
		<result column="cert_id" property="certId"/>
		<result column="register_type" property="registerType"/>
		<result column="entry_date" property="entryDate"/>
		<result column="base_salary" property="baseSalary"/>
		<result column="security_status" property="securityStatus"/>
		<result column="security_account" property="securityAccount"/>
		<result column="security_type" property="securityType"/>
		<result column="security_city" property="securityCity"/>
		<result column="gongjijin_status" property="gongjijinStatus"/>
		<result column="gongjijin_account" property="gongjijinAccount"/>
		<result column="gongjjin_type" property="gongjijinType"/>
		<result column="gongjijin_city" property="gongjinCity"/>
	</resultMap>
	
	<sql id="queryParams">
		<where>
			person.company_id=#{companyId,jdbcType=BIGINT}
			<if test="search != null and search!=''">
				and (
					person.employee_name like concat('%',#{search},'%')
				or  person.job_number like concat('%',#{search},'%')
				or organization.organization_name like concat('%',#{search},'%')
				or ss.social_security_account_name like concat('%',#{search},'%')
				or af.accumulation_fund_account_name like concat('%',#{search},'%')
				or person.cert_id like concat('%',#{search},'%')
				)
			</if>
			${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("person.person_id")}     
		</where>
	</sql>
				
	<select id="getSecurityDetailInfoPage" resultMap="securityDetailResultMap" parameterType="java.util.HashMap">
		SELECT
			person.person_id,
			person.job_number,
			person.employee_name,
			organization.organization_name,
			IFNULL(sp.security_city,''),
			ss.social_security_account_name,
			af.accumulation_fund_account_name,
			person.cert_id,
			(case person.register_type when 1 then '本地城镇' when 2 then '本地农村' when 3 then '外地城镇' when  4 then '外地农村' else '' end)register_type,
			DATE_FORMAT(person.entry_date,"%Y-%m-%d") entry_date,
			sp.security_status,
			sp.security_account,
		 	sg_security.sb_group_name security_type,
			ehr_city.CITY_NAME as security_city,
			sp.gongjijin_status,
			sp.gongjijin_account,
			sp.gongjijin_type,
			sg_gongjijin.sb_group_name gongjjin_type,
			gjj.CITY_NAME as gongjijin_city
		FROM
			ehr_person person
		left join ehr_person_security_profile sp on person.person_id = sp.personId
		left join ss_social_security_account ss on ss.social_security_account_id = sp.security_org_account
		left join ehr_organization organization on organization.organization_id = person.organization_id
		left join ss_social_security_account security on security.social_security_account_id = sp.security_org_account
		left join af_accumulation_fund_account af on af.accumulation_fund_account_id = sp.gongjijin_org_account
		left join sb_group sg_security on sg_security.id = sp.security_type
		left join sb_group sg_gongjijin on sg_gongjijin.id = sp.gongjijin_type
		left join ehr_city  on ss.location_city_id = ehr_city.CITY_ID
		left join ehr_city gjj  on af.location_city_id = gjj.CITY_ID
		<include refid="queryParams" />
	</select>
	
	<resultMap id="productListMap" type="hashmap">
		<result column="person_id" property="personId"/>
		<result column="security_profile_id" property="profileId"/>
		<result column="security_type_id" property="securityTypeId"/>
		<result column="security_item_code" property="securityItemCode"/>
		<result column="security_type_category" property="productCategory"/>
		<result column="prod_name" property="productName"/>
	</resultMap>
	
	<!-- 依据员工代码查询可用产品列表，包括社保产品和公积金产品 -->
	<select id="getAllProductsByPersonId" parameterType="java.lang.Long" resultMap="productListMap">
		select
			ehr_security_item.person_id,
			ehr_security_item.security_profile_id,
			ehr_security_item.security_type_id,
    		ehr_security_item.security_item_code,
    		ehr_security_item.security_type_category,
   			sb_group_detail.prod_name
		from
    		ehr_security_item,sb_group_detail
		where
    		ehr_security_item.is_deleted = 0
		and ehr_security_item.person_id = #{personId,jdbcType=BIGINT}
		and ehr_security_item.security_item_code = sb_group_detail.prod_id
		and ehr_security_item.security_type_id = sb_group_detail.sb_group_id
		${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("ehr_security_item.person_id")}
	</select>
	
	<update id="activateSecurity">
		update ehr_person_security_profile set
			security_status = 1
		where
			security_activatetime &lt;= DATE_FORMAT(now(),"%Y%m")
		and security_switch = 0
		and is_deleted = 0
		${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("personId")}
	</update>
	
	<update id="inactivateSecurity">
		update ehr_person_security_profile set
			security_status = 2
		where
			(security_endtime &lt; DATE_FORMAT(now(),"%Y%m") or (security_endtime = DATE_FORMAT(now(),"%Y%m") and security_endtime_status =1))
		and security_switch = 0
		and is_deleted = 0
		${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("personId")}
	</update>
	
	<update id="activateGongjijin">
		update ehr_person_security_profile set
			gongjijin_status = 1
		where
			gongjijin_activatetime &lt;= DATE_FORMAT(now(),"%Y%m")
		and gongjijin_switch = 0
		and is_deleted = 0
		${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("personId")}
	</update>
	
	<update id="inactivateGongjijin">
		update ehr_person_security_profile set
			gongjijin_status = 2
		where
			(gongjijin_endtime &lt; DATE_FORMAT(now(),"%Y%m") or (gongjijin_endtime = DATE_FORMAT(now(),"%Y%m") and gongjijin_endtime_status =1))
		and gongjijin_switch = 0
		and is_deleted = 0
		${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("personId")}
	</update>
	
	<select id="getSecurityProfileByOrgAccount" resultMap="BaseResultMap" parameterType="com.jabava.pojo.socialsecurity.EhrPersonSecurityProfile" >
			SELECT * from ehr_person_security_profile where is_deleted=0
      <if test="securityStatus != null" >
        and   security_status = #{securityStatus,jdbcType=INTEGER}
      </if>
      <if test="securityOrgAccount != null" >
        and security_org_account = #{securityOrgAccount,jdbcType=BIGINT}
      </if>      
      <if test="gongjijinStatus != null" >
        and gongjijin_status = #{gongjijinStatus,jdbcType=INTEGER}
      </if>      
      <if test="gongjijinOrgAccount != null" >
        and gongjijin_org_account = #{gongjijinOrgAccount,jdbcType=BIGINT}
      </if>
		${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("personId")}
	</select>
	
	<select id="selectProfileTotalCount" resultType="java.lang.Long">
		select count(person_id) from ehr_person where is_deleted = 0 and company_id = #{companyId,jdbcType=BIGINT}
	</select>
	
	<select id="getGeneratedReportCount" resultType="java.lang.Long">
		select
			count(bp.id)
		FROM
			ss_payment_bill_person bp, 
			ss_payment_bill bi
		WHERE
			bp.ss_payment_bill_id = bi.id
		and bp.person_id = #{personId,jdbcType=BIGINT}
		and bi.month = #{month,jdbcType=VARCHAR}
		and bi.status != 3
	</select>
	
	<!-- 根据companyId查询员工社保档案表里的所有personId -->
	<select id="getAllPersonIdByCompanyId" resultMap="linkedHashMap" parameterType="java.lang.Long">
	 
	 select epsp.personId personId,epsp.profile_id profileId,ep.job_number jobNumber,epsp.security_status securityStatus,epsp.security_switch securitySwitch, epsp.gongjijin_status gongjijinStatus,epsp.gongjijin_switch gongjijinSwitch, ep.company_id companyId ,
	 epsp.security_account,epsp.security_create_type,epsp.security_starttime,epsp.security_endtime,epsp.security_base,epsp.security_org_base,
     epsp.gongjijin_account, epsp.gongjijin_create_type,epsp.gongjijin_starttime,epsp.gongjijin_endtime,epsp.gongjijin_base,epsp.gongjijin_org_base
     from ehr_person_security_profile epsp left join ehr_person ep on epsp.personId=ep.person_id where epsp.is_deleted=0 and ep.company_id=#{companyId}
      
	</select>
	
	<!-- 根据personId集合查询修改的profile_id -->
	<select id="selectprofileIdListByPersonIdList" resultMap="BaseResultMap" parameterType="java.util.List" >
	   select * from ehr_person_security_profile epsp where epsp.is_deleted=0 and epsp.personId in

	  	<foreach item="item" index="index" collection="list" 
            open="(" separator="," close=")">
            #{item}
     	</foreach>
		 
   </select>
	<!-- <select id="selectprofileIdListByPersonIdList" resultMap="linkedHashMap" parameterType="java.util.List" >
	   select epsp.profile_id profileId ,epsp.personId personId,epsp.security_type securityTypeId from ehr_person_security_profile epsp where epsp.is_deleted=0 and epsp.personId in

	  	<foreach item="item" index="index" collection="list" 
            open="(" separator="," close=")">
            #{item}
     	</foreach>
		 
   </select> -->
   
   <!-- 批量插入员工社保档案信息 --> 
  <insert id="insertBachForSecurityProfile" parameterType="java.util.List">
	   <![CDATA[
		INSERT INTO ehr_person_security_profile
	   	   (profile_code, personId, security_org_account, 
	      security_city, security_type, security_create_type, 
	      security_account, security_base,security_org_base, security_starttime, security_endtime, 
	      security_activatetime,  gongjijin_base,gongjijin_org_base, gongjijin_starttime,  gongjijin_endtime, 
	      gongjijin_activatetime, gongjijin_org_account, 
	      gongjijin_city, gongjijin_type, gongjijin_create_type, 
	      gongjijin_account,create_time)
   	      VALUES 
   	    ]]>
		<foreach collection="list" item="item"  index="index" separator=",">
		 ( #{item.profileCode,jdbcType=VARCHAR}, #{item.personid,jdbcType=BIGINT}, #{item.securityOrgAccount,jdbcType=BIGINT}, 
	      #{item.securityCity,jdbcType=VARCHAR}, #{item.securityType,jdbcType=BIGINT}, #{item.securityCreateType,jdbcType=INTEGER}, 
	      #{item.securityAccount,jdbcType=CHAR}, #{item.securityBase,jdbcType=DECIMAL},#{item.securityOrgBase,jdbcType=DECIMAL}, #{item.securityStarttime,jdbcType=VARCHAR}, 
	      #{item.securityEndtime,jdbcType=VARCHAR}, #{item.securityActivatetime,jdbcType=VARCHAR},  #{item.gongjijinBase,jdbcType=DECIMAL},#{item.gongjijinOrgBase,jdbcType=DECIMAL},
	       #{item.gongjijinStarttime,jdbcType=VARCHAR},  #{item.gongjijinEndtime,jdbcType=VARCHAR},  #{item.gongjijinActivatetime,jdbcType=VARCHAR}, #{item.gongjijinOrgAccount,jdbcType=BIGINT}, 
	      #{item.gongjijinCity,jdbcType=VARCHAR}, #{item.gongjijinType,jdbcType=INTEGER}, #{item.gongjijinCreateType,jdbcType=INTEGER}, 
	      #{item.gongjijinAccount,jdbcType=CHAR}, #{item.createTime,jdbcType=TIMESTAMP} )
		</foreach>		
	</insert> 
	
	<!-- 批量修改员工社保档案信息 -->
	<insert id="updateBachForSecurityProfile" parameterType="list">
	  <![CDATA[
		INSERT INTO ehr_person_security_profile
	   	   (profile_id,profile_code, personId, security_org_account, 
	      security_city, security_type, security_create_type, 
	      security_switch, security_status,
	      security_account, security_base,security_org_base, security_starttime, security_endtime, 
	      security_activatetime,  gongjijin_base,gongjijin_org_base, gongjijin_starttime,  gongjijin_endtime, 
	      gongjijin_activatetime, gongjijin_org_account, 
	      gongjijin_city, gongjijin_type, gongjijin_create_type, 
	      gongjijin_switch, gongjijin_status, 
	      gongjijin_account,create_time)
   	      VALUES 
   	  ]]>
		<foreach collection="list" item="item"  index="index" separator=",">
		  (#{item.profileId,jdbcType=BIGINT}, #{item.profileCode,jdbcType=VARCHAR}, #{item.personid,jdbcType=BIGINT}, #{item.securityOrgAccount,jdbcType=BIGINT}, 
	      #{item.securityCity,jdbcType=VARCHAR}, #{item.securityType,jdbcType=BIGINT}, #{item.securityCreateType,jdbcType=INTEGER}, 
	      #{item.securitySwitch,jdbcType=INTEGER}, #{item.securityStatus,jdbcType=INTEGER},
	      #{item.securityAccount,jdbcType=CHAR}, #{item.securityBase,jdbcType=DECIMAL},#{item.securityOrgBase,jdbcType=DECIMAL}, #{item.securityStarttime,jdbcType=VARCHAR}, 
	      #{item.securityEndtime,jdbcType=VARCHAR}, #{item.securityActivatetime,jdbcType=VARCHAR},  #{item.gongjijinBase,jdbcType=DECIMAL},#{item.gongjijinOrgBase,jdbcType=DECIMAL},
	       #{item.gongjijinStarttime,jdbcType=VARCHAR},  #{item.gongjijinEndtime,jdbcType=VARCHAR},  #{item.gongjijinActivatetime,jdbcType=VARCHAR}, #{item.gongjijinOrgAccount,jdbcType=BIGINT}, 
	      #{item.gongjijinCity,jdbcType=VARCHAR}, #{item.gongjijinType,jdbcType=INTEGER}, #{item.gongjijinCreateType,jdbcType=INTEGER}, 
	      #{item.gongjijinSwitch,jdbcType=INTEGER}, #{item.gongjijinStatus,jdbcType=INTEGER}, 
	      #{item.gongjijinAccount,jdbcType=CHAR}, #{item.createTime,jdbcType=TIMESTAMP} )
		</foreach>		
		ON DUPLICATE KEY UPDATE
		  profile_id = values(profile_id),
	      profile_code = values(profile_code),
	      personId = values(personId),
	      security_switch = values(security_switch),
	      security_status = values(security_status),
	      security_org_account = values(security_org_account),
	      security_city = values(security_city),
	      security_type = values(security_type),
	      security_create_type = values(security_create_type),
	      security_account = values(security_account),
	      security_base = values(security_base),
	      security_org_base = values(security_org_base),
	      security_starttime = values(security_starttime),
	      security_endtime_status = values(security_endtime_status),
	      security_endtime = values(security_endtime),
	      security_activatetime = values(security_activatetime),
	      gongjijin_switch = values(gongjijin_switch),
	      gongjijin_status = values(gongjijin_status),
	      gongjijin_base = values(gongjijin_base),
	      gongjijin_org_base = values(gongjijin_org_base),
	      gongjijin_starttime = values(gongjijin_starttime),
	      gongjijin_endtime_status = values(gongjijin_endtime_status),
	      gongjijin_endtime = values(gongjijin_endtime),
	      gongjijin_activatetime = values(gongjijin_activatetime),
	      gongjijin_org_account = values(gongjijin_org_account),
	      gongjijin_city = values(gongjijin_city),
	      gongjijin_type = values(gongjijin_type),
	      gongjijin_create_type = values(gongjijin_create_type),
	      gongjijin_account = values(gongjijin_account),
	      create_time = values(create_time),
	      is_deleted = values(is_deleted),
	      input_help_switch = values(input_help_switch)
	     
	</insert>
<!-- 	<update id="updateBachForSecurityProfile"  parameterType="java.util.List">  
      update ehr_person_security_profile
       set IS_DISABLED=1 where ORDER_PROD_CARD_NUM in
      <foreach collection="list" item="item" index="index"  open= "(" close =")"  separator="," >  
        #{item.orderProdCardNum}
      </foreach>  
    </update>  -->
</mapper>