<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jabava.dao.socialsecurity.SsPaymentBillPersonMapper">
  <resultMap id="BaseResultMap" type="com.jabava.pojo.socialsecurity.SsPaymentBillPerson">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 20 20:01:30 CST 2016.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="ss_payment_bill_id" jdbcType="BIGINT" property="ssPaymentBillId" />
    <result column="ps_profile_id" jdbcType="BIGINT" property="psProfileId" />
    <result column="person_id" jdbcType="BIGINT" property="personId" />
    <result column="security_account" jdbcType="VARCHAR" property="securityAccount" />
    <result column="hj_base_e" jdbcType="DECIMAL" property="hjBaseE" />
    <result column="hj_base_p" jdbcType="DECIMAL" property="hjBaseP" />
    <result column="hj_amount" jdbcType="DECIMAL" property="hjAmount" />
    <result column="hj_amount_e" jdbcType="DECIMAL" property="hjAmountE" />
    <result column="hj_amount_p" jdbcType="DECIMAL" property="hjAmountP" />
    <result column="bj_amount" jdbcType="DECIMAL" property="bjAmount" />
    <result column="bj_amount_e" jdbcType="DECIMAL" property="bjAmountE" />
    <result column="bj_amount_p" jdbcType="DECIMAL" property="bjAmountP" />
    <result column="bj_base_e" jdbcType="DECIMAL" property="bjBaseE" />
    <result column="bj_base_p" jdbcType="DECIMAL" property="bjBaseP" />
    <result column="person_name" jdbcType="VARCHAR" property="personName" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 20 20:01:30 CST 2016.
    -->
    id, ss_payment_bill_id, ps_profile_id, person_id, security_account, hj_base_e, hj_base_p, 
    hj_amount, hj_amount_e, hj_amount_p, bj_amount, bj_amount_e, bj_amount_p, bj_base_e, 
    bj_base_p
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 20 20:01:30 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from ss_payment_bill_person
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 20 20:01:30 CST 2016.
    -->
    delete from ss_payment_bill_person
    where id = #{id,jdbcType=BIGINT}
    	${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("person_id")}
  </delete>
  <insert id="insert" parameterType="com.jabava.pojo.socialsecurity.SsPaymentBillPerson"
  		useGeneratedKeys="true" keyProperty="id">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 20 20:01:30 CST 2016.
    -->
    insert into ss_payment_bill_person (id, ss_payment_bill_id, ps_profile_id, 
      person_id, security_account, hj_base_e, 
      hj_base_p, hj_amount, hj_amount_e, 
      hj_amount_p, bj_amount, bj_amount_e, 
      bj_amount_p, bj_base_e, bj_base_p
      )
    values (#{id,jdbcType=BIGINT}, #{ssPaymentBillId,jdbcType=BIGINT}, #{psProfileId,jdbcType=BIGINT}, 
      #{personId,jdbcType=BIGINT}, #{securityAccount,jdbcType=VARCHAR}, #{hjBaseE,jdbcType=DECIMAL}, 
      #{hjBaseP,jdbcType=DECIMAL}, #{hjAmount,jdbcType=DECIMAL}, #{hjAmountE,jdbcType=DECIMAL}, 
      #{hjAmountP,jdbcType=DECIMAL}, #{bjAmount,jdbcType=DECIMAL}, #{bjAmountE,jdbcType=DECIMAL}, 
      #{bjAmountP,jdbcType=DECIMAL}, #{bjBaseE,jdbcType=DECIMAL}, #{bjBaseP,jdbcType=DECIMAL}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.jabava.pojo.socialsecurity.SsPaymentBillPerson"
  		useGeneratedKeys="true" keyProperty="id">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 20 20:01:30 CST 2016.
    -->
    insert into ss_payment_bill_person
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="ssPaymentBillId != null">
        ss_payment_bill_id,
      </if>
      <if test="psProfileId != null">
        ps_profile_id,
      </if>
      <if test="personId != null">
        person_id,
      </if>
      <if test="securityAccount != null">
        security_account,
      </if>
      <if test="hjBaseE != null">
        hj_base_e,
      </if>
      <if test="hjBaseP != null">
        hj_base_p,
      </if>
      <if test="hjAmount != null">
        hj_amount,
      </if>
      <if test="hjAmountE != null">
        hj_amount_e,
      </if>
      <if test="hjAmountP != null">
        hj_amount_p,
      </if>
      <if test="bjAmount != null">
        bj_amount,
      </if>
      <if test="bjAmountE != null">
        bj_amount_e,
      </if>
      <if test="bjAmountP != null">
        bj_amount_p,
      </if>
      <if test="bjBaseE != null">
        bj_base_e,
      </if>
      <if test="bjBaseP != null">
        bj_base_p,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=BIGINT},
      </if>
      <if test="ssPaymentBillId != null">
        #{ssPaymentBillId,jdbcType=BIGINT},
      </if>
      <if test="psProfileId != null">
        #{psProfileId,jdbcType=BIGINT},
      </if>
      <if test="personId != null">
        #{personId,jdbcType=BIGINT},
      </if>
      <if test="securityAccount != null">
        #{securityAccount,jdbcType=VARCHAR},
      </if>
      <if test="hjBaseE != null">
        #{hjBaseE,jdbcType=DECIMAL},
      </if>
      <if test="hjBaseP != null">
        #{hjBaseP,jdbcType=DECIMAL},
      </if>
      <if test="hjAmount != null">
        #{hjAmount,jdbcType=DECIMAL},
      </if>
      <if test="hjAmountE != null">
        #{hjAmountE,jdbcType=DECIMAL},
      </if>
      <if test="hjAmountP != null">
        #{hjAmountP,jdbcType=DECIMAL},
      </if>
      <if test="bjAmount != null">
        #{bjAmount,jdbcType=DECIMAL},
      </if>
      <if test="bjAmountE != null">
        #{bjAmountE,jdbcType=DECIMAL},
      </if>
      <if test="bjAmountP != null">
        #{bjAmountP,jdbcType=DECIMAL},
      </if>
      <if test="bjBaseE != null">
        #{bjBaseE,jdbcType=DECIMAL},
      </if>
      <if test="bjBaseP != null">
        #{bjBaseP,jdbcType=DECIMAL},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.jabava.pojo.socialsecurity.SsPaymentBillPerson">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 20 20:01:30 CST 2016.
    -->
    update ss_payment_bill_person
    <set>
      <if test="ssPaymentBillId != null">
        ss_payment_bill_id = #{ssPaymentBillId,jdbcType=BIGINT},
      </if>
      <if test="psProfileId != null">
        ps_profile_id = #{psProfileId,jdbcType=BIGINT},
      </if>
      <if test="personId != null">
        person_id = #{personId,jdbcType=BIGINT},
      </if>
      <if test="securityAccount != null">
        security_account = #{securityAccount,jdbcType=VARCHAR},
      </if>
      <if test="hjBaseE != null">
        hj_base_e = #{hjBaseE,jdbcType=DECIMAL},
      </if>
      <if test="hjBaseP != null">
        hj_base_p = #{hjBaseP,jdbcType=DECIMAL},
      </if>
      <if test="hjAmount != null">
        hj_amount = #{hjAmount,jdbcType=DECIMAL},
      </if>
      <if test="hjAmountE != null">
        hj_amount_e = #{hjAmountE,jdbcType=DECIMAL},
      </if>
      <if test="hjAmountP != null">
        hj_amount_p = #{hjAmountP,jdbcType=DECIMAL},
      </if>
      <if test="bjAmount != null">
        bj_amount = #{bjAmount,jdbcType=DECIMAL},
      </if>
      <if test="bjAmountE != null">
        bj_amount_e = #{bjAmountE,jdbcType=DECIMAL},
      </if>
      <if test="bjAmountP != null">
        bj_amount_p = #{bjAmountP,jdbcType=DECIMAL},
      </if>
      <if test="bjBaseE != null">
        bj_base_e = #{bjBaseE,jdbcType=DECIMAL},
      </if>
      <if test="bjBaseP != null">
        bj_base_p = #{bjBaseP,jdbcType=DECIMAL},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
    	${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("person_id")}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.jabava.pojo.socialsecurity.SsPaymentBillPerson">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 20 20:01:30 CST 2016.
    -->
    update ss_payment_bill_person
    set ss_payment_bill_id = #{ssPaymentBillId,jdbcType=BIGINT},
      ps_profile_id = #{psProfileId,jdbcType=BIGINT},
      person_id = #{personId,jdbcType=BIGINT},
      security_account = #{securityAccount,jdbcType=VARCHAR},
      hj_base_e = #{hjBaseE,jdbcType=DECIMAL},
      hj_base_p = #{hjBaseP,jdbcType=DECIMAL},
      hj_amount = #{hjAmount,jdbcType=DECIMAL},
      hj_amount_e = #{hjAmountE,jdbcType=DECIMAL},
      hj_amount_p = #{hjAmountP,jdbcType=DECIMAL},
      bj_amount = #{bjAmount,jdbcType=DECIMAL},
      bj_amount_e = #{bjAmountE,jdbcType=DECIMAL},
      bj_amount_p = #{bjAmountP,jdbcType=DECIMAL},
      bj_base_e = #{bjBaseE,jdbcType=DECIMAL},
      bj_base_p = #{bjBaseP,jdbcType=DECIMAL}
    where id = #{id,jdbcType=BIGINT}
    	${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("person_id")}
  </update>
  
  <select id="selectByBillId" resultMap="BaseResultMap">
  	select bp.*,p.employee_name person_name 
  	from ss_payment_bill_person bp left join ehr_person p on bp.person_id=p.person_id
  	where bp.ss_payment_bill_id=#{ssPaymentBillId,jdbcType=BIGINT}
  		${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("bp.person_id")}
  </select>
  
  <select id="selectByPersonAndMonth" resultType="java.util.HashMap">
  	select pbp.*,(pbp.hj_amount_e + pbp.bj_amount_e) amount_e, (pbp.hj_amount_p + pbp.bj_amount_p) amount_p, (pbp.hj_amount + pbp.bj_amount) amount
  	from ss_payment_bill_person pbp left join ss_payment_bill pb on pbp.ss_payment_bill_id=pb.id
  	where pb.month=#{month,jdbcType=VARCHAR}
  		and pb.status <![CDATA[<>]]> 3 
  		and pbp.person_id=#{personId,jdbcType=BIGINT}
  	limit 1
  </select>
  
  <!-- 查询员工缴费明细 -->
  <select id="selectBillPersonByPerson" resultType="java.util.HashMap">
	SELECT ssb.month, ssp.security_account, ssp.id,
		ssp.hj_amount, ssp.hj_amount_e, ssp.hj_amount_p, 
		ssp.bj_amount, ssp.bj_amount_e, ssp.bj_amount_p 
	FROM ss_payment_bill_person ssp LEFT JOIN ss_payment_bill ssb ON ssp.ss_payment_bill_id=ssb.id
	WHERE ssb.status <![CDATA[<>]]> 3 AND ssp.person_id=#{personId,jdbcType=BIGINT}
      <if test="startMonth != null and startMonth != ''" >
        and ssb.month <![CDATA[>=]]> #{startMonth}
      </if>
      <if test="endMonth != null and endMonth != ''" >
        and ssb.month <![CDATA[<=]]> #{endMonth}
      </if>
  </select>
  
  <select id="queryByCertIdAndMonth" resultType="java.util.HashMap">
  	SELECT pbp.id ssPaymentBillPersonId, p.employee_name employeeName 
	FROM ss_payment_bill_person pbp LEFT JOIN ss_payment_bill pb ON pbp.ss_payment_bill_id=pb.id
	LEFT JOIN ehr_person p ON pbp.person_id=p.person_id
	WHERE pb.status <![CDATA[<>]]> 3 AND pb.month=#{month} AND 
		p.cert_id=#{cardId} AND p.is_deleted=0
  </select>
</mapper>