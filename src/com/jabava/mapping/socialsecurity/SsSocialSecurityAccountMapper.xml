<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jabava.dao.socialsecurity.SsSocialSecurityAccountMapper" >
  <resultMap id="BaseResultMap" type="com.jabava.pojo.socialsecurity.SsSocialSecurityAccount" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="social_security_account_id" property="socialSecurityAccountId" jdbcType="BIGINT" />
    <result column="company_id" property="companyId" jdbcType="BIGINT" />
    <result column="social_security_account_name" property="socialSecurityAccountName" jdbcType="VARCHAR" />
    <result column="location_city_id" property="locationCityId" jdbcType="BIGINT" />
    <result column="social_security_code" property="socialSecurityCode" jdbcType="VARCHAR" />
    <result column="social_security_rule" property="socialSecurityRule" jdbcType="VARCHAR" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="create_user_id" property="createUserId" jdbcType="BIGINT" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="update_user_id" property="updateUserId" jdbcType="BIGINT" />
    <result column="update_date" property="updateDate" jdbcType="TIMESTAMP" />
    <result column="is_deleted" property="isDeleted" jdbcType="INTEGER" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    social_security_account_id, company_id, social_security_account_name, location_city_id, 
    social_security_code, social_security_rule, remark, create_user_id, create_date, 
    update_user_id, update_date, ss_social_security_account.is_deleted
  </sql>
  
	<sql id="Group_Column_List">
		id,sb_group_name,org_id,privately,is_deleted,create_by,
		create_dt,update_by,update_dt,mimic_by,proxy_by
	</sql>
  
  <sql id="queryParams">
  <where>
  	  ss_social_security_account.is_deleted =0  and ehr_city.is_deleted=0 
  	  <if test="search != null and search!=''">
			AND (
				ss_social_security_account.social_security_account_name LIKE CONCAT('%',#{search },'%' )
				OR ss_social_security_account.social_security_code LIKE CONCAT('%',#{search },'%' )
				 	 <if test="ruleList != null" >
      				   OR 
				 	 <foreach item="item" index="index" collection="ruleList" open="(" separator="or" close=")">
        		 	    social_security_rule  = #{item}               
      	 			  </foreach>
     				</if> 
     				 <if test="cityIdList != null" >
      					  OR 
				 	      <foreach item="item" index="index" collection="cityIdList" open="(" separator="or" close=")">
        		 	      location_city_id = #{item}             
      	 			      </foreach>
     				 </if>   
			)
		</if>
      <if test="socialSecurityAccountId != null" >
       AND  social_security_account_id = #{socialSecurityAccountId,jdbcType=BIGINT}
      </if>
      <if test="companyId != null" >
        AND  company_id = #{companyId,jdbcType=BIGINT}
      </if>
      <if test="socialSecurityAccountName != null" >
        AND social_security_account_name = #{socialSecurityAccountName,jdbcType=VARCHAR} 
      </if>
      <if test="locationCityId != null" >
       AND  location_city_id = #{locationCityId,jdbcType=BIGINT}
      </if>
      <if test="socialSecurityCode != null" >
        AND social_security_code =  #{socialSecurityCode,jdbcType=VARCHAR}
      </if>         
  </where>
  </sql>
  <select id="selectByPrimaryKey" resultMap="SocialSecurityAccountResult" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from ss_social_security_account
    where  ss_social_security_account.is_deleted =0  AND  social_security_account_id = #{socialSecurityAccountId,jdbcType=BIGINT}
  </select>
  
   <resultMap id="SocialSecurityAccountResult" type="com.jabava.pojo.socialsecurity.SsSocialSecurityAccountVO"  extends="BaseResultMap">
		<association property="city" column="location_city_id" javaType="com.jabava.pojo.tools.EhrCity" resultMap="CityResultMap"/>
   </resultMap>
   
     <!-- 分页查询人员列表返回的数据  -->
 <resultMap id="PersonListResult" type="com.jabava.pojo.socialsecurity.SsSocialSecurityAccountVO"  extends="BaseResultMap">
 		<association property="city" column="location_city_id" javaType="com.jabava.pojo.tools.EhrCity" resultMap="CityResultMap"/>
 		 <association property="group" column="security_type" javaType="com.jabava.pojo.policygroup.SbGroup" resultMap="GroupResultMap"/>
 		 <association property="person" column="person_id" javaType="com.jabava.pojo.manage.EhrPerson" resultMap="PersonResultMap"/>
 		 <association property="personSecurityProfile" column="security_org_account" javaType="com.jabava.pojo.socialsecurity.EhrPersonSecurityProfile" resultMap="ProfileResultMap"/>
 		
 </resultMap>
   
   <resultMap id="CityResultMap" type="com.jabava.pojo.tools.EhrCity" >
    <id column="CITY_ID" property="cityId" jdbcType="BIGINT" />
    <result column="CITY_CODE" property="cityCode" jdbcType="DECIMAL" />
    <result column="CITY_NAME" property="cityName" jdbcType="VARCHAR" />
    <result column="CITY_ENGLISH_NAME" property="cityEnglishName" jdbcType="VARCHAR" />   
  </resultMap>
   <resultMap id="GroupResultMap" type="com.jabava.pojo.policygroup.SbGroup" >
     <id column="id" property="id" jdbcType="BIGINT" />
     <result column="sb_group_name" property="sbGroupName" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="PersonResultMap" type="com.jabava.pojo.manage.EhrPerson" >
    <id column="person_id" property="personId" jdbcType="BIGINT" />
    <result column="company_id" property="companyId" jdbcType="BIGINT" />
    <result column="organization_id" property="organizationId" jdbcType="BIGINT" />
    <result column="post_id" property="postId" jdbcType="BIGINT" />
    <result column="cost_id" property="costId" jdbcType="BIGINT" />
    <result column="job_number" property="jobNumber" jdbcType="VARCHAR" />
    <result column="employee_name" property="employeeName" jdbcType="VARCHAR" />
  </resultMap>
    <resultMap id="ProfileResultMap" type="com.jabava.pojo.socialsecurity.EhrPersonSecurityProfile" >
    
    <id column="profile_id" property="profileId" jdbcType="BIGINT" />
    <result column="profile_code" property="profileCode" jdbcType="VARCHAR" />
    <result column="personId" property="personid" jdbcType="BIGINT" />
    <result column="security_status" property="securityStatus" jdbcType="INTEGER" />
    <result column="security_org_account" property="securityOrgAccount" jdbcType="BIGINT" />
    <result column="security_city" property="securityCity" jdbcType="VARCHAR" />
    <result column="security_type" property="securityType" jdbcType="INTEGER" />
    <result column="security_create_type" property="securityCreateType" jdbcType="INTEGER" />
    <result column="security_account" property="securityAccount" jdbcType="CHAR" />
    <result column="security_base" property="securityBase" jdbcType="DECIMAL" />
    <result column="security_starttime" property="securityStarttime" jdbcType="DATE" />
    <result column="security_endtime" property="securityEndtime" jdbcType="DATE" />
    <result column="security_activatetime" property="securityActivatetime" jdbcType="DATE" />
    <result column="gongjijin_status" property="gongjijinStatus" jdbcType="INTEGER" />
    <result column="gongjijin_start_time" property="gongjijinStartTime" jdbcType="DATE" />
    <result column="gongjijin_activate_time" property="gongjijinActivateTime" jdbcType="DATE" />
    <result column="gongjijin_end_time" property="gongjijinEndTime" jdbcType="DATE" />
    <result column="gongjijin_org_account" property="gongjijinOrgAccount" jdbcType="BIGINT" />
    <result column="gongjijin_city" property="gongjijinCity" jdbcType="VARCHAR" />
    <result column="gongjijin_type" property="gongjijinType" jdbcType="INTEGER" />
    <result column="gongjijin_create_type" property="gongjijinCreateType" jdbcType="INTEGER" />
    <result column="gongjijin_accountd" property="gongjijinAccountd" jdbcType="CHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="is_deleted" property="isDeleted" jdbcType="INTEGER" />
  </resultMap>
  <!-- 分页 查询社保账户列表 -->
  <select id="findSocialSecurityAccountPage" resultMap="SocialSecurityAccountResult" parameterType="java.util.HashMap"  >
     select 
    <include refid="Base_Column_List" />
    ,
    ehr_city.CITY_NAME as CITY_NAME
    from ss_social_security_account
    left join ehr_city on  
    ss_social_security_account.location_city_id = ehr_city.CITY_ID
     <include refid="queryParams" />
      <if test="orderBy != null and orderBy!=''" >
        ORDER BY  ${orderBy}
      </if> 
  </select>
  <!--  根据 socialSecurityCode  查询社保账户列表    -->
   <select id="findSocialSecurityByCode" resultMap="BaseResultMap" parameterType="java.lang.String" >  
    select 
    <include refid="Base_Column_List" />
    from ss_social_security_account
    where is_deleted =0     
       AND  social_security_code = #{socialSecurityCode,jdbcType=VARCHAR}
  </select>
  
	<select id="getSecurityAccountByCompanyId" resultMap="BaseResultMap" parameterType="java.lang.Long" >  
		select 
			<include refid="Base_Column_List" />
		from ss_social_security_account
		where is_deleted =0     
		AND  company_id = #{companyId,jdbcType=BIGINT}
	</select>
  
      <!-- 根据社保账户ID查询该账户下员工列表 -->
  <select id="findPersonListPage" resultMap="PersonListResult" parameterType="java.util.HashMap" >    
		SELECT
			ehr_person.employee_name,
			ehr_city.CITY_NAME,
			sb_group.sb_group_name
		FROM
			ehr_person_security_profile
		LEFT JOIN ss_social_security_account ON ehr_person_security_profile.security_org_account = ss_social_security_account.social_security_account_id
		LEFT JOIN ehr_person ON ehr_person_security_profile.personId = ehr_person.person_id
		LEFT JOIN ehr_city ON ss_social_security_account.location_city_id = ehr_city.CITY_ID
		LEFT JOIN sb_group ON ehr_person_security_profile.security_type = sb_group.id
		WHERE
			ehr_person_security_profile.is_deleted = 0
		AND ss_social_security_account.is_deleted = 0
		AND ehr_person.is_deleted = 0
		AND ehr_city.IS_DELETED = 0
		AND sb_group.is_deleted = 0
		AND ss_social_security_account.social_security_account_id = #{accountId,jdbcType=BIGINT}
		AND ss_social_security_account.company_id = #{companyId,jdbcType=BIGINT}
		${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("ehr_person.person_id")}
  </select>
  <!-- 根据社保账户ＩＤ　查询社保账户　　getSocialSecurityAccountById -->
  <select id="getSocialSecurityAccountById" resultMap="SocialSecurityAccountResult" parameterType="com.jabava.pojo.socialsecurity.SsSocialSecurityAccount">
     select 
    <include refid="Base_Column_List" />
    from ss_social_security_account
    where  ss_social_security_account.is_deleted =0  AND  social_security_account_id = #{socialSecurityAccountId,jdbcType=BIGINT}
     <if test="companyId != null" >
        AND  ss_social_security_account.company_id = #{companyId,jdbcType=BIGINT}
      </if>
  </select>
	<!-- 依据社保账号查询社保参保规则列表 -->
	<select id="getSocialSecurityRules" parameterType="java.lang.Long" resultType="java.lang.String">
		select
			social_security_rule
		from
			ss_social_security_account
		where
			social_security_account_id = #{securityAccountId};
	</select>
	
	<!-- 依据参保规则id列表插叙参考规则明细 -->
	<select id="getSocialSecurityRulesDetail" resultMap="GroupResultMap">
		select  
		<include refid="Group_Column_List"/>
		from sb_group where id in  
			<foreach item="item" index="index" collection="array" open="(" separator="," close=")">  
				#{item}  
			</foreach>
	</select>
	
	<!-- 根据社保方案和类型选择参保类型明细信息 -->
	<select id="getSecurityGroupDetail" resultType="hashmap">
		select distinct
			sb_group_detail.prod_id,
			policy_prod_ratio.company_ratio,
			sb_group_detail.*
		FROM
			sb_group_detail
		LEFT JOIN policy_group ON sb_group_detail.policy_group_id = policy_group.id
		LEFT JOIN ehr_person_security_profile ON sb_group_detail.sb_group_id = ehr_person_security_profile.security_org_account
		LEFT JOIN policy_prod_ratio ON sb_group_detail.policy_group_id = policy_prod_ratio.id
		WHERE
			sb_group_detail.is_deleted = 0
			AND policy_group.is_deleted = 0
			AND policy_group.policy_group_type = #{groupType,jdbcType=BIGINT}
			AND  sb_group_detail.sb_group_id= #{groupId,jdbcType=BIGINT}
	</select>
	
	<!-- 1 1 社保 2  公积金  -->
   <!-- deleteById  is_deleted=1 -->
   <update id="deleteById" parameterType="java.lang.Long" >   
    update ss_social_security_account set is_deleted=1
     where social_security_account_id = #{socialSecurityAccountId,jdbcType=BIGINT}
  </update> 
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from ss_social_security_account
    where social_security_account_id = #{socialSecurityAccountId,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.jabava.pojo.socialsecurity.SsSocialSecurityAccount" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into ss_social_security_account (social_security_account_id, company_id, 
      social_security_account_name, location_city_id, 
      social_security_code, social_security_rule, 
      remark, create_user_id, create_date, 
      update_user_id, update_date, is_deleted
      )
    values (#{socialSecurityAccountId,jdbcType=BIGINT}, #{companyId,jdbcType=BIGINT}, 
      #{socialSecurityAccountName,jdbcType=VARCHAR}, #{locationCityId,jdbcType=BIGINT}, 
      #{socialSecurityCode,jdbcType=VARCHAR}, #{socialSecurityRule,jdbcType=VARCHAR}, 
      #{remark,jdbcType=VARCHAR}, #{createUserId,jdbcType=BIGINT}, #{createDate,jdbcType=TIMESTAMP}, 
      #{updateUserId,jdbcType=BIGINT}, #{updateDate,jdbcType=TIMESTAMP}, #{isDeleted,jdbcType=INTEGER}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.jabava.pojo.socialsecurity.SsSocialSecurityAccount" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into ss_social_security_account
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="socialSecurityAccountId != null" >
        social_security_account_id,
      </if>
      <if test="companyId != null" >
        company_id,
      </if>
      <if test="socialSecurityAccountName != null" >
        social_security_account_name,
      </if>
      <if test="locationCityId != null" >
        location_city_id,
      </if>
      <if test="socialSecurityCode != null" >
        social_security_code,
      </if>
      <if test="socialSecurityRule != null" >
        social_security_rule,
      </if>
      <if test="remark != null" >
        remark,
      </if>
      <if test="createUserId != null" >
        create_user_id,
      </if>
      <if test="createDate != null" >
        create_date,
      </if>
      <if test="updateUserId != null" >
        update_user_id,
      </if>
      <if test="updateDate != null" >
        update_date,
      </if>
      <if test="isDeleted != null" >
        is_deleted,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="socialSecurityAccountId != null" >
        #{socialSecurityAccountId,jdbcType=BIGINT},
      </if>
      <if test="companyId != null" >
        #{companyId,jdbcType=BIGINT},
      </if>
      <if test="socialSecurityAccountName != null" >
        #{socialSecurityAccountName,jdbcType=VARCHAR},
      </if>
      <if test="locationCityId != null" >
        #{locationCityId,jdbcType=BIGINT},
      </if>
      <if test="socialSecurityCode != null" >
        #{socialSecurityCode,jdbcType=VARCHAR},
      </if>
      <if test="socialSecurityRule != null" >
        #{socialSecurityRule,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="createUserId != null" >
        #{createUserId,jdbcType=BIGINT},
      </if>
      <if test="createDate != null" >
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUserId != null" >
        #{updateUserId,jdbcType=BIGINT},
      </if>
      <if test="updateDate != null" >
        #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isDeleted != null" >
        #{isDeleted,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.jabava.pojo.socialsecurity.SsSocialSecurityAccount" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update ss_social_security_account
    <set >
      <if test="companyId != null" >
        company_id = #{companyId,jdbcType=BIGINT},
      </if>
      <if test="socialSecurityAccountName != null" >
        social_security_account_name = #{socialSecurityAccountName,jdbcType=VARCHAR},
      </if>
      <if test="locationCityId != null" >
        location_city_id = #{locationCityId,jdbcType=BIGINT},
      </if>
      <if test="socialSecurityCode != null" >
        social_security_code = #{socialSecurityCode,jdbcType=VARCHAR},
      </if>
      <if test="socialSecurityRule != null" >
        social_security_rule = #{socialSecurityRule,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="createUserId != null" >
        create_user_id = #{createUserId,jdbcType=BIGINT},
      </if>
      <if test="createDate != null" >
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUserId != null" >
        update_user_id = #{updateUserId,jdbcType=BIGINT},
      </if>
      <if test="updateDate != null" >
        update_date = #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isDeleted != null" >
        is_deleted = #{isDeleted,jdbcType=INTEGER},
      </if>
    </set>
    where social_security_account_id = #{socialSecurityAccountId,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.jabava.pojo.socialsecurity.SsSocialSecurityAccount" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update ss_social_security_account
    set company_id = #{companyId,jdbcType=BIGINT},
      social_security_account_name = #{socialSecurityAccountName,jdbcType=VARCHAR},
      location_city_id = #{locationCityId,jdbcType=BIGINT},
      social_security_code = #{socialSecurityCode,jdbcType=VARCHAR},
      social_security_rule = #{socialSecurityRule,jdbcType=VARCHAR},
      remark = #{remark,jdbcType=VARCHAR},
      create_user_id = #{createUserId,jdbcType=BIGINT},
      create_date = #{createDate,jdbcType=TIMESTAMP},
      update_user_id = #{updateUserId,jdbcType=BIGINT},
      update_date = #{updateDate,jdbcType=TIMESTAMP},
      is_deleted = #{isDeleted,jdbcType=INTEGER}
    where social_security_account_id = #{socialSecurityAccountId,jdbcType=BIGINT}
  </update>
</mapper>