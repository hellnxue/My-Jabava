<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jabava.dao.accumulationfund.AfAccumulationFundAccountMapper" >
  <resultMap id="BaseResultMap" type="com.jabava.pojo.accumulationfund.AfAccumulationFundAccount" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="accumulation_fund_account_id" property="accumulationFundAccountId" jdbcType="BIGINT" />
    <result column="company_id" property="companyId" jdbcType="BIGINT" />
    <result column="accumulation_fund_account_name" property="accumulationFundAccountName" jdbcType="VARCHAR" />
    <result column="location_city_id" property="locationCityId" jdbcType="BIGINT" />
    <result column="accumulation_fund_code" property="accumulationFundCode" jdbcType="VARCHAR" />
    <result column="accumulation_fund_rule" property="accumulationFundRule" jdbcType="VARCHAR" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="create_user_id" property="createUserId" jdbcType="BIGINT" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="update_user_id" property="updateUserId" jdbcType="BIGINT" />
    <result column="update_date" property="updateDate" jdbcType="TIMESTAMP" />
    <result column="is_deleted" property="isDeleted" jdbcType="INTEGER" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    accumulation_fund_account_id, company_id, accumulation_fund_account_name, location_city_id, 
    accumulation_fund_code, accumulation_fund_rule, remark, create_user_id, create_date, 
    update_user_id, update_date, af_accumulation_fund_account.is_deleted
  </sql>
    <sql id="queryParams">
  <where>
  	  af_accumulation_fund_account.is_deleted =0  and ehr_city.is_deleted=0 
  	  <if test="search != null and search!=''">
			AND (
				af_accumulation_fund_account.accumulation_fund_account_name LIKE CONCAT('%',#{search },'%' )
				OR af_accumulation_fund_account.accumulation_fund_code LIKE CONCAT('%',#{search },'%' )
				 	 <if test="ruleList != null" >
      				   OR 
				 	 <foreach item="item" index="index" collection="ruleList" open="(" separator="or" close=")">
        		 	    accumulation_fund_rule  = #{item}               
      	 			  </foreach>
     				</if> 
     				 <if test="cityIdList != null" >
      					  OR 
				 	      <foreach item="item" index="index" collection="cityIdList" open="(" separator="or" close=")">
        		 	      location_city_id = #{item}             
      	 			      </foreach>
     				 </if>   
			)
		</if>     
      <if test="companyId != null" >
        AND  company_id = #{companyId,jdbcType=BIGINT}
      </if>
      <if test="accumulationFundAccountName != null" >
        AND accumulation_fund_account_name = #{accumulationFundAccountName,jdbcType=VARCHAR} 
      </if>
      <if test="locationCityId != null" >
       AND  location_city_id = #{locationCityId,jdbcType=BIGINT}
      </if>
      <if test="accumulationFundCode != null" >
        AND accumulation_fund_code =  #{accumulationFundCode,jdbcType=VARCHAR}
      </if>         
  </where>
  </sql>
  
  
  
  <select id="selectByPrimaryKey" resultMap="accumulationFundAccountResult" parameterType="java.lang.Long" >  
    select 
    <include refid="Base_Column_List" />
    from af_accumulation_fund_account
    where af_accumulation_fund_account.is_deleted =0  AND  accumulation_fund_account_id = #{accumulationFundAccountId,jdbcType=BIGINT}
  </select>
    <resultMap id="accumulationFundAccountResult" type="com.jabava.pojo.accumulationfund.AfAccumulationFundAccountVO"  extends="BaseResultMap">
		<association property="city" column="location_city_id" javaType="com.jabava.pojo.tools.EhrCity" resultMap="CityResultMap"/>
   </resultMap>
   
      <!-- 分页查询人员列表返回的数据  -->
 <resultMap id="PersonListResult" type="com.jabava.pojo.accumulationfund.AfAccumulationFundAccountVO"  extends="BaseResultMap">
 		<association property="city" column="location_city_id" javaType="com.jabava.pojo.tools.EhrCity" resultMap="CityResultMap"/>
 		 <association property="group" column="gongjijin_type" javaType="com.jabava.pojo.policygroup.SbGroup" resultMap="GroupResultMap"/>
 		 <association property="person" column="person_id" javaType="com.jabava.pojo.manage.EhrPerson" resultMap="PersonResultMap"/>
 		 <association property="personSecurityProfile" column="security_org_account" javaType="com.jabava.pojo.socialsecurity.EhrPersonSecurityProfile" resultMap="ProfileResultMap"/>
 		
 </resultMap>
    <resultMap id="ProfileResultMap" type="com.jabava.pojo.socialsecurity.EhrPersonSecurityProfile" >
    
    <id column="profile_id" property="profileId" jdbcType="BIGINT" />
    <result column="profile_code" property="profileCode" jdbcType="VARCHAR" />
    <result column="personId" property="personid" jdbcType="BIGINT" />
    <result column="security_status" property="securityStatus" jdbcType="INTEGER" />
    <result column="security_org_account" property="securityOrgAccount" jdbcType="BIGINT" />
    <result column="security_city" property="securityCity" jdbcType="VARCHAR" />
    <result column="security_type" property="securityType" jdbcType="INTEGER" />
    <result column="security_create_type" property="securityCreateType" jdbcType="INTEGER" />
    <result column="security_account" property="securityAccount" jdbcType="CHAR" />
    <result column="security_base" property="securityBase" jdbcType="DECIMAL" />
    <result column="security_starttime" property="securityStarttime" jdbcType="DATE" />
    <result column="security_endtime" property="securityEndtime" jdbcType="DATE" />
    <result column="security_activatetime" property="securityActivatetime" jdbcType="DATE" />
    <result column="gongjijin_status" property="gongjijinStatus" jdbcType="INTEGER" />
    <result column="gongjijin_start_time" property="gongjijinStartTime" jdbcType="DATE" />
    <result column="gongjijin_activate_time" property="gongjijinActivateTime" jdbcType="DATE" />
    <result column="gongjijin_end_time" property="gongjijinEndTime" jdbcType="DATE" />
    <result column="gongjijin_org_account" property="gongjijinOrgAccount" jdbcType="BIGINT" />
    <result column="gongjijin_city" property="gongjijinCity" jdbcType="VARCHAR" />
    <result column="gongjijin_type" property="gongjijinType" jdbcType="INTEGER" />
    <result column="gongjijin_create_type" property="gongjijinCreateType" jdbcType="INTEGER" />
    <result column="gongjijin_accountd" property="gongjijinAccountd" jdbcType="CHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="is_deleted" property="isDeleted" jdbcType="INTEGER" />
  </resultMap>
   <resultMap id="CityResultMap" type="com.jabava.pojo.tools.EhrCity" >
    <id column="CITY_ID" property="cityId" jdbcType="BIGINT" />
    <result column="CITY_CODE" property="cityCode" jdbcType="DECIMAL" />
    <result column="CITY_NAME" property="cityName" jdbcType="VARCHAR" />
    <result column="CITY_ENGLISH_NAME" property="cityEnglishName" jdbcType="VARCHAR" />   
  </resultMap>
   <resultMap id="GroupResultMap" type="com.jabava.pojo.policygroup.SbGroup" >
     <id column="id" property="id" jdbcType="BIGINT" />
     <result column="sb_group_name" property="sbGroupName" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="PersonResultMap" type="com.jabava.pojo.manage.EhrPerson" >
    <id column="person_id" property="personId" jdbcType="BIGINT" />
    <result column="company_id" property="companyId" jdbcType="BIGINT" />
    <result column="organization_id" property="organizationId" jdbcType="BIGINT" />
    <result column="post_id" property="postId" jdbcType="BIGINT" />
    <result column="cost_id" property="costId" jdbcType="BIGINT" />
    <result column="job_number" property="jobNumber" jdbcType="VARCHAR" />
    <result column="employee_name" property="employeeName" jdbcType="VARCHAR" />
  </resultMap>
	<select id="getAccumulationFundProfileByCompanyId" resultMap="BaseResultMap" parameterType="java.lang.Long" >  
		select 
			<include refid="Base_Column_List" />
		from
			af_accumulation_fund_account
		where
			af_accumulation_fund_account.is_deleted =0
		AND	 company_id = #{companyId,jdbcType=BIGINT}
	</select>

    <!-- 分页 查询公积金账户列表 -->
  <select id="findAccumulationFundAccountPage" resultMap="accumulationFundAccountResult" parameterType="java.util.HashMap"  >
     select 
    <include refid="Base_Column_List" />
    ,
    ehr_city.CITY_NAME as CITY_NAME
    from af_accumulation_fund_account
    left join ehr_city on  
    af_accumulation_fund_account.location_city_id = ehr_city.CITY_ID
     <include refid="queryParams" />
      <if test="orderBy != null and orderBy!=''" >
        ORDER BY  ${orderBy}
      </if> 
  </select>
  
    <!--  根据companyId 和  accumulationFundCode  查询公积金账户列表    -->
   <select id="findAccumulationFundByCode" resultMap="BaseResultMap" parameterType="java.lang.String" >  
    select 
    <include refid="Base_Column_List" />
    from af_accumulation_fund_account
    where is_deleted =0  
       AND  accumulation_fund_code = #{accumulationFundCode,jdbcType=VARCHAR}
  </select>
  
    <!-- 根据公积金账户ID查询该账户下员工列表 -->
  <select id="findPersonListPage" resultMap="PersonListResult" parameterType="java.util.HashMap" >    
		   SELECT			
			ehr_person.employee_name,
			ehr_city.CITY_NAME,
			sb_group.sb_group_name
		FROM
			ehr_person_security_profile
		LEFT JOIN af_accumulation_fund_account ON ehr_person_security_profile.gongjijin_org_account = af_accumulation_fund_account.accumulation_fund_account_id
		LEFT JOIN ehr_person ON ehr_person_security_profile.personId = ehr_person.person_id
		LEFT JOIN ehr_city ON af_accumulation_fund_account.location_city_id = ehr_city.CITY_ID
		LEFT JOIN sb_group ON ehr_person_security_profile.gongjijin_type = sb_group.id
		WHERE
			ehr_person_security_profile.is_deleted = 0
		AND af_accumulation_fund_account.is_deleted = 0
		AND ehr_person.is_deleted = 0
		AND ehr_city.IS_DELETED = 0
		AND sb_group.is_deleted = 0
		AND af_accumulation_fund_account.accumulation_fund_account_id = #{accountId,jdbcType=BIGINT}
		${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("ehr_person_security_profile.personId")}
  </select> 
  
  <!-- deleteById  is_deleted=1 -->
  <update id="deleteById" parameterType="java.lang.Long" >   
    update   af_accumulation_fund_account set is_deleted=1
    where accumulation_fund_account_id = #{accumulationFundAccountId,jdbcType=BIGINT}
  </update> 
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from af_accumulation_fund_account
    where accumulation_fund_account_id = #{accumulationFundAccountId,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.jabava.pojo.accumulationfund.AfAccumulationFundAccount" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into af_accumulation_fund_account (accumulation_fund_account_id, company_id, 
      accumulation_fund_account_name, location_city_id, 
      accumulation_fund_code, accumulation_fund_rule, 
      remark, create_user_id, create_date, 
      update_user_id, update_date, is_deleted
      )
    values (#{accumulationFundAccountId,jdbcType=BIGINT}, #{companyId,jdbcType=BIGINT}, 
      #{accumulationFundAccountName,jdbcType=VARCHAR}, #{locationCityId,jdbcType=BIGINT}, 
      #{accumulationFundCode,jdbcType=VARCHAR}, #{accumulationFundRule,jdbcType=VARCHAR}, 
      #{remark,jdbcType=VARCHAR}, #{createUserId,jdbcType=BIGINT}, #{createDate,jdbcType=TIMESTAMP}, 
      #{updateUserId,jdbcType=BIGINT}, #{updateDate,jdbcType=TIMESTAMP}, #{isDeleted,jdbcType=INTEGER}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.jabava.pojo.accumulationfund.AfAccumulationFundAccount" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into af_accumulation_fund_account
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="accumulationFundAccountId != null" >
        accumulation_fund_account_id,
      </if>
      <if test="companyId != null" >
        company_id,
      </if>
      <if test="accumulationFundAccountName != null" >
        accumulation_fund_account_name,
      </if>
      <if test="locationCityId != null" >
        location_city_id,
      </if>
      <if test="accumulationFundCode != null" >
        accumulation_fund_code,
      </if>
      <if test="accumulationFundRule != null" >
        accumulation_fund_rule,
      </if>
      <if test="remark != null" >
        remark,
      </if>
      <if test="createUserId != null" >
        create_user_id,
      </if>
      <if test="createDate != null" >
        create_date,
      </if>
      <if test="updateUserId != null" >
        update_user_id,
      </if>
      <if test="updateDate != null" >
        update_date,
      </if>
      <if test="isDeleted != null" >
        is_deleted,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="accumulationFundAccountId != null" >
        #{accumulationFundAccountId,jdbcType=BIGINT},
      </if>
      <if test="companyId != null" >
        #{companyId,jdbcType=BIGINT},
      </if>
      <if test="accumulationFundAccountName != null" >
        #{accumulationFundAccountName,jdbcType=VARCHAR},
      </if>
      <if test="locationCityId != null" >
        #{locationCityId,jdbcType=BIGINT},
      </if>
      <if test="accumulationFundCode != null" >
        #{accumulationFundCode,jdbcType=VARCHAR},
      </if>
      <if test="accumulationFundRule != null" >
        #{accumulationFundRule,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="createUserId != null" >
        #{createUserId,jdbcType=BIGINT},
      </if>
      <if test="createDate != null" >
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUserId != null" >
        #{updateUserId,jdbcType=BIGINT},
      </if>
      <if test="updateDate != null" >
        #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isDeleted != null" >
        #{isDeleted,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.jabava.pojo.accumulationfund.AfAccumulationFundAccount" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update af_accumulation_fund_account
    <set >
      <if test="companyId != null" >
        company_id = #{companyId,jdbcType=BIGINT},
      </if>
      <if test="accumulationFundAccountName != null" >
        accumulation_fund_account_name = #{accumulationFundAccountName,jdbcType=VARCHAR},
      </if>
      <if test="locationCityId != null" >
        location_city_id = #{locationCityId,jdbcType=BIGINT},
      </if>
      <if test="accumulationFundCode != null" >
        accumulation_fund_code = #{accumulationFundCode,jdbcType=VARCHAR},
      </if>
      <if test="accumulationFundRule != null" >
        accumulation_fund_rule = #{accumulationFundRule,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="createUserId != null" >
        create_user_id = #{createUserId,jdbcType=BIGINT},
      </if>
      <if test="createDate != null" >
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUserId != null" >
        update_user_id = #{updateUserId,jdbcType=BIGINT},
      </if>
      <if test="updateDate != null" >
        update_date = #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isDeleted != null" >
        is_deleted = #{isDeleted,jdbcType=INTEGER},
      </if>
    </set>
    where accumulation_fund_account_id = #{accumulationFundAccountId,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.jabava.pojo.accumulationfund.AfAccumulationFundAccount" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update af_accumulation_fund_account
    set company_id = #{companyId,jdbcType=BIGINT},
      accumulation_fund_account_name = #{accumulationFundAccountName,jdbcType=VARCHAR},
      location_city_id = #{locationCityId,jdbcType=BIGINT},
      accumulation_fund_code = #{accumulationFundCode,jdbcType=VARCHAR},
      accumulation_fund_rule = #{accumulationFundRule,jdbcType=VARCHAR},
      remark = #{remark,jdbcType=VARCHAR},
      create_user_id = #{createUserId,jdbcType=BIGINT},
      create_date = #{createDate,jdbcType=TIMESTAMP},
      update_user_id = #{updateUserId,jdbcType=BIGINT},
      update_date = #{updateDate,jdbcType=TIMESTAMP},
      is_deleted = #{isDeleted,jdbcType=INTEGER}
    where accumulation_fund_account_id = #{accumulationFundAccountId,jdbcType=BIGINT}
  </update>
</mapper>