<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jabava.dao.accumulationfund.AfPaymentBillPersonMapper" >
  <resultMap id="BaseResultMap" type="com.jabava.pojo.accumulationfund.AfPaymentBillPerson" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="af_payment_bill_person_id" property="afPaymentBillPersonId" jdbcType="BIGINT" />
    <result column="af_payment_bill_id" property="afPaymentBillId" jdbcType="BIGINT" />
    <result column="ps_profile_id" property="psProfileId" jdbcType="BIGINT" />
    <result column="person_id" property="personId" jdbcType="BIGINT" />
    <result column="accumulation_fund_account" property="accumulationFundAccount" jdbcType="VARCHAR" />
    <result column="hj_base_e" property="hjBaseE" jdbcType="DECIMAL" />
    <result column="hj_base_p" property="hjBaseP" jdbcType="DECIMAL" />
    <result column="hj_amount" property="hjAmount" jdbcType="DECIMAL" />
    <result column="hj_amount_e" property="hjAmountE" jdbcType="DECIMAL" />
    <result column="hj_amount_p" property="hjAmountP" jdbcType="DECIMAL" />
    <result column="bj_amount" property="bjAmount" jdbcType="DECIMAL" />
    <result column="bj_amount_e" property="bjAmountE" jdbcType="DECIMAL" />
    <result column="bj_amount_p" property="bjAmountP" jdbcType="DECIMAL" />
    <result column="bj_base_e" property="bjBaseE" jdbcType="DECIMAL" />
    <result column="bj_base_p" property="bjBaseP" jdbcType="DECIMAL" />
    <result column="create_user_id" property="createUserId" jdbcType="BIGINT" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="update_user_id" property="updateUserId" jdbcType="BIGINT" />
    <result column="update_date" property="updateDate" jdbcType="TIMESTAMP" />
    <result column="is_deleted" property="isDeleted" jdbcType="INTEGER" />
    <result column="person_name" jdbcType="VARCHAR" property="personName" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    af_payment_bill_person_id, af_payment_bill_id, ps_profile_id, person_id, accumulation_fund_account, 
    hj_base_e, hj_base_p, hj_amount, hj_amount_e, hj_amount_p, bj_amount, bj_amount_e, 
    bj_amount_p, bj_base_e, bj_base_p, create_user_id, create_date, update_user_id, update_date, 
    is_deleted
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from af_payment_bill_person
    where af_payment_bill_person_id = #{afPaymentBillPersonId,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from af_payment_bill_person
    where af_payment_bill_person_id = #{afPaymentBillPersonId,jdbcType=BIGINT}
    	${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("person_id")}
  </delete>
  <insert id="insert" parameterType="com.jabava.pojo.accumulationfund.AfPaymentBillPerson" 
  		useGeneratedKeys="true" keyProperty="afPaymentBillPersonId">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into af_payment_bill_person (af_payment_bill_person_id, af_payment_bill_id, 
      ps_profile_id, person_id, accumulation_fund_account, 
      hj_base_e, hj_base_p, hj_amount, 
      hj_amount_e, hj_amount_p, bj_amount, 
      bj_amount_e, bj_amount_p, bj_base_e, 
      bj_base_p, create_user_id, create_date, 
      update_user_id, update_date, is_deleted
      )
    values (#{afPaymentBillPersonId,jdbcType=BIGINT}, #{afPaymentBillId,jdbcType=BIGINT}, 
      #{psProfileId,jdbcType=BIGINT}, #{personId,jdbcType=BIGINT}, #{accumulationFundAccount,jdbcType=VARCHAR}, 
      #{hjBaseE,jdbcType=DECIMAL}, #{hjBaseP,jdbcType=DECIMAL}, #{hjAmount,jdbcType=DECIMAL}, 
      #{hjAmountE,jdbcType=DECIMAL}, #{hjAmountP,jdbcType=DECIMAL}, #{bjAmount,jdbcType=DECIMAL}, 
      #{bjAmountE,jdbcType=DECIMAL}, #{bjAmountP,jdbcType=DECIMAL}, #{bjBaseE,jdbcType=DECIMAL}, 
      #{bjBaseP,jdbcType=DECIMAL}, #{createUserId,jdbcType=BIGINT}, #{createDate,jdbcType=TIMESTAMP}, 
      #{updateUserId,jdbcType=BIGINT}, #{updateDate,jdbcType=TIMESTAMP}, #{isDeleted,jdbcType=INTEGER}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.jabava.pojo.accumulationfund.AfPaymentBillPerson" 
  		useGeneratedKeys="true" keyProperty="afPaymentBillPersonId">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into af_payment_bill_person
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="afPaymentBillPersonId != null" >
        af_payment_bill_person_id,
      </if>
      <if test="afPaymentBillId != null" >
        af_payment_bill_id,
      </if>
      <if test="psProfileId != null" >
        ps_profile_id,
      </if>
      <if test="personId != null" >
        person_id,
      </if>
      <if test="accumulationFundAccount != null" >
        accumulation_fund_account,
      </if>
      <if test="hjBaseE != null" >
        hj_base_e,
      </if>
      <if test="hjBaseP != null" >
        hj_base_p,
      </if>
      <if test="hjAmount != null" >
        hj_amount,
      </if>
      <if test="hjAmountE != null" >
        hj_amount_e,
      </if>
      <if test="hjAmountP != null" >
        hj_amount_p,
      </if>
      <if test="bjAmount != null" >
        bj_amount,
      </if>
      <if test="bjAmountE != null" >
        bj_amount_e,
      </if>
      <if test="bjAmountP != null" >
        bj_amount_p,
      </if>
      <if test="bjBaseE != null" >
        bj_base_e,
      </if>
      <if test="bjBaseP != null" >
        bj_base_p,
      </if>
      <if test="createUserId != null" >
        create_user_id,
      </if>
      <if test="createDate != null" >
        create_date,
      </if>
      <if test="updateUserId != null" >
        update_user_id,
      </if>
      <if test="updateDate != null" >
        update_date,
      </if>
      <if test="isDeleted != null" >
        is_deleted,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="afPaymentBillPersonId != null" >
        #{afPaymentBillPersonId,jdbcType=BIGINT},
      </if>
      <if test="afPaymentBillId != null" >
        #{afPaymentBillId,jdbcType=BIGINT},
      </if>
      <if test="psProfileId != null" >
        #{psProfileId,jdbcType=BIGINT},
      </if>
      <if test="personId != null" >
        #{personId,jdbcType=BIGINT},
      </if>
      <if test="accumulationFundAccount != null" >
        #{accumulationFundAccount,jdbcType=VARCHAR},
      </if>
      <if test="hjBaseE != null" >
        #{hjBaseE,jdbcType=DECIMAL},
      </if>
      <if test="hjBaseP != null" >
        #{hjBaseP,jdbcType=DECIMAL},
      </if>
      <if test="hjAmount != null" >
        #{hjAmount,jdbcType=DECIMAL},
      </if>
      <if test="hjAmountE != null" >
        #{hjAmountE,jdbcType=DECIMAL},
      </if>
      <if test="hjAmountP != null" >
        #{hjAmountP,jdbcType=DECIMAL},
      </if>
      <if test="bjAmount != null" >
        #{bjAmount,jdbcType=DECIMAL},
      </if>
      <if test="bjAmountE != null" >
        #{bjAmountE,jdbcType=DECIMAL},
      </if>
      <if test="bjAmountP != null" >
        #{bjAmountP,jdbcType=DECIMAL},
      </if>
      <if test="bjBaseE != null" >
        #{bjBaseE,jdbcType=DECIMAL},
      </if>
      <if test="bjBaseP != null" >
        #{bjBaseP,jdbcType=DECIMAL},
      </if>
      <if test="createUserId != null" >
        #{createUserId,jdbcType=BIGINT},
      </if>
      <if test="createDate != null" >
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUserId != null" >
        #{updateUserId,jdbcType=BIGINT},
      </if>
      <if test="updateDate != null" >
        #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isDeleted != null" >
        #{isDeleted,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.jabava.pojo.accumulationfund.AfPaymentBillPerson" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update af_payment_bill_person
    <set >
      <if test="afPaymentBillId != null" >
        af_payment_bill_id = #{afPaymentBillId,jdbcType=BIGINT},
      </if>
      <if test="psProfileId != null" >
        ps_profile_id = #{psProfileId,jdbcType=BIGINT},
      </if>
      <if test="personId != null" >
        person_id = #{personId,jdbcType=BIGINT},
      </if>
      <if test="accumulationFundAccount != null" >
        accumulation_fund_account = #{accumulationFundAccount,jdbcType=VARCHAR},
      </if>
      <if test="hjBaseE != null" >
        hj_base_e = #{hjBaseE,jdbcType=DECIMAL},
      </if>
      <if test="hjBaseP != null" >
        hj_base_p = #{hjBaseP,jdbcType=DECIMAL},
      </if>
      <if test="hjAmount != null" >
        hj_amount = #{hjAmount,jdbcType=DECIMAL},
      </if>
      <if test="hjAmountE != null" >
        hj_amount_e = #{hjAmountE,jdbcType=DECIMAL},
      </if>
      <if test="hjAmountP != null" >
        hj_amount_p = #{hjAmountP,jdbcType=DECIMAL},
      </if>
      <if test="bjAmount != null" >
        bj_amount = #{bjAmount,jdbcType=DECIMAL},
      </if>
      <if test="bjAmountE != null" >
        bj_amount_e = #{bjAmountE,jdbcType=DECIMAL},
      </if>
      <if test="bjAmountP != null" >
        bj_amount_p = #{bjAmountP,jdbcType=DECIMAL},
      </if>
      <if test="bjBaseE != null" >
        bj_base_e = #{bjBaseE,jdbcType=DECIMAL},
      </if>
      <if test="bjBaseP != null" >
        bj_base_p = #{bjBaseP,jdbcType=DECIMAL},
      </if>
      <if test="createUserId != null" >
        create_user_id = #{createUserId,jdbcType=BIGINT},
      </if>
      <if test="createDate != null" >
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUserId != null" >
        update_user_id = #{updateUserId,jdbcType=BIGINT},
      </if>
      <if test="updateDate != null" >
        update_date = #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isDeleted != null" >
        is_deleted = #{isDeleted,jdbcType=INTEGER},
      </if>
    </set>
    where af_payment_bill_person_id = #{afPaymentBillPersonId,jdbcType=BIGINT}
    	${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("person_id")}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.jabava.pojo.accumulationfund.AfPaymentBillPerson" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update af_payment_bill_person
    set af_payment_bill_id = #{afPaymentBillId,jdbcType=BIGINT},
      ps_profile_id = #{psProfileId,jdbcType=BIGINT},
      person_id = #{personId,jdbcType=BIGINT},
      accumulation_fund_account = #{accumulationFundAccount,jdbcType=VARCHAR},
      hj_base_e = #{hjBaseE,jdbcType=DECIMAL},
      hj_base_p = #{hjBaseP,jdbcType=DECIMAL},
      hj_amount = #{hjAmount,jdbcType=DECIMAL},
      hj_amount_e = #{hjAmountE,jdbcType=DECIMAL},
      hj_amount_p = #{hjAmountP,jdbcType=DECIMAL},
      bj_amount = #{bjAmount,jdbcType=DECIMAL},
      bj_amount_e = #{bjAmountE,jdbcType=DECIMAL},
      bj_amount_p = #{bjAmountP,jdbcType=DECIMAL},
      bj_base_e = #{bjBaseE,jdbcType=DECIMAL},
      bj_base_p = #{bjBaseP,jdbcType=DECIMAL},
      create_user_id = #{createUserId,jdbcType=BIGINT},
      create_date = #{createDate,jdbcType=TIMESTAMP},
      update_user_id = #{updateUserId,jdbcType=BIGINT},
      update_date = #{updateDate,jdbcType=TIMESTAMP},
      is_deleted = #{isDeleted,jdbcType=INTEGER}
    where af_payment_bill_person_id = #{afPaymentBillPersonId,jdbcType=BIGINT}
    	${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("person_id")}
  </update>
  
  <select id="selectByBillId" resultMap="BaseResultMap">
  	select bp.*,p.employee_name person_name 
  	from af_payment_bill_person bp left join ehr_person p on bp.person_id=p.person_id
  	where bp.af_payment_bill_id=#{afPaymentBillId,jdbcType=BIGINT}
  		${@com.jabava.utils.privilege.AuthorisedPersonUtil@getUserAuthorisedPersonList("bp.person_id")}
  </select>
  
  <select id="selectByPersonAndMonth" resultType="java.util.HashMap">
  	select pbp.*,(pbp.hj_amount_e + pbp.bj_amount_e) amount_e, (pbp.hj_amount_p + pbp.bj_amount_p) amount_p, (pbp.hj_amount + pbp.bj_amount) amount
  	from af_payment_bill_person pbp left join af_payment_bill pb on pbp.af_payment_bill_id=pb.af_payment_bill_id
  	where pb.month=#{month,jdbcType=VARCHAR}
  		and pb.status <![CDATA[<>]]> 3 
  		and pbp.person_id=#{personId,jdbcType=BIGINT}
  	limit 1
  </select>
  
  <!-- 查询员工缴费明细 -->
  <select id="selectBillPersonByPerson" resultType="java.util.HashMap">
	SELECT afb.month, afp.accumulation_fund_account, afp.af_payment_bill_person_id,
		afp.hj_amount, afp.hj_amount_e, afp.hj_amount_p, 
		afp.bj_amount, afp.bj_amount_e, afp.bj_amount_p 
	FROM af_payment_bill_person afp LEFT JOIN af_payment_bill afb ON afp.af_payment_bill_id=afb.af_payment_bill_id
	WHERE afb.status <![CDATA[<>]]> 3 AND afp.person_id=#{personId,jdbcType=BIGINT}
      <if test="startMonth != null and startMonth != ''" >
        and afb.month <![CDATA[>=]]> #{startMonth}
      </if>
      <if test="endMonth != null and endMonth != ''" >
        and afb.month <![CDATA[<=]]> #{endMonth}
      </if>
  </select>
  
  <select id="queryByCertIdAndMonth" resultType="java.util.HashMap">
  	SELECT pbp.af_payment_bill_person_id afPaymentBillPersonId, p.employee_name employeeName 
	FROM af_payment_bill_person pbp LEFT JOIN af_payment_bill pb ON pbp.af_payment_bill_id=pb.af_payment_bill_id
	LEFT JOIN ehr_person p ON pbp.person_id=p.person_id
	WHERE pb.status <![CDATA[<>]]> 3 AND pb.month=#{month} AND 
		p.cert_id=#{cardId} AND p.is_deleted=0
  </select>
</mapper>